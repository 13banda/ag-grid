var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__export=(n,e)=>{for(var t in e)__defProp(n,t,{get:e[t],enumerable:!0})},__copyProps=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of __getOwnPropNames(e))!__hasOwnProp.call(n,s)&&s!==t&&__defProp(n,s,{get:()=>e[s],enumerable:!(i=__getOwnPropDesc(e,s))||i.enumerable});return n},__toCommonJS=n=>__copyProps(__defProp({},"__esModule",{value:!0}),n),main_exports={};__export(main_exports,{MultiFilter:()=>MultiFilter,MultiFilterModule:()=>MultiFilterModule}),module.exports=__toCommonJS(main_exports);var import_core4=require("@ag-grid-community/core"),import_core5=require("@ag-grid-enterprise/core"),import_core=require("@ag-grid-community/core"),import_core2=require("@ag-grid-enterprise/core"),MultiFilter=class f extends import_core.TabGuardComp{constructor(){super('<div class="ag-multi-filter ag-menu-list-compact"></div>'),this.filterDefs=[],this.filters=[],this.guiDestroyFuncs=[],this.filterGuis=[],this.activeFilterIndices=[],this.lastActivatedMenuItem=null,this.afterFiltersReadyFuncs=[]}wireBeans(e){this.filterManager=e.filterManager,this.userComponentFactory=e.userComponentFactory}postConstruct(){this.initialiseTabGuard({onFocusIn:e=>this.onFocusIn(e)})}static getFilterDefs(e){const{filters:t}=e;return t&&t.length>0?t:[{filter:"agTextColumnFilter"},{filter:"agSetColumnFilter"}]}init(e){this.params=e,this.filterDefs=f.getFilterDefs(e);const{column:t,filterChangedCallback:i}=e;this.column=t,this.filterChangedCallback=i;const s=[];return this.filterDefs.forEach((r,l)=>{const a=this.createFilter(r,l);a!=null&&s.push(a)}),new import_core.AgPromise(r=>{import_core.AgPromise.all(s).then(l=>{this.filters=l,this.refreshGui("columnMenu").then(()=>{r()})})}).then(()=>{this.afterFiltersReadyFuncs.forEach(r=>r()),this.afterFiltersReadyFuncs.length=0})}refreshGui(e){return e===this.lastOpenedInContainer?import_core.AgPromise.resolve():(this.tabGuardFeature.removeAllChildrenExceptTabGuards(),this.destroyChildren(),import_core.AgPromise.all(this.filters.map((t,i)=>{const s=this.filterDefs[i],r=this.getFilterTitle(t,s);let l;if(s.display==="subMenu"&&e!=="toolPanel")l=this.insertFilterMenu(t,r).then(a=>a.getGui());else if(s.display==="subMenu"||s.display==="accordion"){const a=this.insertFilterGroup(t,r);l=import_core.AgPromise.resolve(a.getGui())}else l=import_core.AgPromise.resolve(t.getGui());return l})).then(t=>{t.forEach((i,s)=>{s>0&&this.appendChild((0,import_core._loadTemplate)('<div class="ag-filter-separator"></div>')),this.appendChild(i)}),this.filterGuis=t,this.lastOpenedInContainer=e}))}getFilterTitle(e,t){return t.title!=null?t.title:e instanceof import_core.ProvidedFilter?e.getFilterTitle():"Filter"}destroyChildren(){this.guiDestroyFuncs.forEach(e=>e()),this.guiDestroyFuncs.length=0,this.filterGuis.length=0}insertFilterMenu(e,t){const i=this.createBean(new import_core2.AgMenuItemComponent);return i.init({menuItemDef:{name:t,subMenu:[],cssClasses:["ag-multi-filter-menu-item"],menuItem:import_core2.AgMenuItemRenderer,menuItemParams:{cssClassPrefix:"ag-compact-menu-option",isCompact:!0}},level:0,isAnotherSubMenuOpen:()=>!1,childComponent:e,contextParams:{column:null,node:null,value:null}}).then(()=>{i.setParentComponent(this),this.guiDestroyFuncs.push(()=>this.destroyBean(i)),this.addManagedListeners(i,{menuItemActivated:r=>{this.lastActivatedMenuItem&&this.lastActivatedMenuItem!==r.menuItem&&this.lastActivatedMenuItem.deactivate(),this.lastActivatedMenuItem=r.menuItem}});const s=i.getGui();return i.addManagedElementListeners(s,{keydown:r=>{const{key:l}=r;switch(l){case import_core.KeyCode.UP:case import_core.KeyCode.RIGHT:case import_core.KeyCode.DOWN:case import_core.KeyCode.LEFT:r.preventDefault(),l===import_core.KeyCode.RIGHT&&i.openSubMenu(!0);break}},focusin:()=>i.activate(),focusout:()=>{!i.isSubMenuOpen()&&!i.isSubMenuOpening()&&i.deactivate()}}),i})}insertFilterGroup(e,t){const i=this.createBean(new import_core2.AgGroupComponent({title:t,cssIdentifier:"multi-filter"}));return this.guiDestroyFuncs.push(()=>this.destroyBean(i)),i.addItem(e.getGui()),i.toggleGroupExpand(!1),e.afterGuiAttached&&i.addManagedListeners(i,{expanded:()=>e.afterGuiAttached({container:this.lastOpenedInContainer,suppressFocus:!0,hidePopup:this.hidePopup})}),i}isFilterActive(){return this.filters.some(e=>e.isFilterActive())}getLastActiveFilterIndex(){return this.activeFilterIndices.length>0?this.activeFilterIndices[this.activeFilterIndices.length-1]:null}doesFilterPass(e,t){let i=!0;return this.filters.forEach(s=>{!i||s===t||!s.isFilterActive()||(i=s.doesFilterPass(e))}),i}getFilterType(){return"multi"}getModelFromUi(){return{filterType:this.getFilterType(),filterModels:this.filters.map(t=>{const i=t;return typeof i.getModelFromUi=="function"?i.getModelFromUi():null})}}getModel(){return this.isFilterActive()?{filterType:this.getFilterType(),filterModels:this.filters.map(t=>t.isFilterActive()?t.getModel():null)}:null}setModel(e){const t=(s,r)=>new import_core.AgPromise(l=>{const a=s.setModel(r);a?a.then(()=>l()):l()});let i=[];return e==null?i=this.filters.map((s,r)=>t(s,null).then(()=>{this.updateActiveList(r)})):this.filters.forEach((s,r)=>{const l=e.filterModels.length>r?e.filterModels[r]:null,a=t(s,l).then(()=>{this.updateActiveList(r)});i.push(a)}),import_core.AgPromise.all(i).then(()=>{})}applyModel(e="api"){let t=!1;return this.filters.forEach(i=>{i instanceof import_core.ProvidedFilter&&(t=i.applyModel(e)||t)}),t}getChildFilterInstance(e){return this.filters[e]}afterGuiAttached(e){let t;e?(this.hidePopup=e.hidePopup,t=this.refreshGui(e.container)):(this.hidePopup=void 0,t=import_core.AgPromise.resolve()),t.then(()=>{const{filterDefs:i}=this;let s=!1;i&&(0,import_core._forEachReverse)(i,(a,u)=>{const o=u===0,c=e?.suppressFocus||!o||a.display&&a.display!=="inline",g={...e??{},suppressFocus:c},h=this.filters?.[u];if(h&&(this.executeFunctionIfExistsOnFilter(h,"afterGuiAttached",g),o&&(s=!0)),o&&c){const d=this.filterGuis[u];d&&(d.focus(),s=!0)}});const r=this.gos.getDocument(),l=this.gos.getActiveDomElement();!s&&(!l||l===r.body||this.getGui().contains(l))&&this.forceFocusOutOfContainer(!0)})}afterGuiDetached(){this.executeFunctionIfExists("afterGuiDetached")}onAnyFilterChanged(){this.executeFunctionIfExists("onAnyFilterChanged")}onNewRowsLoaded(){this.executeFunctionIfExists("onNewRowsLoaded")}destroy(){this.filters.forEach(e=>this.destroyBean(e)),this.filters.length=0,this.destroyChildren(),this.hidePopup=void 0,super.destroy()}executeFunctionIfExists(e,...t){(0,import_core._forEachReverse)(this.filters,i=>{this.executeFunctionIfExistsOnFilter(i,e,t)})}executeFunctionIfExistsOnFilter(e,t,...i){const s=e[t];typeof s=="function"&&s.apply(e,i)}createFilter(e,t){const{filterModifiedCallback:i,doesRowPassOtherFilter:s}=this.params;let r;const l={...this.filterManager.createFilterParams(this.column,this.column.getColDef()),filterModifiedCallback:i,filterChangedCallback:o=>{this.executeWhenAllFiltersReady(()=>this.filterChanged(t,o))},doesRowPassOtherFilter:o=>s(o)&&this.doesFilterPass({node:o,data:o.data},r)},a=this.userComponentFactory.getFilterDetails(e,l,"agTextColumnFilter");if(!a)return null;const u=a.newAgStackInstance();return u&&u.then(o=>r=o),u}executeWhenAllFiltersReady(e){this.filters&&this.filters.length>0?e():this.afterFiltersReadyFuncs.push(e)}updateActiveList(e){const t=this.filters[e];(0,import_core._removeFromArray)(this.activeFilterIndices,e),t.isFilterActive()&&this.activeFilterIndices.push(e)}filterChanged(e,t){this.updateActiveList(e),this.filterChangedCallback(t);const i=this.filters[e];this.filters.forEach(s=>{s!==i&&typeof s.onAnyFilterChanged=="function"&&s.onAnyFilterChanged()})}onFocusIn(e){this.lastActivatedMenuItem!=null&&!this.lastActivatedMenuItem.getGui().contains(e.target)&&(this.lastActivatedMenuItem.deactivate(),this.lastActivatedMenuItem=null)}getModelAsString(e){if(!this.filters||!e?.filterModels?.length)return"";const t=this.getLastActiveFilterIndex()??0;return this.filters[t].getModelAsString?.(e.filterModels[t])??""}},import_core3=require("@ag-grid-community/core"),MultiFloatingFilterComp=class extends import_core3.Component{constructor(){super('<div class="ag-multi-floating-filter ag-floating-filter-input"></div>'),this.floatingFilters=[],this.compDetailsList=[]}wireBeans(n){this.userComponentFactory=n.userComponentFactory,this.filterManager=n.filterManager}init(n){this.params=n;const{compDetailsList:e}=this.getCompDetailsList(n);return this.setParams(e)}setParams(n){const e=[];return n.forEach(t=>{const i=t?.newAgStackInstance();i!=null&&(this.compDetailsList.push(t),e.push(i))}),import_core3.AgPromise.all(e).then(t=>{t.forEach((i,s)=>{this.floatingFilters.push(i);const r=i.getGui();this.appendChild(r),s>0&&(0,import_core3._setDisplayed)(r,!1)})})}onParamsUpdated(n){this.refresh(n)}refresh(n){this.params=n;const{compDetailsList:e,floatingFilterParamsList:t}=this.getCompDetailsList(n);e.length===this.compDetailsList.length&&e.every((s,r)=>!this.filterManager?.areFilterCompsDifferent(this.compDetailsList[r],s))?t.forEach((s,r)=>{const l=this.floatingFilters[r];let a=!1;l.refresh&&l.refresh(s)!==null&&(a=!0),a||l.onParamsUpdated?.(s)}):((0,import_core3._clearElement)(this.getGui()),this.destroyBeans(this.floatingFilters),this.floatingFilters=[],this.compDetailsList=[],this.setParams(e))}getCompDetailsList(n){const e=[],t=[],i=n.filterParams;return MultiFilter.getFilterDefs(i).forEach((s,r)=>{const l={...n,parentFilterInstance:u=>{this.parentMultiFilterInstance(o=>{const c=o.getChildFilterInstance(r);c!=null&&u(c)})}};(0,import_core3._mergeDeep)(l.filterParams,s.filterParams);const a=this.getCompDetails(s,l);a&&(e.push(a),t.push(l))}),{compDetailsList:e,floatingFilterParamsList:t}}onParentModelChanged(n,e){e&&e.afterFloatingFilter||this.parentMultiFilterInstance(t=>{if(n==null)this.floatingFilters.forEach((i,s)=>{i.onParentModelChanged(null,e),(0,import_core3._setDisplayed)(i.getGui(),s===0)});else{const i=t.getLastActiveFilterIndex();this.floatingFilters.forEach((s,r)=>{const l=n.filterModels.length>r?n.filterModels[r]:null;s.onParentModelChanged(l,e);const a=i==null?r===0:r===i;(0,import_core3._setDisplayed)(s.getGui(),a)})}})}destroy(){this.destroyBeans(this.floatingFilters),this.floatingFilters.length=0,super.destroy()}getCompDetails(n,e){const t=(0,import_core3.getDefaultFloatingFilterType)(this.frameworkOverrides,n,()=>this.filterManager.getDefaultFloatingFilter(this.params.column))??"agReadOnlyFloatingFilter";return this.userComponentFactory.getFloatingFilterCompDetails(n,e,t)}parentMultiFilterInstance(n){this.params.parentFilterInstance(e=>{if(!(e instanceof MultiFilter))throw new Error("AG Grid - MultiFloatingFilterComp expects MultiFilter as its parent");n(e)})}},VERSION="32.0.0",MultiFilterCoreModule={version:VERSION,moduleName:`${import_core4.ModuleNames.MultiFilterModule}-core`,userComponents:[{name:"agMultiColumnFilter",classImp:MultiFilter},{name:"agMenuItem",classImp:import_core5.AgMenuItemRenderer}],dependantModules:[import_core5.EnterpriseCoreModule,import_core4._ColumnFilterModule]},MultiFloatingFilterModule={version:VERSION,moduleName:"@ag-grid-enterprise/multi-floating-filter",userComponents:[{name:"agMultiColumnFloatingFilter",classImp:MultiFloatingFilterComp}],dependantModules:[MultiFilterCoreModule,import_core4._ReadOnlyFloatingFilterModule]},MultiFilterModule={version:VERSION,moduleName:import_core4.ModuleNames.MultiFilterModule,dependantModules:[MultiFilterCoreModule,MultiFloatingFilterModule]};
