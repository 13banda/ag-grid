/**
          * @ag-grid-enterprise/server-side-row-model - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v29.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
/**
          * @ag-grid-enterprise/server-side-row-model - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v29.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("@ag-grid-community/core"),o=require("@ag-grid-enterprise/core"),r=(e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)},function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}),i=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},n=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.onRowHeightChanged_debounced=t._.debounce(o.onRowHeightChanged.bind(o),100),o.pauseStoreUpdateListening=!1,o.started=!1,o}return r(o,e),o.prototype.ensureRowHeightsValid=function(){return!1},o.prototype.start=function(){this.started=!0;var e=this.gridOptionsService.get("serverSideDatasource");e&&this.setDatasource(e)},o.prototype.destroyDatasource=function(){this.datasource&&(this.datasource.destroy&&this.datasource.destroy(),this.rowRenderer.datasourceChanged(),this.datasource=void 0)},o.prototype.addEventListeners=function(){this.addManagedListener(this.eventService,t.Events.EVENT_NEW_COLUMNS_LOADED,this.onColumnEverything.bind(this)),this.addManagedListener(this.eventService,t.Events.EVENT_STORE_UPDATED,this.onStoreUpdated.bind(this));var e=this.resetRootStore.bind(this);this.addManagedListener(this.eventService,t.Events.EVENT_COLUMN_VALUE_CHANGED,e),this.addManagedListener(this.eventService,t.Events.EVENT_COLUMN_PIVOT_CHANGED,e),this.addManagedListener(this.eventService,t.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,e),this.addManagedListener(this.eventService,t.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,e),this.verifyProps()},o.prototype.verifyProps=function(){if(this.gridOptionsService.exists("initialGroupOrderComparator")||this.gridOptionsService.exists("defaultGroupOrderComparator")){t._.doOnce((function(){return console.warn("AG Grid: initialGroupOrderComparator cannot be used with Server Side Row Model. If using Full Store, then provide the rows to the grid in the desired sort order. If using Infinite Scroll, then sorting is done on the server side, nothing to do with the client.")}),"SSRM.InitialGroupOrderComparator")}if(this.gridOptionsService.isRowSelection()&&!this.gridOptionsService.exists("getRowId")){t._.doOnce((function(){return console.warn("AG Grid: getRowId callback must be provided for Server Side Row Model selection to work correctly.")}),"SSRM.SelectionNeedsRowNodeIdFunc")}},o.prototype.setDatasource=function(e){this.started&&(this.destroyDatasource(),this.datasource=e,this.resetRootStore())},o.prototype.isLastRowIndexKnown=function(){var e=this.getRootStore();return!!e&&e.isLastRowIndexKnown()},o.prototype.onColumnEverything=function(){if(this.storeParams){var e=this.columnsToValueObjects(this.columnModel.getRowGroupColumns()),o=this.columnsToValueObjects(this.columnModel.getValueColumns()),r=this.columnsToValueObjects(this.columnModel.getPivotColumns()),i=!t._.jsonEquals(this.storeParams.sortModel,this.sortController.getSortModel()),n=!t._.jsonEquals(this.storeParams.rowGroupCols,e),s=!t._.jsonEquals(this.storeParams.pivotCols,r),a=!t._.jsonEquals(this.storeParams.valueCols,o);(i||n||s||a)&&this.resetRootStore()}else this.resetRootStore()},o.prototype.destroyRootStore=function(){this.rootNode&&this.rootNode.childStore&&(this.rootNode.childStore=this.destroyBean(this.rootNode.childStore),this.nodeManager.clear())},o.prototype.refreshAfterSort=function(e,t){this.storeParams&&(this.storeParams.sortModel=e);var o=this.getRootStore();o&&(o.refreshAfterSort(t),this.onStoreUpdated())},o.prototype.resetRootStore=function(){this.destroyRootStore(),this.rootNode=new t.RowNode(this.beans),this.rootNode.group=!0,this.rootNode.level=-1,this.datasource&&(this.storeParams=this.createStoreParams(),this.rootNode.childStore=this.createBean(this.storeFactory.createStore(this.storeParams,this.rootNode)),this.updateRowIndexesAndBounds());var e={type:t.Events.EVENT_ROW_DATA_UPDATED};this.eventService.dispatchEvent(e),this.dispatchModelUpdated(!0)},o.prototype.columnsToValueObjects=function(e){var t=this;return e.map((function(e){return{id:e.getId(),aggFunc:e.getAggFunc(),displayName:t.columnModel.getDisplayNameForColumn(e,"model"),field:e.getColDef().field}}))},o.prototype.createStoreParams=function(){var e=this.columnsToValueObjects(this.columnModel.getRowGroupColumns()),o=this.columnsToValueObjects(this.columnModel.getValueColumns()),r=this.columnsToValueObjects(this.columnModel.getPivotColumns()),i=this.gridOptionsService.isGetRowHeightFunction();return{valueCols:o,rowGroupCols:e,pivotCols:r,pivotMode:this.columnModel.isPivotMode(),filterModel:this.filterManager.getFilterModel(),sortModel:this.sortListener.extractSortModel(),datasource:this.datasource,lastAccessedSequence:new t.NumberSequence,dynamicRowHeight:i}},o.prototype.getParams=function(){return this.storeParams},o.prototype.dispatchModelUpdated=function(e){void 0===e&&(e=!1);var o={type:t.Events.EVENT_MODEL_UPDATED,animate:!e,keepRenderedRows:!e,newPage:!1,newData:!1};this.eventService.dispatchEvent(o)},o.prototype.onStoreUpdated=function(){this.pauseStoreUpdateListening||(this.updateRowIndexesAndBounds(),this.dispatchModelUpdated())},o.prototype.onRowHeightChangedDebounced=function(){this.onRowHeightChanged_debounced()},o.prototype.onRowHeightChanged=function(){this.updateRowIndexesAndBounds(),this.dispatchModelUpdated()},o.prototype.updateRowIndexesAndBounds=function(){var e=this.getRootStore();e&&e.setDisplayIndexes(new t.NumberSequence,{value:0})},o.prototype.retryLoads=function(){var e=this.getRootStore();e&&(e.retryLoads(),this.onStoreUpdated())},o.prototype.getRow=function(e){var t=this.getRootStore();if(t)return t.getRowUsingDisplayIndex(e)},o.prototype.expandAll=function(e){this.pauseStoreUpdateListening=!0,this.forEachNode((function(t){t.group&&!t.stub&&t.setExpanded(e)})),this.pauseStoreUpdateListening=!1,this.onStoreUpdated()},o.prototype.refreshAfterFilter=function(e,t){this.storeParams&&(this.storeParams.filterModel=e);var o=this.getRootStore();o&&(o.refreshAfterFilter(t),this.onStoreUpdated())},o.prototype.getRootStore=function(){if(this.rootNode&&this.rootNode.childStore)return this.rootNode.childStore},o.prototype.getRowCount=function(){var e=this.getRootStore();return e?e.getDisplayIndexEnd():0},o.prototype.getTopLevelRowCount=function(){var e=this.getRootStore();return e?e.getRowCount():1},o.prototype.getTopLevelRowDisplayedIndex=function(e){var t=this.getRootStore();return t?t.getTopLevelRowDisplayedIndex(e):e},o.prototype.getRowBounds=function(e){var t=this.getRootStore();return t?t.getRowBounds(e):{rowTop:0,rowHeight:this.gridOptionsService.getRowHeightAsNumber()}},o.prototype.getRowIndexAtPixel=function(e){var t=this.getRootStore();return e<=0||!t?0:t.getRowIndexAtPixel(e)},o.prototype.isEmpty=function(){return!1},o.prototype.isRowsToRender=function(){return null!=this.getRootStore()&&this.getRowCount()>0},o.prototype.getType=function(){return"serverSide"},o.prototype.forEachNode=function(e){var t=this.getRootStore();t&&t.forEachNodeDeep(e)},o.prototype.forEachNodeAfterFilterAndSort=function(e){var t=this.getRootStore();t&&t.forEachNodeDeepAfterFilterAndSort(e)},o.prototype.executeOnStore=function(e,t){var o=this.getRootStore();if(o){var r=o.getChildStore(e);r&&t(r)}},o.prototype.refreshStore=function(e){void 0===e&&(e={});var t=e.route?e.route:[];this.executeOnStore(t,(function(t){return t.refreshStore(1==e.purge)}))},o.prototype.getStoreState=function(){var e=[],t=this.getRootStore();return t&&t.addStoreStates(e),e},o.prototype.getNodesInRangeForSelection=function(e,o){return t._.exists(o)&&e.parent!==o.parent?[]:e.parent.childStore.getRowNodesInRange(o,e)},o.prototype.getRowNode=function(e){var t;return this.forEachNode((function(o){o.id===e&&(t=o),o.detailNode&&o.detailNode.id===e&&(t=o.detailNode)})),t},o.prototype.isRowPresent=function(e){return!!this.getRowNode(e.id)},i([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),i([t.Autowired("filterManager")],o.prototype,"filterManager",void 0),i([t.Autowired("sortController")],o.prototype,"sortController",void 0),i([t.Autowired("rowRenderer")],o.prototype,"rowRenderer",void 0),i([t.Autowired("ssrmSortService")],o.prototype,"sortListener",void 0),i([t.Autowired("ssrmNodeManager")],o.prototype,"nodeManager",void 0),i([t.Autowired("ssrmStoreFactory")],o.prototype,"storeFactory",void 0),i([t.Autowired("beans")],o.prototype,"beans",void 0),i([t.PreDestroy],o.prototype,"destroyDatasource",null),i([t.PostConstruct],o.prototype,"addEventListeners",null),i([t.PreDestroy],o.prototype,"destroyRootStore",null),o=i([t.Bean("rowModel")],o)}(t.BeanStub),s=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),a=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},d=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return s(o,e),o.prototype.loadFromDatasource=function(e){var t=e.storeParams,o=e.parentBlock,r=e.parentNode.getGroupKeys();if(t.datasource){var i={startRow:e.startRow,endRow:e.endRow,rowGroupCols:t.rowGroupCols,valueCols:t.valueCols,pivotCols:t.pivotCols,pivotMode:t.pivotMode,groupKeys:r,filterModel:t.filterModel,sortModel:t.sortModel},n={successCallback:e.successCallback,success:e.success,failCallback:e.failCallback,fail:e.fail,request:i,parentNode:e.parentNode,api:this.gridApi,columnApi:this.columnApi,context:this.gridOptionsService.get("context")};window.setTimeout((function(){t.datasource&&o.isAlive()?t.datasource.getRows(n):e.failCallback()}),0)}},o.prototype.getChildStore=function(e,o,r){if(t._.missingOrEmpty(e))return o;var i=r(e[0]);if(i){var n=e.slice(1,e.length),s=i.childStore;return s?s.getChildStore(n):null}return null},o.prototype.isServerRefreshNeeded=function(e,t,o){if(o.valueColChanged||o.secondaryColChanged)return!0;var r=e.level+1;if(!(r<t.length))return!0;var i=t[r].id;return o.changedColumns.indexOf(i)>-1||this.columnModel.getAllGridColumns().filter((function(e){return e.getColDef().showRowGroup&&o.changedColumns.includes(e.getId())})).map((function(e){return e.getColDef().showRowGroup})).some((function(e){return!0===e||e===i}))},o.prototype.getServerSideInitialRowCount=function(){var e=this.gridOptionsService.getNum("serverSideInitialRowCount");return"number"==typeof e&&e>0?e:1},o.prototype.assertRowModelIsServerSide=function(e){return!!this.gridOptionsService.isRowModelType("serverSide")||(t._.doOnce((function(){return console.warn("AG Grid: The '"+e+"' property can only be used with the Server Side Row Model.")}),e),!1)},o.prototype.assertNotTreeData=function(e){return!this.gridOptionsService.is("treeData")||(t._.doOnce((function(){return console.warn("AG Grid: The '"+e+"' property cannot be used while using tree data.")}),e+"_TreeData"),!1)},o.prototype.isServerSideSortAllLevels=function(){return this.gridOptionsService.is("serverSideSortAllLevels")&&this.assertRowModelIsServerSide("serverSideSortAllLevels")},o.prototype.isServerSideFilterAllLevels=function(){return this.gridOptionsService.is("serverSideFilterAllLevels")&&this.assertRowModelIsServerSide("serverSideFilterAllLevels")},o.prototype.isServerSideSortOnServer=function(){return this.gridOptionsService.is("serverSideSortOnServer")&&this.assertRowModelIsServerSide("serverSideSortOnServer")&&this.assertNotTreeData("serverSideSortOnServer")},o.prototype.isServerSideFilterOnServer=function(){return this.gridOptionsService.is("serverSideFilterOnServer")&&this.assertRowModelIsServerSide("serverSideFilterOnServer")&&this.assertNotTreeData("serverSideFilterOnServer")},a([t.Autowired("columnApi")],o.prototype,"columnApi",void 0),a([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),a([t.Autowired("gridApi")],o.prototype,"gridApi",void 0),o=a([t.Bean("ssrmStoreUtils")],o)}(t.BeanStub),l=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),u=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},c=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return l(o,e),o.prototype.postConstruct=function(){this.rowHeight=this.gridOptionsService.getRowHeightAsNumber(),this.usingTreeData=this.gridOptionsService.isTreeData(),this.usingMasterDetail=this.gridOptionsService.isMasterDetail()},o.prototype.createRowNode=function(e){var o=new t.RowNode(this.beans),r=null!=e.rowHeight?e.rowHeight:this.rowHeight;return o.setRowHeight(r),o.group=e.group,o.leafGroup=e.leafGroup,o.level=e.level,o.uiLevel=e.level,o.parent=e.parent,o.stub=!0,o.__needsRefresh=!1,o.__needsRefreshWhenVisible=!1,o.group&&(o.expanded=!1,o.field=e.field,o.rowGroupColumn=e.rowGroupColumn),o},o.prototype.destroyRowNodes=function(e){var t=this;e&&e.forEach((function(e){return t.destroyRowNode(e)}))},o.prototype.destroyRowNode=function(e,t){void 0===t&&(t=!1),e.childStore&&!t&&(this.destroyBean(e.childStore),e.childStore=null),e.clearRowTopAndRowIndex(),null!=e.id&&this.nodeManager.removeNode(e)},o.prototype.setTreeGroupInfo=function(e){var t=this.gridOptionsService.get("isServerSideGroup"),o=this.gridOptionsService.get("getServerSideGroupKey");null!=t&&(e.setGroup(t(e.data)),e.group&&null!=o&&(e.key=o(e.data))),e.group||null==e.childStore||(this.destroyBean(e.childStore),e.childStore=null)},o.prototype.setRowGroupInfo=function(e){e.key=this.valueService.getValue(e.rowGroupColumn,e),null!==e.key&&void 0!==e.key||t._.doOnce((function(){console.warn("AG Grid: null and undefined values are not allowed for server side row model keys"),e.rowGroupColumn&&console.warn("column = "+e.rowGroupColumn.getId()),console.warn("data is ",e.data)}),"ServerSideBlock-CannotHaveNullOrUndefinedForKey")},o.prototype.setMasterDetailInfo=function(e){var t=this.gridOptionsService.get("isRowMaster");e.master=null==t||t(e.data)},o.prototype.updateDataIntoRowNode=function(e,t){e.updateData(t),this.usingTreeData?(this.setTreeGroupInfo(e),this.setChildCountIntoRowNode(e)):e.group?this.setChildCountIntoRowNode(e):this.usingMasterDetail},o.prototype.setDataIntoRowNode=function(e,o,r,i){e.stub=!1,t._.exists(o)?(e.setDataAndId(o,r),this.usingTreeData?this.setTreeGroupInfo(e):e.group?this.setRowGroupInfo(e):this.usingMasterDetail&&this.setMasterDetailInfo(e)):(e.setDataAndId(void 0,void 0),e.key=null),(this.usingTreeData||e.group)&&(this.setGroupDataIntoRowNode(e),this.setChildCountIntoRowNode(e)),t._.exists(o)&&e.setRowHeight(this.gridOptionsService.getRowHeightForNode(e,!1,i).height)},o.prototype.setChildCountIntoRowNode=function(e){var t=this.gridOptionsService.get("getChildCount");t&&e.setAllChildrenCount(t(e.data))},o.prototype.setGroupDataIntoRowNode=function(e){var t=this,o=this.columnModel.getGroupDisplayColumns(),r=this.gridOptionsService.isTreeData();o.forEach((function(o){if(null==e.groupData&&(e.groupData={}),r)e.groupData[o.getColId()]=e.key;else if(o.isRowGroupDisplayed(e.rowGroupColumn.getId())){var i=t.valueService.getValue(e.rowGroupColumn,e);e.groupData[o.getColId()]=i}}))},o.prototype.clearDisplayIndex=function(e){(e.clearRowTopAndRowIndex(),e.group&&t._.exists(e.childStore))&&e.childStore.clearDisplayIndexes();e.master&&e.detailNode&&e.detailNode.clearRowTopAndRowIndex()},o.prototype.setDisplayIndex=function(e,o,r){if(e.setRowIndex(o.next()),e.setRowTop(r.value),r.value+=e.rowHeight,e.master&&(e.expanded&&e.detailNode?(e.detailNode.setRowIndex(o.next()),e.detailNode.setRowTop(r.value),r.value+=e.detailNode.rowHeight):e.detailNode&&e.detailNode.clearRowTopAndRowIndex()),e.group&&t._.exists(e.childStore)){var i=e.childStore;e.expanded?i.setDisplayIndexes(o,r):i.clearDisplayIndexes()}},o.prototype.binarySearchForDisplayIndex=function(e,o){var r=0,i=o.length-1;if(t._.missing(i)||t._.missing(r))console.warn("AG Grid: error: topPointer = "+i+", bottomPointer = "+r);else for(;;){var n=Math.floor((r+i)/2),s=o[n];if(s.rowIndex===e)return s;var a=s.master&&s.expanded,d=s.detailNode;if(a&&d&&d.rowIndex===e)return s.detailNode;var l=s.childStore;if(s.expanded&&l&&l.isDisplayIndexInStore(e))return l.getRowUsingDisplayIndex(e);if(s.rowIndex<e)r=n+1;else{if(!(s.rowIndex>e))return void console.warn("AG Grid: error: unable to locate rowIndex = "+e+" in cache");i=n-1}}},o.prototype.extractRowBounds=function(e,o){var r=function(e){return{rowHeight:e.rowHeight,rowTop:e.rowTop}};if(e.rowIndex===o)return r(e);if(e.group&&e.expanded&&t._.exists(e.childStore)){var i=e.childStore;if(i.isDisplayIndexInStore(o))return i.getRowBounds(o)}else if(e.master&&e.expanded&&t._.exists(e.detailNode)&&e.detailNode.rowIndex===o)return r(e.detailNode)},o.prototype.getIndexAtPixel=function(e,o){if(e.isPixelInRange(o))return e.rowIndex;var r=e.master&&e.expanded,i=e.detailNode;if(r&&i&&i.isPixelInRange(o))return e.detailNode.rowIndex;if(e.group&&e.expanded&&t._.exists(e.childStore)){var n=e.childStore;if(n.isPixelInRange(o))return n.getRowIndexAtPixel(o)}return null},o.prototype.createNodeIdPrefix=function(e){for(var t=[],o=e;o&&o.level>=0;)""===o.key?t.push("ag-Grid-MissingKey"):t.push(o.key),o=o.parent;if(t.length>0)return t.reverse().join("-")},o.prototype.checkOpenByDefault=function(e){if(e.isExpandable()){var t=this.gridOptionsService.getCallback("isServerSideGroupOpenByDefault");if(t)t({data:e.data,rowNode:e})&&window.setTimeout((function(){return e.setExpanded(!0)}),0)}},u([t.Autowired("valueService")],o.prototype,"valueService",void 0),u([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),u([t.Autowired("ssrmNodeManager")],o.prototype,"nodeManager",void 0),u([t.Autowired("beans")],o.prototype,"beans",void 0),u([t.PostConstruct],o.prototype,"postConstruct",null),o=u([t.Bean("ssrmBlockUtils")],o)}(t.BeanStub),p=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},h=function(){function e(){this.rowNodes={}}return e.prototype.addRowNode=function(e){var t=e.id;this.rowNodes[t]&&(console.warn("AG Grid: Duplicate node id "+e.id+". Row ID's are provided via the getRowId() callback. Please modify the getRowId() callback code to provide unique row id values."),console.warn("first instance",this.rowNodes[t].data),console.warn("second instance",e.data)),this.rowNodes[t]=e},e.prototype.removeNode=function(e){var t=e.id;this.rowNodes[t]&&(this.rowNodes[t]=void 0)},e.prototype.clear=function(){this.rowNodes={}},p([t.PreDestroy],e.prototype,"clear",null),e=p([t.Bean("ssrmNodeManager")],e)}(),f=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),v=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},w=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.asyncTransactions=[],t}return f(o,e),o.prototype.postConstruct=function(){this.gridOptionsService.isRowModelType("serverSide")},o.prototype.applyTransactionAsync=function(e,t){null==this.asyncTransactionsTimeout&&this.scheduleExecuteAsync(),this.asyncTransactions.push({transaction:e,callback:t})},o.prototype.scheduleExecuteAsync=function(){var e=this,t=this.gridOptionsService.getAsyncTransactionWaitMillis();this.asyncTransactionsTimeout=window.setTimeout((function(){e.executeAsyncTransactions()}),t)},o.prototype.executeAsyncTransactions=function(){var e=this;if(this.asyncTransactions){var o=[],r=[],i=[],n=!1;if(this.asyncTransactions.forEach((function(s){var a;e.serverSideRowModel.executeOnStore(s.transaction.route,(function(e){a=e.applyTransaction(s.transaction)})),null==a&&(a={status:t.ServerSideTransactionResultStatus.StoreNotFound}),r.push(a),a.status==t.ServerSideTransactionResultStatus.StoreLoading?i.push(s):(s.callback&&o.push((function(){return s.callback(a)})),a.status===t.ServerSideTransactionResultStatus.Applied&&(n=!0))})),o.length>0&&window.setTimeout((function(){o.forEach((function(e){return e()}))}),0),this.asyncTransactionsTimeout=void 0,this.asyncTransactions=i,n&&(this.valueCache.onDataChanged(),this.eventService.dispatchEvent({type:t.Events.EVENT_STORE_UPDATED})),r.length>0){var s={type:t.Events.EVENT_ASYNC_TRANSACTIONS_FLUSHED,results:r};this.eventService.dispatchEvent(s)}}},o.prototype.flushAsyncTransactions=function(){null!=this.asyncTransactionsTimeout&&clearTimeout(this.asyncTransactionsTimeout),this.executeAsyncTransactions()},o.prototype.applyTransaction=function(e){var o,r=this;return this.serverSideRowModel.executeOnStore(e.route,(function(t){o=t.applyTransaction(e)})),o?(this.valueCache.onDataChanged(),this.eventService.dispatchEvent({type:t.Events.EVENT_STORE_UPDATED}),o.update&&o.update.length&&setTimeout((function(){r.rowRenderer.refreshFullWidthRows(o.update)}),0),o):{status:t.ServerSideTransactionResultStatus.StoreNotFound}},v([t.Autowired("rowNodeBlockLoader")],o.prototype,"rowNodeBlockLoader",void 0),v([t.Autowired("valueCache")],o.prototype,"valueCache",void 0),v([t.Autowired("rowModel")],o.prototype,"serverSideRowModel",void 0),v([t.Autowired("rowRenderer")],o.prototype,"rowRenderer",void 0),v([t.PostConstruct],o.prototype,"postConstruct",null),o=v([t.Bean("ssrmTransactionManager")],o)}(t.BeanStub),y=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),g=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},S=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return y(o,e),o.prototype.postConstruct=function(){this.gridOptionsService.isRowModelType("serverSide")&&this.addManagedListener(this.eventService,t.Events.EVENT_ROW_GROUP_OPENED,this.onRowGroupOpened.bind(this))},o.prototype.onRowGroupOpened=function(e){var o=e.node;if(o.expanded){if(o.master)this.createDetailNode(o);else if(t._.missing(o.childStore)){var r=this.serverSideRowModel.getParams();o.childStore=this.createBean(this.storeFactory.createStore(r,o))}}else this.gridOptionsService.is("purgeClosedRowNodes")&&t._.exists(o.childStore)&&(o.childStore=this.destroyBean(o.childStore));var i={type:t.Events.EVENT_STORE_UPDATED};this.eventService.dispatchEvent(i)},o.prototype.createDetailNode=function(e){if(t._.exists(e.detailNode))return e.detailNode;var o=new t.RowNode(this.beans);o.detail=!0,o.selectable=!1,o.parent=e,t._.exists(e.id)&&(o.id="detail_"+e.id),o.data=e.data,o.level=e.level+1;var r=this.gridOptionsService.getRowHeightForNode(o).height;return o.rowHeight=r||200,e.detailNode=o,o},g([t.Autowired("rowModel")],o.prototype,"serverSideRowModel",void 0),g([t.Autowired("ssrmStoreFactory")],o.prototype,"storeFactory",void 0),g([t.Autowired("beans")],o.prototype,"beans",void 0),g([t.PostConstruct],o.prototype,"postConstruct",null),o=g([t.Bean("ssrmExpandListener")],o)}(t.BeanStub),R=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),N=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},m=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return R(o,e),o.prototype.postConstruct=function(){this.gridOptionsService.isRowModelType("serverSide")&&this.addManagedListener(this.eventService,t.Events.EVENT_SORT_CHANGED,this.onSortChanged.bind(this))},o.prototype.extractSortModel=function(){var e=this.sortController.getSortModel();return this.gridOptionsService.isTreeData()||(this.replaceAutoGroupColumnWithActualRowGroupColumns(e),this.removeMultiColumnPrefixOnColumnIds(e)),e},o.prototype.removeMultiColumnPrefixOnColumnIds=function(e){if(this.gridOptionsService.isGroupMultiAutoColumn())for(var o=t.GROUP_AUTO_COLUMN_ID+"-",r=0;r<e.length;++r)e[r].colId.indexOf(o)>-1&&(e[r].colId=e[r].colId.substr(o.length))},o.prototype.replaceAutoGroupColumnWithActualRowGroupColumns=function(e){var o=e.find((function(e){return e.colId==t.GROUP_AUTO_COLUMN_ID}));if(o){var r=e.indexOf(o);t._.removeFromArray(e,o);var i=this.columnModel.getRowGroupColumns().filter((function(t){return 0==e.filter((function(e){return e.colId===t.getColId()})).length})).map((function(e){return{colId:e.getId(),sort:o.sort}}));t._.insertArrayIntoArray(e,i,r)}},o.prototype.onSortChanged=function(){var e=this.serverSideRowModel.getParams();if(e){var t=this.extractSortModel(),o=e.sortModel,r=this.findChangedColumnsInSort(t,o),i={valueColChanged:this.listenerUtils.isSortingWithValueColumn(r),secondaryColChanged:this.listenerUtils.isSortingWithSecondaryColumn(r),changedColumns:r};this.serverSideRowModel.refreshAfterSort(t,i)}},o.prototype.findChangedColumnsInSort=function(e,t){var o=[];[e,t].forEach((function(e){if(e){var t=e.map((function(e){return e.colId}));o=o.concat(t)}}));return o.filter((function(o){var r=t.find((function(e){return e.colId===o})),i=e.find((function(e){return e.colId===o}));return function(e,t){return(e?e.sort:null)!==(t?t.sort:null)}(r,i)||function(o,r){return(o?t.indexOf(o):-1)!==(r?e.indexOf(r):-1)}(r,i)}))},N([t.Autowired("sortController")],o.prototype,"sortController",void 0),N([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),N([t.Autowired("rowModel")],o.prototype,"serverSideRowModel",void 0),N([t.Autowired("ssrmListenerUtils")],o.prototype,"listenerUtils",void 0),N([t.PostConstruct],o.prototype,"postConstruct",null),o=N([t.Bean("ssrmSortService")],o)}(t.BeanStub),I=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),x=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},A=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return I(o,e),o.prototype.postConstruct=function(){this.gridOptionsService.isRowModelType("serverSide")&&this.addManagedListener(this.eventService,t.Events.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this))},o.prototype.onFilterChanged=function(){var e=this.serverSideRowModel.getParams();if(e){var t=this.filterManager.getFilterModel(),o=e?e.filterModel:{},r=this.findChangedColumns(t,o),i={valueColChanged:this.listenerUtils.isSortingWithValueColumn(r),secondaryColChanged:this.listenerUtils.isSortingWithSecondaryColumn(r),changedColumns:r};this.serverSideRowModel.refreshAfterFilter(t,i)}},o.prototype.findChangedColumns=function(e,t){var o={};Object.keys(e).forEach((function(e){return o[e]=!0})),Object.keys(t).forEach((function(e){return o[e]=!0}));var r=[];return Object.keys(o).forEach((function(o){JSON.stringify(e[o])!=JSON.stringify(t[o])&&r.push(o)})),r},x([t.Autowired("rowModel")],o.prototype,"serverSideRowModel",void 0),x([t.Autowired("filterManager")],o.prototype,"filterManager",void 0),x([t.Autowired("ssrmListenerUtils")],o.prototype,"listenerUtils",void 0),x([t.PostConstruct],o.prototype,"postConstruct",null),o=x([t.Bean("ssrmFilterListener")],o)}(t.BeanStub),b=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),C=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},O=function(e){function o(o,r,i){var n=e.call(this,0)||this;return n.nodeIdSequence=new t.NumberSequence,n.info={},n.ssrmParams=o,n.parentRowNode=i,n.level=i.level+1,n.groupLevel=o.rowGroupCols?n.level<o.rowGroupCols.length:void 0,n.leafGroup=!!o.rowGroupCols&&n.level===o.rowGroupCols.length-1,n}return b(o,e),o.prototype.postConstruct=function(){var e=this;if(this.usingTreeData=this.gridOptionsService.isTreeData(),this.nodeIdPrefix=this.blockUtils.createNodeIdPrefix(this.parentRowNode),!this.usingTreeData&&this.groupLevel){var t=this.ssrmParams.rowGroupCols[this.level];this.groupField=t.field,this.rowGroupColumn=this.columnModel.getRowGroupColumns()[this.level]}var o=1,r=-1===this.parentRowNode.level,i=this.storeUtils.getServerSideInitialRowCount();r&&void 0!==i&&(o=i),this.initialiseRowNodes(o),this.rowNodeBlockLoader.addBlock(this),this.addDestroyFunc((function(){return e.rowNodeBlockLoader.removeBlock(e)}))},o.prototype.destroyRowNodes=function(){this.blockUtils.destroyRowNodes(this.allRowNodes),this.allRowNodes=[],this.nodesAfterSort=[],this.nodesAfterFilter=[],this.allNodesMap={}},o.prototype.initialiseRowNodes=function(e,t){void 0===t&&(t=!1),this.destroyRowNodes();for(var o=0;o<e;o++){var r=this.blockUtils.createRowNode({field:this.groupField,group:this.groupLevel,leafGroup:this.leafGroup,level:this.level,parent:this.parentRowNode,rowGroupColumn:this.rowGroupColumn});t&&(r.failedLoad=!0),this.allRowNodes.push(r),this.nodesAfterFilter.push(r),this.nodesAfterSort.push(r)}},o.prototype.getBlockStateJson=function(){return{id:this.nodeIdPrefix?this.nodeIdPrefix:"",state:this.getState()}},o.prototype.loadFromDatasource=function(){this.storeUtils.loadFromDatasource({startRow:void 0,endRow:void 0,parentBlock:this,parentNode:this.parentRowNode,storeParams:this.ssrmParams,successCallback:this.pageLoaded.bind(this,this.getVersion()),success:this.success.bind(this,this.getVersion()),failCallback:this.pageLoadFailed.bind(this,this.getVersion()),fail:this.pageLoadFailed.bind(this,this.getVersion())})},o.prototype.getStartRow=function(){return 0},o.prototype.getEndRow=function(){return this.nodesAfterSort.length},o.prototype.createDataNode=function(e,o){var r=this.blockUtils.createRowNode({field:this.groupField,group:this.groupLevel,leafGroup:this.leafGroup,level:this.level,parent:this.parentRowNode,rowGroupColumn:this.rowGroupColumn});null!=o?t._.insertIntoArray(this.allRowNodes,r,o):this.allRowNodes.push(r);var i=this.prefixId(this.nodeIdSequence.next());return this.blockUtils.setDataIntoRowNode(r,e,i,void 0),this.nodeManager.addRowNode(r),this.blockUtils.checkOpenByDefault(r),this.allNodesMap[r.id]=r,r},o.prototype.prefixId=function(e){return this.nodeIdPrefix?this.nodeIdPrefix+"-"+e:e.toString()},o.prototype.processServerFail=function(){this.initialiseRowNodes(1,!0),this.fireStoreUpdatedEvent(),this.flushAsyncTransactions()},o.prototype.processServerResult=function(e){if(this.isAlive()){var o=e.storeInfo||e.groupLevelInfo;o&&Object.assign(this.info,o);var r=this.allRowNodes.length>0?this.allNodesMap:void 0;if(this.allRowNodes=[],this.nodesAfterSort=[],this.nodesAfterFilter=[],this.allNodesMap={},!e.rowData){t._.doOnce((function(){return console.warn('AG Grid: "params.data" is missing from Server-Side Row Model success() callback. Please use the "data" attribute. If no data is returned, set an empty list.',e)}),"FullStore.noData")}this.createOrRecycleNodes(r,e.rowData),r&&this.blockUtils.destroyRowNodes(t._.getAllValuesInObject(r)),this.filterAndSortNodes(),this.fireStoreUpdatedEvent(),this.flushAsyncTransactions()}},o.prototype.createOrRecycleNodes=function(e,t){var o=this;if(t){t.forEach((function(t){var r=function(t){if(e){var r=o.gridOptionsService.getRowIdFunc();if(r){var i=o.parentRowNode.getGroupKeys(),n=o.level,s=r({data:t,parentKeys:i.length>0?i:void 0,level:n}),a=e[s];if(a)return delete e[s],a}}}(t);r?function(e,t){o.allNodesMap[e.id]=e,o.blockUtils.updateDataIntoRowNode(e,t),o.allRowNodes.push(e)}(r,t):o.createDataNode(t)}))}},o.prototype.flushAsyncTransactions=function(){var e=this;window.setTimeout((function(){return e.transactionManager.flushAsyncTransactions()}),0)},o.prototype.filterAndSortNodes=function(){this.filterRowNodes(),this.sortRowNodes()},o.prototype.sortRowNodes=function(){var e=this.storeUtils.isServerSideSortAllLevels()||this.storeUtils.isServerSideSortOnServer(),t=this.sortController.getSortOptions(),o=!t||0==t.length;this.nodesAfterSort=e||o?this.nodesAfterFilter:this.rowNodeSorter.doFullSort(this.nodesAfterFilter,t)},o.prototype.filterRowNodes=function(){var e=this,t=this.storeUtils.isServerSideFilterAllLevels()||this.storeUtils.isServerSideFilterOnServer(),o=this.groupLevel;this.nodesAfterFilter=t||o?this.allRowNodes:this.allRowNodes.filter((function(t){return e.filterManager.doesRowPassFilter({rowNode:t})}))},o.prototype.clearDisplayIndexes=function(){var e=this;this.displayIndexStart=void 0,this.displayIndexEnd=void 0,this.allRowNodes.forEach((function(t){return e.blockUtils.clearDisplayIndex(t)}))},o.prototype.getDisplayIndexEnd=function(){return this.displayIndexEnd},o.prototype.isDisplayIndexInStore=function(e){return 0!==this.getRowCount()&&(e>=this.displayIndexStart&&e<this.displayIndexEnd)},o.prototype.setDisplayIndexes=function(e,t){var o=this;this.displayIndexStart=e.peek(),this.topPx=t.value;var r={};this.nodesAfterSort.forEach((function(i){o.blockUtils.setDisplayIndex(i,e,t),r[i.id]=!0})),this.allRowNodes.forEach((function(e){r[e.id]||o.blockUtils.clearDisplayIndex(e)})),this.displayIndexEnd=e.peek(),this.heightPx=t.value-this.topPx},o.prototype.forEachNodeDeep=function(e,o){void 0===o&&(o=new t.NumberSequence),this.allRowNodes.forEach((function(t){e(t,o.next());var r=t.childStore;r&&r.forEachNodeDeep(e,o)}))},o.prototype.forEachNodeDeepAfterFilterAndSort=function(e,o){void 0===o&&(o=new t.NumberSequence),this.nodesAfterSort.forEach((function(t){e(t,o.next());var r=t.childStore;r&&r.forEachNodeDeepAfterFilterAndSort(e,o)}))},o.prototype.getRowUsingDisplayIndex=function(e){if(this.isDisplayIndexInStore(e))return this.blockUtils.binarySearchForDisplayIndex(e,this.nodesAfterSort)},o.prototype.getRowBounds=function(e){for(var t=0;t<this.nodesAfterSort.length;t++){var o=this.nodesAfterSort[t],r=this.blockUtils.extractRowBounds(o,e);if(r)return r}return null},o.prototype.isPixelInRange=function(e){return e>=this.topPx&&e<this.topPx+this.heightPx},o.prototype.getRowIndexAtPixel=function(e){var t=this;if(e<=this.topPx)return this.nodesAfterSort[0].rowIndex;if(e>=this.topPx+this.heightPx){var o=this.nodesAfterSort[this.nodesAfterSort.length-1],r=o.rowTop+o.rowHeight;if(e>=r&&o.expanded){if(o.childStore&&o.childStore.getRowCount()>0)return o.childStore.getRowIndexAtPixel(e);if(o.detailNode)return o.detailNode.rowIndex}return o.rowIndex}var i=null;return this.nodesAfterSort.forEach((function(o){var r=t.blockUtils.getIndexAtPixel(o,e);null!=r&&(i=r)})),null==i?this.displayIndexEnd-1:i},o.prototype.getChildStore=function(e){var t=this;return this.storeUtils.getChildStore(e,this,(function(e){return t.allRowNodes.find((function(t){return t.key==e}))}))},o.prototype.forEachChildStoreShallow=function(e){this.allRowNodes.forEach((function(t){var o=t.childStore;o&&e(o)}))},o.prototype.refreshAfterFilter=function(e){var t=this.storeUtils.isServerSideFilterOnServer(),o=this.storeUtils.isServerRefreshNeeded(this.parentRowNode,this.ssrmParams.rowGroupCols,e);if(this.storeUtils.isServerSideFilterAllLevels()||t&&o)return this.refreshStore(!0),void this.sortRowNodes();this.filterRowNodes(),this.sortRowNodes(),this.forEachChildStoreShallow((function(t){return t.refreshAfterFilter(e)}))},o.prototype.refreshAfterSort=function(e){var t=this.storeUtils.isServerSideSortOnServer(),o=this.storeUtils.isServerRefreshNeeded(this.parentRowNode,this.ssrmParams.rowGroupCols,e);if(this.storeUtils.isServerSideSortAllLevels()||t&&o)return this.refreshStore(!0),void this.filterRowNodes();this.filterRowNodes(),this.sortRowNodes(),this.forEachChildStoreShallow((function(t){return t.refreshAfterSort(e)}))},o.prototype.applyTransaction=function(e){switch(this.getState()){case t.RowNodeBlock.STATE_FAILED:return{status:t.ServerSideTransactionResultStatus.StoreLoadingFailed};case t.RowNodeBlock.STATE_LOADING:return{status:t.ServerSideTransactionResultStatus.StoreLoading};case t.RowNodeBlock.STATE_WAITING_TO_LOAD:return{status:t.ServerSideTransactionResultStatus.StoreWaitingToLoad}}var o=this.gridOptionsService.getCallback("isApplyServerSideTransaction");if(o&&!o({transaction:e,parentNode:this.parentRowNode,storeInfo:this.info,groupLevelInfo:this.info}))return{status:t.ServerSideTransactionResultStatus.Cancelled};var r={status:t.ServerSideTransactionResultStatus.Applied,remove:[],update:[],add:[]},i=[];return this.executeAdd(e,r),this.executeRemove(e,r,i),this.executeUpdate(e,r,i),this.filterAndSortNodes(),this.updateSelection(i),r},o.prototype.updateSelection=function(e){if(e.length>0){e.forEach((function(e){e.setSelected(!1,!1,!0,"rowDataChanged")}));var o={type:t.Events.EVENT_SELECTION_CHANGED,source:"rowDataChanged"};this.eventService.dispatchEvent(o)}},o.prototype.executeAdd=function(e,o){var r=this,i=e.add,n=e.addIndex;t._.missingOrEmpty(i)||("number"==typeof n&&n>=0?i.reverse().forEach((function(e){var t=r.createDataNode(e,n);o.add.push(t)})):i.forEach((function(e){var t=r.createDataNode(e);o.add.push(t)})))},o.prototype.executeRemove=function(e,t,o){var r=this,i=e.remove;if(null!=i){var n={};i.forEach((function(e){var i=r.lookupRowNode(e);i&&(i.isSelected()&&o.push(i),i.clearRowTopAndRowIndex(),n[i.id]=!0,delete r.allNodesMap[i.id],t.remove.push(i),r.nodeManager.removeNode(i))})),this.allRowNodes=this.allRowNodes.filter((function(e){return!n[e.id]}))}},o.prototype.executeUpdate=function(e,t,o){var r=this,i=e.update;null!=i&&i.forEach((function(e){var i=r.lookupRowNode(e);i&&(r.blockUtils.updateDataIntoRowNode(i,e),!i.selectable&&i.isSelected()&&o.push(i),t.update.push(i))}))},o.prototype.lookupRowNode=function(e){var t,o=this.gridOptionsService.getRowIdFunc();if(null!=o){var r=this.level,i=this.parentRowNode.getGroupKeys(),n=o({data:e,parentKeys:i.length>0?i:void 0,level:r});if(!(t=this.allNodesMap[n]))return console.error("AG Grid: could not find row id="+n+", data item was not found for this id"),null}else if(!(t=this.allRowNodes.find((function(t){return t.data===e}))))return console.error("AG Grid: could not find data item as object was not found",e),null;return t},o.prototype.addStoreStates=function(e){e.push({suppressInfiniteScroll:!0,route:this.parentRowNode.getGroupKeys(),rowCount:this.allRowNodes.length,info:this.info}),this.forEachChildStoreShallow((function(t){return t.addStoreStates(e)}))},o.prototype.refreshStore=function(e){if(e){var t=this.nodesAfterSort?this.nodesAfterSort.length:1;this.initialiseRowNodes(t)}this.scheduleLoad(),this.fireStoreUpdatedEvent()},o.prototype.retryLoads=function(){this.getState()===t.RowNodeBlock.STATE_FAILED&&(this.initialiseRowNodes(1),this.scheduleLoad()),this.forEachChildStoreShallow((function(e){return e.retryLoads()}))},o.prototype.scheduleLoad=function(){this.setStateWaitingToLoad(),this.rowNodeBlockLoader.checkBlockToLoad()},o.prototype.fireStoreUpdatedEvent=function(){var e={type:t.Events.EVENT_STORE_UPDATED};this.eventService.dispatchEvent(e)},o.prototype.getRowCount=function(){return this.nodesAfterSort.length},o.prototype.getTopLevelRowDisplayedIndex=function(e){return this.nodesAfterSort[e].rowIndex},o.prototype.isLastRowIndexKnown=function(){return this.getState()==t.RowNodeBlock.STATE_LOADED},o.prototype.getRowNodesInRange=function(e,o){var r=[],i=!1;return t._.missing(e)&&(i=!0),this.nodesAfterSort.forEach((function(t){var n=t===e||t===o;(i||n)&&r.push(t),n&&(i=!i)})),i?[]:r},C([t.Autowired("ssrmStoreUtils")],o.prototype,"storeUtils",void 0),C([t.Autowired("ssrmBlockUtils")],o.prototype,"blockUtils",void 0),C([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),C([t.Autowired("rowNodeBlockLoader")],o.prototype,"rowNodeBlockLoader",void 0),C([t.Autowired("rowNodeSorter")],o.prototype,"rowNodeSorter",void 0),C([t.Autowired("sortController")],o.prototype,"sortController",void 0),C([t.Autowired("ssrmNodeManager")],o.prototype,"nodeManager",void 0),C([t.Autowired("filterManager")],o.prototype,"filterManager",void 0),C([t.Autowired("ssrmTransactionManager")],o.prototype,"transactionManager",void 0),C([t.PostConstruct],o.prototype,"postConstruct",null),C([t.PreDestroy],o.prototype,"destroyRowNodes",null),o}(t.RowNodeBlock),E=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),M=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},D=function(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var r,i,n=o.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=n.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(i)throw i.error}}return s},_=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(D(arguments[t]));return e},P=function(e){function o(t,o,r){var i=e.call(this)||this;return i.loadingNodes=new Set,i.loaderTimeout=void 0,i.nextBlockToLoad=void 0,i.parentNode=o,i.cache=t,i.storeParams=r,i}return E(o,e),o.prototype.init=function(){var e=this;this.addManagedListener(this.rowNodeBlockLoader,t.RowNodeBlockLoader.BLOCK_LOADED_EVENT,(function(){return e.queueLoadAction()}))},o.prototype.isRowLoading=function(e){return e in this.loadingNodes},o.prototype.doesRowNeedLoaded=function(e){if(this.loadingNodes.has(e))return!1;var t=this.cache.getRowByStoreIndex(e);if(!t)return!1;if(t.__needsRefresh)return!0;var o=this.api.getFirstDisplayedRow(),r=this.api.getLastDisplayedRow();return!!(null!=t.rowIndex&&t.rowIndex>=o&&t.rowIndex<=r)&&(t.stub&&!t.failedLoad||t.__needsRefreshWhenVisible)},o.prototype.getBlocksToLoad=function(){var e=this,t=new Set;return this.cache.getNodeMapEntries().forEach((function(o){var r=D(o,2),i=r[0];r[1];var n=Number(i),s=e.getBlockStartIndexForIndex(n);e.doesRowNeedLoaded(n)&&t.add(s)})),_(t)},o.prototype.getNodeRanges=function(){var e=this,r={};return this.getBlocksToLoad().forEach((function(i){var n=t._.oneOrGreater(e.gridOptionsService.getNum("cacheBlockSize"))||o.DEFAULT_BLOCK_SIZE,s=i-i%n;r[s]=s+n})),r},o.prototype.reset=function(){this.loadingNodes.clear(),clearTimeout(this.loaderTimeout),this.loaderTimeout=void 0},o.prototype.executeLoad=function(e,t){var o,r=this,i=this.cache.getSsrmParams(),n={startRow:e,endRow:t,rowGroupCols:i.rowGroupCols,valueCols:i.valueCols,pivotCols:i.pivotCols,pivotMode:i.pivotMode,groupKeys:this.parentNode.getGroupKeys(),filterModel:i.filterModel,sortModel:i.sortModel},s=function(){for(var o=0;o<t-e;o++)r.loadingNodes.delete(e+o)},a=function(o){r.rowNodeBlockLoader.loadComplete(),r.cache.onLoadSuccess(e,t-e,o),s()},d=function(){r.rowNodeBlockLoader.loadComplete(),r.cache.onLoadFailed(e,t-e),s()},l={request:n,successCallback:function(e,t){return a({rowData:e,rowCount:t})},success:a,failCallback:d,fail:d,parentNode:this.parentNode,api:this.api,columnApi:this.columnApi,context:this.gridOptionsService.get("context")};!function(){for(var o=0;o<t-e;o++)r.loadingNodes.add(e+o)}(),null===(o=this.cache.getSsrmParams().datasource)||void 0===o||o.getRows(l)},o.prototype.isBlockInViewport=function(e,t){var o=this.api.getFirstDisplayedRow(),r=this.api.getLastDisplayedRow();return e<=o&&t>=r||t>o&&t<r||e>o&&e<r},o.prototype.getNextBlockToLoad=function(){var e=this,t=this.getNodeRanges(),o=Object.entries(t);if(0===o.length)return null;var r=this.api.getFirstDisplayedRow();return o.sort((function(t,o){var i=D(t,2),n=i[0],s=i[1],a=D(o,2),d=a[0],l=a[1],u=e.isBlockInViewport(Number(n),s),c=e.isBlockInViewport(Number(d),l);return u?-1:c?1:Math.abs(r-Number(n))-Math.abs(r-Number(d))})),o[0]},o.prototype.queueLoadAction=function(){var e,t=this,o=this.getNextBlockToLoad();if(!o)return window.clearTimeout(this.loaderTimeout),this.loaderTimeout=void 0,void(this.nextBlockToLoad=void 0);if(!this.nextBlockToLoad||this.nextBlockToLoad[0]!==o[0]&&this.nextBlockToLoad[1]!==o[1]){this.nextBlockToLoad=o,window.clearTimeout(this.loaderTimeout);var r=D(this.nextBlockToLoad,2),i=r[0],n=r[1],s=Number(i);this.loaderTimeout=window.setTimeout((function(){t.loaderTimeout=void 0,t.attemptLoad(s,n),t.nextBlockToLoad=void 0}),null!==(e=this.gridOptionsService.getNum("blockLoadDebounceMillis"))&&void 0!==e?e:0)}},o.prototype.attemptLoad=function(e,t){var o=this.rowNodeBlockLoader.getAvailableLoadingCount();null!=o&&0===o||(this.rowNodeBlockLoader.registerLoads(1),this.executeLoad(e,t),this.queueLoadAction())},o.prototype.getBlockSize=function(){return this.storeParams.cacheBlockSize||o.DEFAULT_BLOCK_SIZE},o.prototype.getBlockStartIndexForIndex=function(e){return e-e%this.getBlockSize()},o.prototype.getBlockBoundsForIndex=function(e){var t=this.getBlockStartIndexForIndex(e);return[t,t+this.getBlockSize()]},o.DEFAULT_BLOCK_SIZE=100,M([t.Autowired("gridApi")],o.prototype,"api",void 0),M([t.Autowired("columnApi")],o.prototype,"columnApi",void 0),M([t.Autowired("rowNodeBlockLoader")],o.prototype,"rowNodeBlockLoader",void 0),M([t.PostConstruct],o.prototype,"init",null),o}(t.BeanStub),T=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),k=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},L=function(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var r,i,n=o.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=n.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(i)throw i.error}}return s},B=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(L(arguments[t]));return e},G=function(e){function o(t,o,r){var i=e.call(this)||this;return i.live=!0,i.store=t,i.numberOfRows=o,i.isLastRowKnown=!1,i.storeParams=r,i}return T(o,e),o.prototype.init=function(){this.nodeIndexMap={},this.nodeIds=new Set,this.defaultNodeIdPrefix=this.blockUtils.createNodeIdPrefix(this.store.getParentNode()),this.rowLoader=this.createManagedBean(new P(this,this.store.getParentNode(),this.storeParams))},o.prototype.destroyRowNodes=function(){this.numberOfRows=0,this.blockUtils.destroyRowNodes(this.getAllNodes()),this.nodeIndexMap={},this.nodeIds.clear(),this.live=!1},o.prototype.getRowByDisplayIndex=function(e){var t;if(this.store.isDisplayIndexInStore(e)){for(var o,r=this.getNodeMapEntries(),i=0;i<r.length;i++){var n=L(r[i],2),s=n[0],a=n[1];if(a.rowIndex===e)return(a.stub||a.__needsRefreshWhenVisible)&&this.rowLoader.queueLoadAction(),a;var d=a.master&&a.expanded,l=a.detailNode;if(d&&l&&l.rowIndex===e)return l;if(null===(t=a.childStore)||void 0===t?void 0:t.isDisplayIndexInStore(e))return a.childStore.getRowUsingDisplayIndex(e);if(a.rowIndex>e){o=s;break}}if(null==o){var u=this.store.getRowCount()-(this.store.getDisplayIndexEnd()-e);return this.createStubNode(u,e)}var c=Number(o),p=c-(this.nodeIndexMap[c].rowIndex-e);return this.createStubNode(p,e)}},o.prototype.createStubNode=function(e,t){var o=this.store.getRowBounds(t);return this.createRowAtIndex(e,null,(function(e){e.setRowIndex(t),e.setRowTop(o.rowTop)}))},o.prototype.getRowByStoreIndex=function(e){return this.nodeIndexMap[e]},o.prototype.skipDisplayIndexes=function(e,t,o){var r=this.gridOptionsService.getRowHeightAsNumber();t.skip(e),o.value+=e*r},o.prototype.setDisplayIndexes=function(e,t){var o=this,r=this.getNodeMapEntries(),i=-1;r.forEach((function(r){var n=L(r,2),s=n[0],a=n[1],d=Number(s),l=d-1-i;o.skipDisplayIndexes(l,e,t),o.blockUtils.setDisplayIndex(a,e,t),i=d}));var n=this.numberOfRows-1-i;this.skipDisplayIndexes(n,e,t),this.purgeExcessRows()},o.prototype.getRowCount=function(){return this.numberOfRows},o.prototype.getNodeMapEntries=function(){return Object.entries(this.nodeIndexMap)},o.prototype.getAllNodes=function(){return Object.values(this.nodeIndexMap)},o.prototype.getDisplayIndexFromStoreIndex=function(e){var t,o=this.nodeIndexMap[e],r=this.store.getDisplayIndexStart();if(null==r)return null;if(o&&null!=o.rowIndex)return o.rowIndex;for(var i=this.getNodeMapEntries(),n=void 0,s=-1,a=0;a<i.length;a++){var d=L(i[a],2),l=d[0],u=d[1],c=Number(l);if(c>e)break;n=u,s=c}if(null==n)return r+e;var p=e-s,h=null===(t=n.childStore)||void 0===t?void 0:t.getDisplayIndexEnd();return null!=h?h+p-1:null!=n.rowIndex?n.rowIndex+p:r+e},o.prototype.createRowAtIndex=function(e,t,o){var r=this,i=this.isUsingRowIds(),n=this.nodeIndexMap[e];if(n){if(n.__needsRefresh=!1,n.__needsRefreshWhenVisible=!1,this.doesNodeMatch(t,n))return this.blockUtils.updateDataIntoRowNode(n,t),n;if(!i&&n.group&&n.expanded)return n;this.destroyRowAtIndex(e)}if(t&&i){var s=this.getNodeMapEntries().find((function(e){var o=L(e,2);o[0];var i=o[1];return r.doesNodeMatch(t,i)}));if(s){var a=L(s,2),d=a[0],l=a[1],u=Number(d);return this.blockUtils.updateDataIntoRowNode(l,t),delete this.nodeIndexMap[u],this.nodeIndexMap[e]=l,this.markBlockForVerify(u),l}}var c=this.blockUtils.createRowNode(this.store.getRowDetails());if(null!=t){var p=this.getPrefixedId(this.store.getIdSequence().next());this.blockUtils.setDataIntoRowNode(c,t,p,void 0),this.blockUtils.checkOpenByDefault(c),this.nodeManager.addRowNode(c),this.nodeIds.add(c.id)}return this.nodeIndexMap[e]=c,o&&o(c),c.stub&&this.rowLoader.queueLoadAction(),c},o.prototype.destroyRowAtIndex=function(e){var t=this.nodeIndexMap[e];this.nodeIds.delete(t.id),this.blockUtils.destroyRowNode(t),delete this.nodeIndexMap[e]},o.prototype.getSsrmParams=function(){return this.store.getSsrmParams()},o.prototype.getPrefixedId=function(e){return this.defaultNodeIdPrefix?this.defaultNodeIdPrefix+"-"+e:e.toString()},o.prototype.markBlockForVerify=function(e){for(var t=L(this.rowLoader.getBlockBoundsForIndex(e),2),o=t[0],r=t[1],i=o;i<r;i++){var n=this.nodeIndexMap[i];n&&(n.__needsRefreshWhenVisible=!0)}},o.prototype.doesNodeMatch=function(e,t){if(t.stub)return!1;if(this.isUsingRowIds()){var o=this.getRowId(e);return t.id===o}return t.data===e},o.prototype.purgeStubsOutsideOfViewport=function(){var e=this,t=this.api.getFirstDisplayedRow(),o=this.api.getLastDisplayedRow(),r=this.rowLoader.getBlockStartIndexForIndex(t),i=L(this.rowLoader.getBlockBoundsForIndex(o),2);i[0];var n=i[1];this.getNodeMapEntries().forEach((function(t){var o=L(t,2),i=o[0],s=o[1],a=Number(i);e.rowLoader.isRowLoading(a)||s.stub&&(a<r||a>n)&&e.destroyRowAtIndex(a)}))},o.prototype.getNumberOfRowsToRetain=function(e,t){var o=this.storeParams.maxBlocksInCache;if(null==o)return null;var r=this.rowLoader.getBlockSize(),i=Math.ceil((t-e)/r);return Math.max(o,i)*r},o.prototype.getBlocksDistanceFromRow=function(e,t){var o=this,r={};return e.forEach((function(e){var i=L(e,2),n=i[0],s=i[1],a=L(o.rowLoader.getBlockBoundsForIndex(Number(n)),2),d=a[0],l=a[1];if(!(d in r)){var u,c=Math.abs(s.rowIndex-t);o.nodeIndexMap[l-1]&&(u=Math.abs(o.nodeIndexMap[l-1].rowIndex-t));var p=null==u||c>u?c:u;r[d]=p}})),Object.entries(r)},o.prototype.purgeExcessRows=function(){var e=this;this.purgeStubsOutsideOfViewport();var t=this.api.getFirstDisplayedRow(),o=this.api.getLastDisplayedRow(),r=this.rowLoader.getBlockStartIndexForIndex(t),i=L(this.rowLoader.getBlockBoundsForIndex(o),2);i[0];var n=i[1],s=this.getNumberOfRowsToRetain(r,n);if(null!=this.store.getDisplayIndexEnd()&&null!=s){var a=this.getNodeMapEntries().filter((function(t){var o=L(t,2);o[0];var r=o[1];return!r.stub&&!e.isNodeCached(r)}));if(!(a.length<=s)){var d=t+(o-t)/2,l=this.getBlocksDistanceFromRow(a,d),u=this.rowLoader.getBlockSize(),c=Math.ceil(s/u);if(!(l.length<=c)){l.sort((function(e,t){return Math.sign(t[1]-e[1])}));for(var p=l.length-c,h=0;h<p;h++)for(var f=Number(l[h][0]),v=f;v<f+u;v++){var w=this.nodeIndexMap[v];w&&!this.isNodeCached(w)&&this.destroyRowAtIndex(v)}}}}},o.prototype.isNodeFocused=function(e){var t=this.focusService.getFocusCellToUseAfterRefresh();return!!t&&(null==t.rowPinned&&t.rowIndex===e.rowIndex)},o.prototype.isNodeCached=function(e){return!!e.group&&e.expanded||this.isNodeFocused(e)},o.prototype.extractDuplicateIds=function(e){var t=this;if(!this.isUsingRowIds())return[];var o=new Set,r=new Set;return e.forEach((function(e){var i=t.getRowId(e);o.has(i)?r.add(i):o.add(i)})),B(r)},o.prototype.onLoadSuccess=function(e,t,o){var r=this;if(this.live){if(this.isUsingRowIds()){var i=this.extractDuplicateIds(o.rowData);if(i.length>0){var n=i.join(", ");return console.warn("AG Grid: Unable to display rows as duplicate row ids ("+n+") were returned by the getRowId callback. Please modify the getRowId callback to provide unique ids."),void this.onLoadFailed(e,t)}}if(o.rowData.forEach((function(t,o){var i=e+o,n=r.nodeIndexMap[i];if(!(null==n?void 0:n.stub))return n&&r.doesNodeMatch(t,n)?(r.blockUtils.updateDataIntoRowNode(n,t),n.__needsRefresh=!1,void(n.__needsRefreshWhenVisible=!1)):void r.createRowAtIndex(i,t);r.createRowAtIndex(i,t)})),null!=o.rowCount&&-1!==o.rowCount)this.numberOfRows=o.rowCount,this.isLastRowKnown=!0;else if(t>o.rowData.length)this.numberOfRows=e+o.rowData.length,this.isLastRowKnown=!0;else if(!this.isLastRowKnown){var s=e+o.rowData.length+1;s>this.numberOfRows&&(this.numberOfRows=s)}if(this.isLastRowKnown)for(var a=this.getNodeMapEntries(),d=a.length-1;d>=0;d--){var l=Number(a[d][0]);if(l<this.numberOfRows)break;this.destroyRowAtIndex(l)}this.fireStoreUpdatedEvent()}},o.prototype.isLastRowIndexKnown=function(){return this.isLastRowKnown},o.prototype.onLoadFailed=function(e,t){if(this.live){for(var o=e;o<e+t;o++){var r=this.nodeIndexMap[o];r&&(r.failedLoad=!0)}this.fireStoreUpdatedEvent()}},o.prototype.markNodesForRefresh=function(){this.getAllNodes().forEach((function(e){return e.__needsRefresh=!0})),this.rowLoader.queueLoadAction()},o.prototype.isNodeInCache=function(e){return this.nodeIds.has(e)},o.prototype.fireStoreUpdatedEvent=function(){this.live&&this.store.fireStoreUpdatedEvent()},o.prototype.isUsingRowIds=function(){return null!=this.gridOptionsService.getRowIdFunc()},o.prototype.getRowId=function(e){var t=this.gridOptionsService.getRowIdFunc();if(null==t)return null;var o=this.store.getRowDetails().level,r=this.store.getParentNode().getGroupKeys(),i=t({data:e,parentKeys:r.length>0?r:void 0,level:o});return String(i)},o.prototype.lookupRowNode=function(e){var t;if(!this.isUsingRowIds())throw new Error("AG Grid: Insert transactions can only be applied when row ids are supplied.");var o=this.getRowId(e);return null!==(t=this.getAllNodes().find((function(e){return e.id===o})))&&void 0!==t?t:null},o.prototype.updateRowNodes=function(e){var t=this,o=[];return e.forEach((function(e){var r=t.lookupRowNode(e);r&&(t.blockUtils.updateDataIntoRowNode(r,e),o.push(r))})),o},o.prototype.insertRowNodes=function(e,t){var o=this,r=null==t&&this.isLastRowKnown?this.store.getRowCount():t;if(null==r||this.store.getRowCount()<r)return[];if(!this.isUsingRowIds())throw new Error("AG Grid: Insert transactions can only be applied when row ids are supplied.");var i={};e.forEach((function(e){var t=o.getRowId(e);t&&o.isNodeInCache(t)||(i[t]=e)}));var n=Object.values(i),s=n.length;if(0===s)return[];for(var a=this.getNodeMapEntries(),d=a.length-1;d>=0;d--){var l=L(a[d],2),u=l[0],c=l[1],p=Number(u);if(p<r)break;var h=p+s;if(this.getRowByStoreIndex(h))throw new Error("Ag Grid: Something went wrong, node in wrong place.");this.nodeIndexMap[p+s]=c,delete this.nodeIndexMap[p]}return this.numberOfRows+=s,n.map((function(e,t){return o.createRowAtIndex(r+t,e)}))},o.prototype.removeRowNodes=function(e){if(!this.isUsingRowIds())throw new Error("AG Grid: Insert transactions can only be applied when row ids are supplied.");for(var t=[],o=this.getNodeMapEntries(),r=0,i=B(e),n=[],s=function(e){var s=L(o[e],2),d=s[0],l=s[1],u=i.findIndex((function(e){return e===l.id}));if(-1!==u)return i.splice(u,1),a.destroyRowAtIndex(Number(d)),t.push(l),r+=1,"continue";if(0===r)return"continue";var c=Number(d);e!==c&&n.push(l),a.nodeIndexMap[c-r]=a.nodeIndexMap[c],delete a.nodeIndexMap[c]},a=this,d=0;d<o.length;d++)s(d);return this.numberOfRows-=r,i.length>0&&n.length>0&&(n.forEach((function(e){return e.__needsRefreshWhenVisible=!0})),this.rowLoader.queueLoadAction()),t},k([t.Autowired("gridApi")],o.prototype,"api",void 0),k([t.Autowired("ssrmBlockUtils")],o.prototype,"blockUtils",void 0),k([t.Autowired("focusService")],o.prototype,"focusService",void 0),k([t.Autowired("ssrmNodeManager")],o.prototype,"nodeManager",void 0),k([t.PostConstruct],o.prototype,"init",null),k([t.PreDestroy],o.prototype,"destroyRowNodes",null),o}(t.BeanStub),U=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),F=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},j=function(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var r,i,n=o.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=n.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(i)throw i.error}}return s},V=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(j(arguments[t]));return e},H=function(e){function o(o,r,i){var n=e.call(this)||this;return n.idSequence=new t.NumberSequence,n.ssrmParams=o,n.parentRowNode=i,n.storeParams=r,n.level=i.level+1,n.group=!!o.rowGroupCols&&n.level<o.rowGroupCols.length,n.leafGroup=!!o.rowGroupCols&&n.level===o.rowGroupCols.length-1,n}return U(o,e),o.prototype.init=function(){var e=1;if(0===this.level&&(e=this.storeUtils.getServerSideInitialRowCount()),this.cache=this.createManagedBean(new G(this,e,this.storeParams)),!this.gridOptionsService.isTreeData()&&this.group){var t=this.ssrmParams.rowGroupCols[this.level];this.groupField=t.field,this.rowGroupColumn=this.columnModel.getRowGroupColumns()[this.level]}},o.prototype.destroyRowNodes=function(){this.displayIndexStart=void 0,this.displayIndexEnd=void 0,this.destroyBean(this.cache)},o.prototype.applyTransaction=function(e){var o,r,i,n=this,s=this.gridOptionsService.getRowIdFunc();if(!s)return console.warn("AG Grid: getRowId callback must be implemented for transactions to work. Transaction was ignored."),{status:t.ServerSideTransactionResultStatus.Cancelled};var a=this.gridOptionsService.getCallback("isApplyServerSideTransaction");if(a&&!a({transaction:e,parentNode:this.parentRowNode,storeInfo:this.info,groupLevelInfo:this.info}))return{status:t.ServerSideTransactionResultStatus.Cancelled};var d=void 0;(null===(o=e.update)||void 0===o?void 0:o.length)&&(d=this.cache.updateRowNodes(e.update));var l=void 0;(null===(r=e.add)||void 0===r?void 0:r.length)&&(l=this.cache.insertRowNodes(e.add,e.addIndex));var u=void 0;if(null===(i=e.remove)||void 0===i?void 0:i.length){var c=e.remove.map((function(e){return s({level:n.level,parentKeys:n.parentRowNode.getGroupKeys(),data:e})})),p=V(new Set(c));u=this.cache.removeRowNodes(p)}return this.updateSelectionAfterTransaction(d,u),{status:t.ServerSideTransactionResultStatus.Applied,update:d,add:l,remove:u}},o.prototype.updateSelectionAfterTransaction=function(e,o){var r=!1;if(null==e||e.forEach((function(e){e.isSelected()&&!e.selectable&&(e.setSelected(!1,!1,!0,"rowDataChanged"),r=!0)})),null==o||o.forEach((function(e){e.isSelected()&&(e.setSelected(!1,!1,!0,"rowDataChanged"),r=!0)})),r){var i={type:t.Events.EVENT_SELECTION_CHANGED,source:"rowDataChanged"};this.eventService.dispatchEvent(i)}},o.prototype.clearDisplayIndexes=function(){var e=this;this.displayIndexStart=void 0,this.displayIndexEnd=void 0,this.cache.getAllNodes().forEach((function(t){return e.blockUtils.clearDisplayIndex(t)}))},o.prototype.getDisplayIndexStart=function(){return this.displayIndexStart},o.prototype.getDisplayIndexEnd=function(){return this.displayIndexEnd},o.prototype.getRowCount=function(){return this.cache.getRowCount()},o.prototype.isDisplayIndexInStore=function(e){return 0!==this.cache.getRowCount()&&(this.displayIndexStart<=e&&e<this.getDisplayIndexEnd())},o.prototype.setDisplayIndexes=function(e,t){this.displayIndexStart=e.peek(),this.topPx=t.value,this.cache.setDisplayIndexes(e,t),this.displayIndexEnd=e.peek(),this.heightPx=t.value-this.topPx},o.prototype.forEachNodeDeep=function(e,o){void 0===o&&(o=new t.NumberSequence),this.cache.getAllNodes().forEach((function(t){e(t,o.next());var r=t.childStore;r&&r.forEachNodeDeep(e,o)}))},o.prototype.forEachNodeDeepAfterFilterAndSort=function(e,o){void 0===o&&(o=new t.NumberSequence),this.cache.getAllNodes().forEach((function(t){e(t,o.next());var r=t.childStore;r&&r.forEachNodeDeepAfterFilterAndSort(e,o)}))},o.prototype.retryLoads=function(){this.cache.getAllNodes().forEach((function(e){e.failedLoad&&(e.failedLoad=!1,e.__needsRefreshWhenVisible=!0,e.stub=!0)})),this.forEachChildStoreShallow((function(e){return e.retryLoads()})),this.fireStoreUpdatedEvent()},o.prototype.getRowUsingDisplayIndex=function(e){return this.cache.getRowByDisplayIndex(e)},o.prototype.getRowBounds=function(e){if(!this.isDisplayIndexInStore(e))return null;for(var t=this.cache.getAllNodes(),o=null,r=null,i=0;i<t.length;i++){var n=t[i];if(n.rowIndex>e){r=n;break}o=n}if(o){var s=this.blockUtils.extractRowBounds(o,e);if(null!=s)return s}var a=this.gridOptionsService.getRowHeightAsNumber();if(r){var d=Math.floor((r.rowIndex-e)*a);return{rowTop:r.rowTop-d,rowHeight:a}}return{rowTop:this.topPx+this.heightPx-Math.floor((this.getDisplayIndexEnd()-e)*a),rowHeight:a}},o.prototype.isPixelInRange=function(e){return e>=this.topPx&&e<this.topPx+this.heightPx},o.prototype.getRowIndexAtPixel=function(e){if(e<this.topPx)return this.getDisplayIndexStart();if(e>=this.topPx+this.heightPx)return this.getDisplayIndexEnd()-1;for(var t=this.cache.getAllNodes(),o=null,r=null,i=0;i<t.length;i++){var n=t[i];if(n.rowTop>e){r=n;break}o=n}if(o){var s=this.blockUtils.getIndexAtPixel(o,e);if(null!=s)return s}var a=this.gridOptionsService.getRowHeightAsNumber();if(r){var d=r.rowTop,l=Math.ceil((d-e)/a);return r.rowIndex-l}var u=this.topPx+this.heightPx,c=Math.floor((u-e)/a);return this.getDisplayIndexEnd()-c},o.prototype.getChildStore=function(e){var t=this;return this.storeUtils.getChildStore(e,this,(function(e){return t.cache.getAllNodes().find((function(t){return t.key==e}))}))},o.prototype.forEachChildStoreShallow=function(e){this.cache.getAllNodes().forEach((function(t){t.childStore&&e(t.childStore)}))},o.prototype.refreshAfterSort=function(e){if(this.storeUtils.isServerSideSortAllLevels()||this.storeUtils.isServerRefreshNeeded(this.parentRowNode,this.ssrmParams.rowGroupCols,e)){var t=this.cache.getRowCount();return this.destroyBean(this.cache),this.cache=this.createManagedBean(new G(this,t,this.storeParams)),void this.fireStoreUpdatedEvent()}this.forEachChildStoreShallow((function(t){return t.refreshAfterSort(e)}))},o.prototype.refreshAfterFilter=function(e){this.storeUtils.isServerSideFilterAllLevels()||this.storeUtils.isServerRefreshNeeded(this.parentRowNode,this.ssrmParams.rowGroupCols,e)?this.refreshStore(!0):this.forEachChildStoreShallow((function(t){return t.refreshAfterFilter(e)}))},o.prototype.refreshStore=function(e){if(e)return this.destroyBean(this.cache),this.cache=this.createManagedBean(new G(this,1,this.storeParams)),void this.fireStoreUpdatedEvent();this.cache.markNodesForRefresh()},o.prototype.getTopLevelRowDisplayedIndex=function(e){var t=this.cache.getDisplayIndexFromStoreIndex(e);return null!=t?t:e},o.prototype.isLastRowIndexKnown=function(){return this.cache.isLastRowIndexKnown()},o.prototype.getRowNodesInRange=function(e,o){var r=[],i=!1;return t._.missing(e)&&(i=!0),this.cache.getAllNodes().forEach((function(t){var n=t===e||t===o;(i||n)&&r.push(t),n&&(i=!i)})),i?[]:r},o.prototype.addStoreStates=function(e){e.push({suppressInfiniteScroll:!1,route:this.parentRowNode.getGroupKeys(),rowCount:this.getRowCount(),info:this.info}),this.forEachChildStoreShallow((function(t){return t.addStoreStates(e)}))},o.prototype.getIdSequence=function(){return this.idSequence},o.prototype.getParentNode=function(){return this.parentRowNode},o.prototype.getRowDetails=function(){return{field:this.groupField,group:this.group,leafGroup:this.leafGroup,level:this.level,parent:this.parentRowNode,rowGroupColumn:this.rowGroupColumn}},o.prototype.getSsrmParams=function(){return this.ssrmParams},o.prototype.setStoreInfo=function(e){this.info=e},o.prototype.fireStoreUpdatedEvent=function(){var e={type:t.Events.EVENT_STORE_UPDATED};this.eventService.dispatchEvent(e)},F([t.Autowired("ssrmBlockUtils")],o.prototype,"blockUtils",void 0),F([t.Autowired("ssrmStoreUtils")],o.prototype,"storeUtils",void 0),F([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),F([t.PostConstruct],o.prototype,"init",null),F([t.PreDestroy],o.prototype,"destroyRowNodes",null),o}(t.BeanStub),K=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},q=function(){function e(){}return e.prototype.createStore=function(e,t){var o=this.getStoreParams(e,t);return new(o.suppressInfiniteScroll?O:H)(e,o,t)},e.prototype.getStoreParams=function(e,t){var o=this.getLevelSpecificParams(t),r=this.isInfiniteScroll(o);return{suppressInfiniteScroll:!r,cacheBlockSize:this.getBlockSize(r,o),maxBlocksInCache:this.getMaxBlocksInCache(r,e,o)}},e.prototype.getMaxBlocksInCache=function(e,o,r){if(e){var i=r&&null!=r.maxBlocksInCache?r.maxBlocksInCache:this.gridOptionsService.getNum("maxBlocksInCache");if(null!=i&&i>=0)if(o.dynamicRowHeight){t._.doOnce((function(){return console.warn("AG Grid: Server Side Row Model does not support Dynamic Row Height and Cache Purging. Either a) remove getRowHeight() callback or b) remove maxBlocksInCache property. Purging has been disabled.")}),"storeFactory.maxBlocksInCache.dynamicRowHeight")}else{if(!this.columnModel.isAutoRowHeightActive())return i;t._.doOnce((function(){return console.warn("AG Grid: Server Side Row Model does not support Auto Row Height and Cache Purging. Either a) remove colDef.autoHeight or b) remove maxBlocksInCache property. Purging has been disabled.")}),"storeFactory.maxBlocksInCache.autoRowHeightActive")}}},e.prototype.getBlockSize=function(e,t){if(e){var o=t&&null!=t.cacheBlockSize?t.cacheBlockSize:this.gridOptionsService.getNum("cacheBlockSize");return null!=o&&o>0?o:100}},e.prototype.getLevelSpecificParams=function(e){var t=this.gridOptionsService.getCallback("getServerSideGroupLevelParams");if(t){var o=t({level:e.level+1,parentRowNode:e.level>=0?e:void 0,rowGroupColumns:this.columnModel.getRowGroupColumns(),pivotColumns:this.columnModel.getPivotColumns(),pivotMode:this.columnModel.isPivotMode()});return null!=o.storeType&&(o.suppressInfiniteScroll="partial"!==o.storeType),o}},e.prototype.isInfiniteScroll=function(e){return!(e&&null!=e.suppressInfiniteScroll?e.suppressInfiniteScroll:this.isSuppressServerSideInfiniteScroll())},e.prototype.isSuppressServerSideInfiniteScroll=function(){return this.gridOptionsService.is("suppressServerSideInfiniteScroll")},K([t.Autowired("gridOptionsService")],e.prototype,"gridOptionsService",void 0),K([t.Autowired("columnModel")],e.prototype,"columnModel",void 0),e=K([t.Bean("ssrmStoreFactory")],e)}(),W=function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},z=function(){function e(){}return e.prototype.isSortingWithValueColumn=function(e){for(var t=this.columnModel.getValueColumns().map((function(e){return e.getColId()})),o=0;o<e.length;o++)if(t.indexOf(e[o])>-1)return!0;return!1},e.prototype.isSortingWithSecondaryColumn=function(e){if(!this.columnModel.getSecondaryColumns())return!1;for(var t=this.columnModel.getSecondaryColumns().map((function(e){return e.getColId()})),o=0;o<e.length;o++)if(t.indexOf(e[o])>-1)return!0;return!1},W([t.Autowired("columnModel")],e.prototype,"columnModel",void 0),e=W([t.Bean("ssrmListenerUtils")],e)}(),J={version:"29.0.0",moduleName:t.ModuleNames.ServerSideRowModelModule,rowModels:{serverSide:n},beans:[S,m,d,c,h,w,A,q,z],dependantModules:[o.EnterpriseCoreModule]};exports.ServerSideRowModelModule=J;