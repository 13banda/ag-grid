/**
 * @ag-grid-enterprise/rich-select - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.1.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */

/**
 * @ag-grid-enterprise/rich-select - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components * @version v26.1.0
 * @link http://www.ag-grid.com/
' * @license Commercial
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("@ag-grid-community/core"),r=require("@ag-grid-enterprise/core"),i=(e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)},function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}),o=function(e,t,r,i){var o,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(n<3?o(s):n>3?o(t,r,s):o(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},n=function(e){function r(t){var r=e.call(this,'<div class="ag-rich-select-row"></div>')||this;return r.params=t,r}return i(r,e),r.prototype.setState=function(e,r,i){this.populateWithRenderer(e,r)||this.populateWithoutRenderer(e,r),t._.addOrRemoveCssClass(this.getGui(),"ag-rich-select-row-selected",i)},r.prototype.populateWithoutRenderer=function(e,r){var i=null!=r?r:e;t._.exists(i)&&""!==i?this.getGui().textContent=i.toString():this.getGui().innerHTML="&nbsp;"},r.prototype.populateWithRenderer=function(e,r){var i=this,o={value:e,valueFormatted:r,api:this.gridOptionsWrapper.getApi()},n=this.userComponentFactory.newCellRenderer(this.params,o);return null!=n?t._.bindCellRendererToHtmlElement(n,this.getGui()):this.getGui().innerText=null!=o.valueFormatted?o.valueFormatted:o.value,!!n&&(n.then((function(e){i.addDestroyFunc((function(){i.getContext().destroyBean(e)}))})),!0)},o([t.Autowired("userComponentFactory")],r.prototype,"userComponentFactory",void 0),r}(t.Component),s=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),a=function(e,t,r,i){var o,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(n<3?o(s):n>3?o(t,r,s):o(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},c=function(e){function r(){var t=e.call(this,r.TEMPLATE)||this;return t.selectionConfirmed=!1,t.searchString="",t}return s(r,e),r.prototype.init=function(e){this.params=e,this.selectedValue=e.value,this.originalSelectedValue=e.value,this.focusAfterAttached=e.cellStartedEdit;var r=t._.createIconNoSpan("smallDown",this.gridOptionsWrapper);if(t._.addCssClass(r,"ag-rich-select-value-icon"),this.eValue.appendChild(r),this.virtualList=this.getContext().createBean(new t.VirtualList("rich-select")),this.virtualList.setComponentCreator(this.createRowComponent.bind(this)),this.eList.appendChild(this.virtualList.getGui()),t._.exists(this.params.cellHeight)&&this.virtualList.setRowHeight(this.params.cellHeight),this.renderSelectedValue(),t._.missing(e.values))console.warn("AG Grid: richSelectCellEditor requires values for it to work");else{var i=e.values;this.virtualList.setModel({getRowCount:function(){return i.length},getRow:function(e){return i[e]}}),this.addGuiEventListener("keydown",this.onKeyDown.bind(this));var o=this.virtualList.getGui();this.addManagedListener(o,"click",this.onClick.bind(this)),this.addManagedListener(o,"mousemove",this.onMouseMove.bind(this));var n=t._.exists(e.searchDebounceDelay)?e.searchDebounceDelay:300;this.clearSearchString=t._.debounce(this.clearSearchString,n),t._.exists(e.charPress)&&this.searchText(e.charPress)}},r.prototype.onKeyDown=function(e){var r=e.keyCode;switch(e.preventDefault(),r){case t.KeyCode.ENTER:this.onEnterKeyDown();break;case t.KeyCode.TAB:this.confirmSelection();break;case t.KeyCode.DOWN:case t.KeyCode.UP:this.onNavigationKeyPressed(e,r);break;default:this.searchText(e)}},r.prototype.confirmSelection=function(){this.selectionConfirmed=!0},r.prototype.onEnterKeyDown=function(){this.confirmSelection(),this.params.stopEditing()},r.prototype.onNavigationKeyPressed=function(e,r){e.preventDefault();var i=this.params.values.indexOf(this.selectedValue),o=r===t.KeyCode.UP?i-1:i+1;if(o>=0&&o<this.params.values.length){var n=this.params.values[o];this.setSelectedValue(n)}},r.prototype.searchText=function(e){if("string"==typeof e)this.searchString+=e,this.runSearch(),this.clearSearchString();else{var r=e.keyCode,i=e.key;if(r===t.KeyCode.BACKSPACE)this.searchString=this.searchString.slice(0,-1),i="";else if(!t._.isEventFromPrintableCharacter(e))return;this.searchText(i)}},r.prototype.runSearch=function(){var e,r=this,i=this.params.values;if("number"!=typeof i[0]&&"string"!=typeof i[0]||(e=i.map(String)),"object"==typeof i[0]&&this.params.colDef.keyCreator&&(e=i.map((function(e){var t={value:e,colDef:r.params.colDef,column:r.params.column,node:r.params.node,data:r.params.data,api:r.gridOptionsWrapper.getApi(),columnApi:r.gridOptionsWrapper.getColumnApi(),context:r.gridOptionsWrapper.getContext()};return r.params.colDef.keyCreator(t)}))),e){var o=t._.fuzzySuggestions(this.searchString,e,!0,!0)[0];if(o){var n=i[e.indexOf(o)];this.setSelectedValue(n)}}},r.prototype.clearSearchString=function(){this.searchString=""},r.prototype.renderSelectedValue=function(){var e=this,r=this.params.formatValue(this.selectedValue),i=this.eValue,o={value:this.selectedValue,valueFormatted:r,api:this.gridOptionsWrapper.getApi()},n=this.userComponentFactory.newCellRenderer(this.params,o);t._.exists(n)?(t._.bindCellRendererToHtmlElement(n,i),n.then((function(t){e.addDestroyFunc((function(){return e.getContext().destroyBean(t)}))}))):t._.exists(this.selectedValue)?i.innerHTML=r:t._.clearElement(i)},r.prototype.setSelectedValue=function(e){if(this.selectedValue!==e){var t=this.params.values.indexOf(e);-1!==t&&(this.selectedValue=e,this.virtualList.ensureIndexVisible(t),this.virtualList.refresh())}},r.prototype.createRowComponent=function(e){var t=this.params.formatValue(e),r=new n(this.params);return this.getContext().createBean(r),r.setState(e,t,e===this.selectedValue),r},r.prototype.onMouseMove=function(e){var t=this.virtualList.getGui().getBoundingClientRect(),r=this.virtualList.getScrollTop(),i=e.clientY-t.top+r,o=Math.floor(i/this.virtualList.getRowHeight()),n=this.params.values[o];void 0!==n&&this.setSelectedValue(n)},r.prototype.onClick=function(){this.confirmSelection(),this.params.stopEditing()},r.prototype.afterGuiAttached=function(){var e=this.params.values.indexOf(this.selectedValue);this.virtualList.refresh(),e>=0&&this.virtualList.ensureIndexVisible(e),this.virtualList.refresh(),this.focusAfterAttached&&this.getGui().focus()},r.prototype.getValue=function(){return this.selectionConfirmed?this.selectedValue:this.originalSelectedValue},r.TEMPLATE='<div class="ag-rich-select" tabindex="-1">\n            <div ref="eValue" class="ag-rich-select-value"></div>\n            <div ref="eList" class="ag-rich-select-list"></div>\n        </div>',a([t.Autowired("userComponentFactory")],r.prototype,"userComponentFactory",void 0),a([t.RefSelector("eValue")],r.prototype,"eValue",void 0),a([t.RefSelector("eList")],r.prototype,"eList",void 0),r}(t.PopupComponent),l={moduleName:t.ModuleNames.RichSelectModule,beans:[],userComponents:[{componentName:"agRichSelect",componentClass:c},{componentName:"agRichSelectCellEditor",componentClass:c}],dependantModules:[r.EnterpriseCoreModule]};exports.RichSelectModule=l;