/**
          * @ag-grid-enterprise/row-grouping - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v30.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
/**
          * @ag-grid-enterprise/row-grouping - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v30.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
import{Autowired as e,PostConstruct as t,Bean as o,BeanStub as i,_ as n,NumberSequence as r,RowNode as s,Optional as l,RefSelector as a,Component as u,Column as d,Events as c,KeyCode as h,DragSourceType as p,DragAndDropService as g,TouchListener as m,VirtualList as f,ManagedFocusFeature as v,PositionableFeature as C,TabGuardComp as G,AgSelect as y,AgPromise as F,AgInputTextField as A,ModuleNames as S}from"@ag-grid-community/core";import{EnterpriseCoreModule as D}from"@ag-grid-enterprise/core";var E=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};let N=class extends i{init(){this.alwaysAggregateAtRootLevel=this.gridOptionsService.is("alwaysAggregateAtRootLevel"),this.addManagedPropertyListener("alwaysAggregateAtRootLevel",e=>this.alwaysAggregateAtRootLevel=e.currentValue),this.groupIncludeTotalFooter=this.gridOptionsService.is("groupIncludeTotalFooter"),this.addManagedPropertyListener("groupIncludeTotalFooter",e=>this.groupIncludeTotalFooter=e.currentValue)}execute(e){const t=n.missingOrEmpty(this.columnModel.getValueColumns()),o=!this.gridOptionsService.getCallback("getGroupRowAgg"),i=e.changedPath&&e.changedPath.isActive();if(t&&o&&i)return;const r=this.createAggDetails(e);this.recursivelyCreateAggData(r)}createAggDetails(e){const t=this.columnModel.isPivotActive(),o=this.columnModel.getValueColumns(),i=t?this.columnModel.getPivotColumns():[];return{changedPath:e.changedPath,valueColumns:o,pivotColumns:i}}isSuppressAggFilteredOnly(){return void 0!==this.gridOptionsService.getGroupAggFiltering()||this.gridOptionsService.is("suppressAggFilteredOnly")}recursivelyCreateAggData(e){this.filteredOnly=!this.isSuppressAggFilteredOnly();e.changedPath.forEachChangedNodeDepthFirst(t=>{if(!t.hasChildren())return void(t.aggData&&t.setAggData(null));if(-1===t.level&&!this.groupIncludeTotalFooter){const e=!this.columnModel.isPivotMode();if(!this.alwaysAggregateAtRootLevel&&e)return}this.aggregateRowNode(t,e)},!0)}aggregateRowNode(e,t){const o=0===t.valueColumns.length,i=0===t.pivotColumns.length,n=this.gridOptionsService.getCallback("getGroupRowAgg");let r;if(n){r=n({nodes:e.childrenAfterFilter})}else r=o?null:i?this.aggregateRowNodeUsingValuesOnly(e,t):this.aggregateRowNodeUsingValuesAndPivot(e);e.setAggData(r),e.sibling&&e.sibling.setAggData(r)}aggregateRowNodeUsingValuesAndPivot(e){var t;const o={},i=null!==(t=this.columnModel.getSecondaryColumns())&&void 0!==t?t:[];return i.forEach(t=>{const{pivotValueColumn:i,pivotTotalColumnIds:r,colId:s,pivotKeys:l}=t.getColDef();if(n.exists(r))return;const a=null!=l?l:[];let u;u=e.leafGroup?this.getValuesFromMappedSet(e.childrenMapped,a,i):this.getValuesPivotNonLeaf(e,s),o[s]=this.aggregateValues(u,i.getAggFunc(),i,e,t)}),i.forEach(t=>{const{pivotValueColumn:i,pivotTotalColumnIds:r,colId:s}=t.getColDef();if(!n.exists(r))return;const l=[];r&&r.length&&(r.forEach(e=>{l.push(o[e])}),o[s]=this.aggregateValues(l,i.getAggFunc(),i,e,t))}),o}aggregateRowNodeUsingValuesOnly(e,t){const o={},i=t.changedPath.isActive()?t.changedPath.getValueColumnsForNode(e,t.valueColumns):t.valueColumns,n=t.changedPath.isActive()?t.changedPath.getNotValueColumnsForNode(e,t.valueColumns):null,r=this.getValuesNormal(e,i),s=e.aggData;return i.forEach((t,i)=>{o[t.getId()]=this.aggregateValues(r[i],t.getAggFunc(),t,e)}),n&&s&&n.forEach(e=>{o[e.getId()]=s[e.getId()]}),o}getValuesPivotNonLeaf(e,t){const o=[];return e.childrenAfterFilter.forEach(e=>{const i=e.aggData[t];o.push(i)}),o}getValuesFromMappedSet(e,t,o){let i=e;if(t.forEach(e=>i=i?i[e]:null),!i)return[];const n=[];return i.forEach(e=>{const t=this.valueService.getValue(o,e);n.push(t)}),n}getValuesNormal(e,t){const o=[];t.forEach(()=>o.push([]));const i=t.length,n=this.filteredOnly?e.childrenAfterFilter:e.childrenAfterGroup,r=n.length;for(let e=0;e<r;e++){const r=n[e];for(let e=0;e<i;e++){const i=t[e],n=this.valueService.getValue(i,r);o[e].push(n)}}return o}aggregateValues(e,t,o,i,n){const r="string"==typeof t?this.aggFuncService.getAggFunc(t):t;if("function"!=typeof r)return console.error("AG Grid: unrecognised aggregation function "+t),null;return r({values:e,column:o,colDef:o?o.getColDef():void 0,pivotResultColumn:n,rowNode:i,data:i?i.data:void 0,api:this.gridApi,columnApi:this.columnApi,context:this.gridOptionsService.context})}};E([e("columnModel")],N.prototype,"columnModel",void 0),E([e("valueService")],N.prototype,"valueService",void 0),E([e("aggFuncService")],N.prototype,"aggFuncService",void 0),E([e("gridApi")],N.prototype,"gridApi",void 0),E([e("columnApi")],N.prototype,"columnApi",void 0),E([t],N.prototype,"init",null),N=E([o("aggregationStage")],N);class O{constructor(){this.allSets={},this.allParents=[]}removeFromChildrenAfterGroup(e,t){this.getSet(e).removeFromChildrenAfterGroup[t.id]=!0}isRemoveFromAllLeafChildren(e,t){return!!this.getSet(e).removeFromAllLeafChildren[t.id]}preventRemoveFromAllLeafChildren(e,t){delete this.getSet(e).removeFromAllLeafChildren[t.id]}removeFromAllLeafChildren(e,t){this.getSet(e).removeFromAllLeafChildren[t.id]=!0}getSet(e){return this.allSets[e.id]||(this.allSets[e.id]={removeFromAllLeafChildren:{},removeFromChildrenAfterGroup:{}},this.allParents.push(e)),this.allSets[e.id]}getAllParents(){return this.allParents}flush(){this.allParents.forEach(e=>{const t=this.allSets[e.id];e.childrenAfterGroup=e.childrenAfterGroup.filter(e=>!t.removeFromChildrenAfterGroup[e.id]),e.allLeafChildren=e.allLeafChildren.filter(e=>!t.removeFromAllLeafChildren[e.id]),e.updateHasChildren(),e.sibling&&(e.sibling.childrenAfterGroup=e.childrenAfterGroup,e.sibling.allLeafChildren=e.allLeafChildren)}),this.allSets={},this.allParents.length=0}}var P=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};let T=class extends i{constructor(){super(...arguments),this.groupIdSequence=new r}postConstruct(){this.usingTreeData=this.gridOptionsService.isTreeData(),this.usingTreeData&&(this.getDataPath=this.gridOptionsService.get("getDataPath"))}execute(e){const t=this.createGroupingDetails(e);if(t.transactions)this.handleTransaction(t);else{const o=!0===e.afterColumnsChanged;this.shotgunResetEverything(t,o)}this.positionLeafsAndGroups(e.changedPath),this.orderGroups(t.rootNode),this.selectableService.updateSelectableAfterGrouping(t.rootNode)}positionLeafsAndGroups(e){this.usingTreeData||e.forEachChangedNodeDepthFirst(e=>{if(e.childrenAfterGroup){const t=[],o=[];let i;e.childrenAfterGroup.forEach(e=>{var n;(null===(n=e.childrenAfterGroup)||void 0===n?void 0:n.length)?""!==e.key||i?o.push(e):i=e:t.push(e)}),i&&o.push(i),e.childrenAfterGroup=[...t,...o]}},!1)}createGroupingDetails(e){const{rowNode:t,changedPath:o,rowNodeTransactions:i,rowNodeOrder:n}=e,r=this.usingTreeData?null:this.columnModel.getRowGroupColumns();return{includeParents:!this.gridOptionsService.is("suppressParentsInRowNodes"),expandByDefault:this.gridOptionsService.getNum("groupDefaultExpanded"),groupedCols:r,rootNode:t,pivotMode:this.columnModel.isPivotMode(),groupedColCount:this.usingTreeData||!r?0:r.length,rowNodeOrder:n,transactions:i,changedPath:o}}handleTransaction(e){e.transactions.forEach(t=>{const o=this.usingTreeData?void 0:new O;if(n.existsAndNotEmpty(t.remove)&&this.removeNodes(t.remove,e,o),n.existsAndNotEmpty(t.update)&&this.moveNodesInWrongPath(t.update,e,o),n.existsAndNotEmpty(t.add)&&this.insertNodes(t.add,e,!1),o){const t=o.getAllParents().slice();o.flush(),this.removeEmptyGroups(t,e)}}),e.rowNodeOrder&&this.sortChildren(e)}sortChildren(e){e.changedPath.forEachChangedNodeDepthFirst(t=>{if(!t.childrenAfterGroup)return;n.sortRowNodesByOrder(t.childrenAfterGroup,e.rowNodeOrder)&&e.changedPath.addParentNode(t)},!1,!0)}orderGroups(e){if(this.usingTreeData)return;const t=this.gridOptionsService.getCallback("initialGroupOrderComparator");n.exists(t)&&function e(o){n.exists(o.childrenAfterGroup)&&!o.leafGroup&&(o.childrenAfterGroup.sort((e,o)=>t({nodeA:e,nodeB:o})),o.childrenAfterGroup.forEach(t=>e(t)))}(e)}getExistingPathForNode(e,t){const o=[];let i=this.usingTreeData?e:e.parent;for(;i&&i!==t.rootNode;)o.push({key:i.key,rowGroupColumn:i.rowGroupColumn,field:i.field}),i=i.parent;return o.reverse(),o}moveNodesInWrongPath(e,t,o){e.forEach(e=>{t.changedPath.isActive()&&t.changedPath.addParentNode(e.parent);const i=e=>e.key,r=this.getExistingPathForNode(e,t).map(i),s=this.getGroupInfo(e,t).map(i);n.areEqual(r,s)||this.moveNode(e,t,o)})}moveNode(e,t,o){if(this.removeNodesInStages([e],t,o),this.insertOneNode(e,t,!0,o),e.setData(e.data),t.changedPath.isActive()){const o=e.parent;t.changedPath.addParentNode(o)}}removeNodes(e,t,o){this.removeNodesInStages(e,t,o),t.changedPath.isActive()&&e.forEach(e=>t.changedPath.addParentNode(e.parent))}removeNodesInStages(e,t,o){if(this.removeNodesFromParents(e,t,o),this.usingTreeData){this.postRemoveCreateFillerNodes(e,t);const o=e.map(e=>e.parent);this.removeEmptyGroups(o,t)}}forEachParentGroup(e,t,o){let i=t;for(;i&&i!==e.rootNode;)o(i),i=i.parent}removeNodesFromParents(e,t,o){const i=null==o,n=o||new O;e.forEach(e=>{this.removeFromParent(e,n),this.forEachParentGroup(t,e.parent,t=>{n.removeFromAllLeafChildren(t,e)})}),i&&n.flush()}postRemoveCreateFillerNodes(e,t){e.forEach(e=>{if(e.hasChildren()){const o=this.getExistingPathForNode(e,t),i=this.findParentForNode(e,o,t);i.expanded=e.expanded,i.allLeafChildren=e.allLeafChildren,i.childrenAfterGroup=e.childrenAfterGroup,i.childrenMapped=e.childrenMapped,i.updateHasChildren(),i.childrenAfterGroup.forEach(e=>e.parent=i)}})}removeEmptyGroups(e,t){let o=!0;const i=e=>{const t=this.getChildrenMappedKey(e.key,e.rowGroupColumn),o=e.parent;return!(!o||!o.childrenMapped||!o.childrenMapped[t])&&!!e.isEmptyRowGroupNode()};for(;o;){o=!1;const n=new O;e.forEach(e=>{this.forEachParentGroup(t,e,e=>{i(e)&&(o=!0,this.removeFromParent(e,n),e.setSelectedParams({newValue:!1,source:"rowGroupChanged"}))})}),n.flush()}}removeFromParent(e,t){e.parent&&(t?t.removeFromChildrenAfterGroup(e.parent,e):(n.removeFromArray(e.parent.childrenAfterGroup,e),e.parent.updateHasChildren()));const o=this.getChildrenMappedKey(e.key,e.rowGroupColumn);e.parent&&e.parent.childrenMapped&&(e.parent.childrenMapped[o]=void 0),e.setRowTop(null),e.setRowIndex(null)}addToParent(e,t){const o=this.getChildrenMappedKey(e.key,e.rowGroupColumn);if(t){null!=t.childrenMapped&&(t.childrenMapped[o]=e),t.childrenAfterGroup.push(e),t.updateHasChildren()}}areGroupColsEqual(e,t){return null!=e&&null!=t&&e.pivotMode===t.pivotMode&&n.areEqual(e.groupedCols,t.groupedCols)}checkAllGroupDataAfterColsChanged(e){const t=e=>{e&&e.forEach(e=>{if(!this.usingTreeData&&!e.group)return;const o={field:e.field,key:e.key,rowGroupColumn:e.rowGroupColumn};this.setGroupData(e,o),t(e.childrenAfterGroup)})};t(e.rootNode.childrenAfterGroup)}shotgunResetEverything(e,t){if(this.noChangeInGroupingColumns(e,t))return;this.selectionService.filterFromSelection(e=>e&&!e.group);const{rootNode:o,groupedCols:i}=e;o.leafGroup=!this.usingTreeData&&0===i.length,o.childrenAfterGroup=[],o.childrenMapped={},o.updateHasChildren();const n=o.sibling;n&&(n.childrenAfterGroup=o.childrenAfterGroup,n.childrenMapped=o.childrenMapped),this.insertNodes(o.allLeafChildren,e,!1)}noChangeInGroupingColumns(e,t){let o=!1;const i=this.columnModel.getGroupDisplayColumns(),n=i?i.map(e=>e.getId()).join("-"):"";return t&&(o=this.usingTreeData||this.areGroupColsEqual(e,this.oldGroupingDetails),this.oldGroupDisplayColIds!==n&&this.checkAllGroupDataAfterColsChanged(e)),this.oldGroupingDetails=e,this.oldGroupDisplayColIds=n,o}insertNodes(e,t,o){e.forEach(e=>{this.insertOneNode(e,t,o),t.changedPath.isActive()&&t.changedPath.addParentNode(e.parent)})}insertOneNode(e,t,o,i){const n=this.getGroupInfo(e,t),r=this.findParentForNode(e,n,t,i);r.group||console.warn("AG Grid: duplicate group keys for row data, keys should be unique",[r.data,e.data]),this.usingTreeData?this.swapGroupWithUserNode(r,e,o):(e.parent=r,e.level=n.length,r.childrenAfterGroup.push(e),r.updateHasChildren())}findParentForNode(e,t,o,i){let n=o.rootNode;return t.forEach((t,r)=>{n=this.getOrCreateNextNode(n,t,r,o),(null==i?void 0:i.isRemoveFromAllLeafChildren(n,e))?null==i||i.preventRemoveFromAllLeafChildren(n,e):n.allLeafChildren.push(e)}),n}swapGroupWithUserNode(e,t,o){t.parent=e.parent,t.key=e.key,t.field=e.field,t.groupData=e.groupData,t.level=e.level,o||(t.expanded=e.expanded),t.leafGroup=e.leafGroup,t.rowGroupIndex=e.rowGroupIndex,t.allLeafChildren=e.allLeafChildren,t.childrenAfterGroup=e.childrenAfterGroup,t.childrenMapped=e.childrenMapped,t.sibling=e.sibling,t.updateHasChildren(),this.removeFromParent(e),t.childrenAfterGroup.forEach(e=>e.parent=t),this.addToParent(t,e.parent)}getOrCreateNextNode(e,t,o,i){const n=this.getChildrenMappedKey(t.key,t.rowGroupColumn);let r=e.childrenMapped?e.childrenMapped[n]:void 0;return r||(r=this.createGroup(t,e,o,i),this.addToParent(r,e)),r}createGroup(e,t,o,i){const n=new s(this.beans);return n.group=!0,n.field=e.field,n.rowGroupColumn=e.rowGroupColumn,this.setGroupData(n,e),n.id=s.ID_PREFIX_ROW_GROUP+this.groupIdSequence.next(),n.key=e.key,n.level=o,n.leafGroup=!this.usingTreeData&&o===i.groupedColCount-1,n.allLeafChildren=[],n.setAllChildrenCount(0),n.rowGroupIndex=this.usingTreeData?null:o,n.childrenAfterGroup=[],n.childrenMapped={},n.updateHasChildren(),n.parent=i.includeParents?t:null,this.setExpandedInitialValue(i,n),this.gridOptionsService.is("groupIncludeFooter")&&n.createFooter(),n}setGroupData(e,t){e.groupData={};this.columnModel.getGroupDisplayColumns().forEach(o=>{(this.usingTreeData||!!e.rowGroupColumn&&o.isRowGroupDisplayed(e.rowGroupColumn.getId()))&&(e.groupData[o.getColId()]=t.key)})}getChildrenMappedKey(e,t){return t?t.getId()+"-"+e:e}setExpandedInitialValue(e,t){if(e.pivotMode&&t.leafGroup)return void(t.expanded=!1);const o=this.gridOptionsService.getCallback("isGroupOpenByDefault");if(o){const e={rowNode:t,field:t.field,key:t.key,level:t.level,rowGroupColumn:t.rowGroupColumn};return void(t.expanded=1==o(e))}const{expandByDefault:i}=e;-1!==e.expandByDefault?t.expanded=t.level<i:t.expanded=!0}getGroupInfo(e,t){return this.usingTreeData?this.getGroupInfoFromCallback(e):this.getGroupInfoFromGroupColumns(e,t)}getGroupInfoFromCallback(e){const t=this.getDataPath?this.getDataPath(e.data):null;null!=t&&0!==t.length||n.doOnce(()=>console.warn("AG Grid: getDataPath() should not return an empty path for data",e.data),"groupStage.getGroupInfoFromCallback");return t?t.map(e=>({key:e,field:null,rowGroupColumn:null})):[]}getGroupInfoFromGroupColumns(e,t){const o=[];return t.groupedCols.forEach(i=>{let n=this.valueService.getKeyForNode(i,e),r=null!=n&&""!==n;if((t.pivotMode||!this.gridOptionsService.is("groupAllowUnbalanced"))&&!r&&(n="",r=!0),r){const e={key:n,field:i.getColDef().field,rowGroupColumn:i};o.push(e)}}),o}};P([e("columnModel")],T.prototype,"columnModel",void 0),P([e("selectableService")],T.prototype,"selectableService",void 0),P([e("valueService")],T.prototype,"valueService",void 0),P([e("beans")],T.prototype,"beans",void 0),P([e("selectionService")],T.prototype,"selectionService",void 0),P([t],T.prototype,"postConstruct",null),T=P([o("groupStage")],T);var b,M=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};let w=b=class extends i{createPivotColumnDefs(e){const t=this.columnModel.getPivotColumns(),o=this.columnModel.getValueColumns(),i=t.length,r=this.recursiveBuildGroup(0,e,[],i,t);const s=function e(t,o=[]){return t.forEach(t=>{void 0!==t.children?e(t.children,o):o.push(t)}),o}(r);this.addRowGroupTotals(r,s,o),this.addExpandablePivotGroups(r,s),this.addPivotTotalsToGroups(r,s);return{pivotColumnGroupDefs:r,pivotColumnDefs:s.map(e=>n.cloneObject(e))}}recursiveBuildGroup(e,t,o,i,r){const s=this.columnModel.getValueColumns();if(e>=i)return this.buildMeasureCols(o);const l=r[e].getColDef(),a=this.headerNameComparator.bind(this,l.pivotComparator);if(1===s.length&&this.gridOptionsService.is("removePivotHeaderRowWhenSingleValueColumn")&&e===i-1){const e=[];return n.iterateObject(t,t=>{const i=[...o,t];e.push(Object.assign(Object.assign({},this.createColDef(s[0],t,i)),{columnGroupShow:"open"}))}),e.sort(a),e}const u=[];return n.iterateObject(t,(t,n)=>{const s=[...o,t];u.push({children:this.recursiveBuildGroup(e+1,n,s,i,r),headerName:t,pivotKeys:s,columnGroupShow:"open",groupId:this.generateColumnGroupId(s)})}),u.sort(a),u}buildMeasureCols(e){const t=this.columnModel.getValueColumns();return 0===t.length?[this.createColDef(null,"-",e)]:t.map(t=>{const o=this.columnModel.getDisplayNameForColumn(t,"header");return Object.assign(Object.assign({},this.createColDef(t,o,e)),{columnGroupShow:"open"})})}addExpandablePivotGroups(e,t){if(this.gridOptionsService.is("suppressExpandablePivotGroups")||this.gridOptionsService.get("pivotColumnGroupTotals"))return;const o=(e,t,i)=>{const n=e;if(n.children){const r=new Map;n.children.forEach(e=>{o(e,t,r)});const s=!n.children.some(e=>e.children);this.columnModel.getValueColumns().forEach(o=>{const i=this.columnModel.getDisplayNameForColumn(o,"header"),n=this.createColDef(o,i,e.pivotKeys);if(n.pivotTotalColumnIds=r.get(o.getColId()),n.columnGroupShow="closed",n.aggFunc=o.getAggFunc(),!s){e.children.push(n),t.push(n)}}),this.merge(i,r)}else{const t=e;if(!t.pivotValueColumn)return;const o=t.pivotValueColumn.getColId(),n=i.has(o)?i.get(o):[];n.push(t.colId),i.set(o,n)}};e.forEach(e=>{o(e,t,new Map)})}addPivotTotalsToGroups(e,t){if(!this.gridOptionsService.get("pivotColumnGroupTotals"))return;const o="after"===this.gridOptionsService.get("pivotColumnGroupTotals"),i=this.columnModel.getValueColumns(),n=i.map(e=>e.getAggFunc());if(!n||n.length<1||!this.sameAggFuncs(n))return;const r=i[0];e.forEach(e=>{this.recursivelyAddPivotTotal(e,t,r,o)})}recursivelyAddPivotTotal(e,t,o,i){const n=e;if(!n.children){const t=e;return t.colId?[t.colId]:null}let r=[];if(n.children.forEach(e=>{const n=this.recursivelyAddPivotTotal(e,t,o,i);n&&(r=r.concat(n))}),n.children.length>1){const n=this.localeService.getLocaleTextFunc()("pivotColumnGroupTotals","Total"),s=this.createColDef(o,n,e.pivotKeys,!0);s.pivotTotalColumnIds=r,s.aggFunc=o.getAggFunc();const l=e.children;i?l.push(s):l.unshift(s),t.push(s)}return r}addRowGroupTotals(e,t,o){if(!this.gridOptionsService.get("pivotRowTotals"))return;const i="after"===this.gridOptionsService.get("pivotRowTotals"),n=i?o.slice():o.slice().reverse();for(let o=0;o<n.length;o++){const r=n[o];let s=[];e.forEach(e=>{s=s.concat(this.extractColIdsForValueColumn(e,r))});const l=n.length>1||!this.gridOptionsService.is("removePivotHeaderRowWhenSingleValueColumn");this.createRowGroupTotal(e,t,r,s,i,l)}}extractColIdsForValueColumn(e,t){const o=e;if(!o.children){const e=o;return e.pivotValueColumn===t&&e.colId?[e.colId]:[]}let i=[];return o.children.forEach(e=>{this.extractColIdsForValueColumn(e,t);const o=this.extractColIdsForValueColumn(e,t);i=i.concat(o)}),i}createRowGroupTotal(e,t,o,i,n,r){let s;if(0===this.columnModel.getValueColumns().length)s=this.createColDef(null,"-",[]);else{const e=this.columnModel.getDisplayNameForColumn(o,"header");s=this.createColDef(o,e,[]),s.pivotTotalColumnIds=i}s.colId=b.PIVOT_ROW_TOTAL_PREFIX+s.colId,t.push(s);const l=r?{children:[s],pivotKeys:[],groupId:`${b.PIVOT_ROW_TOTAL_PREFIX}_pivotGroup_${o.getColId()}`}:s;n?e.push(l):e.unshift(l)}createColDef(e,t,o,i=!1){const n={};if(e){const t=e.getColDef();Object.assign(n,t),n.hide=!1}return n.headerName=t,n.colId=this.generateColumnId(o||[],e&&!i?e.getColId():""),n.field=n.colId,n.valueGetter=e=>{var t;return null===(t=e.data)||void 0===t?void 0:t[e.colDef.field]},n.pivotKeys=o,n.pivotValueColumn=e,!0===n.filter&&(n.filter="agNumberColumnFilter"),n}sameAggFuncs(e){if(1==e.length)return!0;for(let t=1;t<e.length;t++)if(e[t]!==e[0])return!1;return!0}headerNameComparator(e,t,o){return e?e(t.headerName,o.headerName):t.headerName&&!o.headerName?1:!t.headerName&&o.headerName?-1:t.headerName&&o.headerName?t.headerName<o.headerName?-1:t.headerName>o.headerName?1:0:0}merge(e,t){t.forEach((t,o,i)=>{const n=[...e.has(o)?e.get(o):[],...t];e.set(o,n)})}generateColumnGroupId(e){return`pivotGroup_${this.columnModel.getPivotColumns().map(e=>e.getColId()).join("-")}_${e.join("-")}`}generateColumnId(e,t){return`pivot_${this.columnModel.getPivotColumns().map(e=>e.getColId()).join("-")}_${e.join("-")}_${t}`}};w.PIVOT_ROW_TOTAL_PREFIX="PivotRowTotal_",M([e("columnModel")],w.prototype,"columnModel",void 0),w=b=M([o("pivotColDefService")],w);var I=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};let R=class extends i{constructor(){super(...arguments),this.uniqueValues={}}execute(e){const t=e.changedPath;this.columnModel.isPivotActive()?this.executePivotOn(t):this.executePivotOff(t)}executePivotOff(e){this.aggregationColumnsHashLastTime=null,this.uniqueValues={},this.columnModel.isSecondaryColumnsPresent()&&(this.columnModel.setSecondaryColumns(null,"rowModelUpdated"),e&&e.setInactive())}executePivotOn(e){const t=this.bucketUpRowNodes(e),o=this.setUniqueValues(t),i=this.columnModel.getValueColumns(),n=i.map(e=>`${e.getId()}-${e.getColDef().headerName}`).join("#"),r=i.map(e=>e.getAggFunc().toString()).join("#"),s=this.aggregationColumnsHashLastTime!==n,l=this.aggregationFuncsHashLastTime!==r;this.aggregationColumnsHashLastTime=n,this.aggregationFuncsHashLastTime=r;const a=this.columnModel.getRowGroupColumns().map(e=>e.getId()).join("#"),u=a!==this.groupColumnsHashLastTime;if(this.groupColumnsHashLastTime=a,o||s||u||l){const{pivotColumnGroupDefs:t,pivotColumnDefs:o}=this.pivotColDefService.createPivotColumnDefs(this.uniqueValues);this.pivotColumnDefs=o,this.columnModel.setSecondaryColumns(t,"rowModelUpdated"),e&&e.setInactive()}}setUniqueValues(e){return!!(JSON.stringify(e)!==JSON.stringify(this.uniqueValues))&&(this.uniqueValues=e,!0)}bucketUpRowNodes(e){const t={};e.forEachChangedNodeDepthFirst(e=>{e.leafGroup&&(e.childrenMapped=null)});const o=e=>{var i;e.leafGroup?this.bucketRowNode(e,t):null===(i=e.childrenAfterFilter)||void 0===i||i.forEach(o)};return e.executeFromRootNode(o),t}bucketRowNode(e,t){const o=this.columnModel.getPivotColumns();0===o.length?e.childrenMapped=null:e.childrenMapped=this.bucketChildren(e.childrenAfterFilter,o,0,t),e.sibling&&(e.sibling.childrenMapped=e.childrenMapped)}bucketChildren(e,t,o,i){const r={},s=t[o];if(e.forEach(e=>{let t=this.valueService.getKeyForNode(s,e);n.missing(t)&&(t=""),i[t]||(i[t]={}),r[t]||(r[t]=[]),r[t].push(e)}),o===t.length-1)return r;{const e={};return n.iterateObject(r,(n,r)=>{e[n]=this.bucketChildren(r,t,o+1,i[n])}),e}}getPivotColumnDefs(){return this.pivotColumnDefs}};I([e("valueService")],R.prototype,"valueService",void 0),I([e("columnModel")],R.prototype,"columnModel",void 0),I([e("pivotColDefService")],R.prototype,"pivotColDefService",void 0),R=I([o("pivotStage")],R);var L,_=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};const x="undefined"==typeof BigInt?null:BigInt;let V=L=class extends i{constructor(){super(...arguments),this.aggFuncsMap={},this.initialised=!1}init(){this.initialised||(this.initialiseWithDefaultAggregations(),this.addAggFuncs(this.gridOptionsService.get("aggFuncs")))}initialiseWithDefaultAggregations(){this.aggFuncsMap[L.AGG_SUM]=U,this.aggFuncsMap[L.AGG_FIRST]=k,this.aggFuncsMap[L.AGG_LAST]=j,this.aggFuncsMap[L.AGG_MIN]=H,this.aggFuncsMap[L.AGG_MAX]=B,this.aggFuncsMap[L.AGG_COUNT]=W,this.aggFuncsMap[L.AGG_AVG]=z,this.initialised=!0}isAggFuncPossible(e,t){const o=this.getFuncNames(e),i=n.includes(o,t),r=n.exists(this.aggFuncsMap[t]);return i&&r}getDefaultAggFunc(e){const t=e.getColDef().defaultAggFunc;if(n.exists(t)&&this.isAggFuncPossible(e,t))return t;if(this.isAggFuncPossible(e,L.AGG_SUM))return L.AGG_SUM;const o=this.getFuncNames(e);return n.existsAndNotEmpty(o)?o[0]:null}addAggFuncs(e){n.iterateObject(e,this.addAggFunc.bind(this))}addAggFunc(e,t){this.init(),this.aggFuncsMap[e]=t}getAggFunc(e){return this.init(),this.aggFuncsMap[e]}getFuncNames(e){const t=e.getColDef().allowedAggFuncs;return null==t?Object.keys(this.aggFuncsMap).sort():t}clear(){this.aggFuncsMap={}}};function U(e){const{values:t}=e;let o=null;for(let e=0;e<t.length;e++){const i=t[e];"number"==typeof i?null===o?o=i:o+=x?"number"==typeof o?i:x(i):i:"bigint"==typeof i&&(o=null===o?i:("bigint"==typeof o?o:x(o))+i)}return o}function k(e){return e.values.length>0?e.values[0]:null}function j(e){return e.values.length>0?n.last(e.values):null}function H(e){const{values:t}=e;let o=null;for(let e=0;e<t.length;e++){const i=t[e];"number"!=typeof i&&"bigint"!=typeof i||!(null===o||o>i)||(o=i)}return o}function B(e){const{values:t}=e;let o=null;for(let e=0;e<t.length;e++){const i=t[e];"number"!=typeof i&&"bigint"!=typeof i||!(null===o||o<i)||(o=i)}return o}function W(e){const{values:t}=e;let o=0;for(let e=0;e<t.length;e++){const i=t[e];o+=null!=i&&"number"==typeof i.value?i.value:1}return o}function z(e){var t,o,i;const{values:n}=e;let r=0,s=0;for(let e=0;e<n.length;e++){const t=n[e];let o=null;"number"==typeof t||"bigint"==typeof t?(o=t,s++):null==t||"number"!=typeof t.value&&"bigint"!=typeof t.value||"number"!=typeof t.count||(o=x?t.value*("number"==typeof t.value?t.count:x(t.count)):t.value*t.count,s+=t.count),"number"==typeof o?r+=x?"number"==typeof r?o:x(o):o:"bigint"==typeof o&&(r=("bigint"==typeof r?r:x(r))+o)}let l=null;s>0&&(l=x?r/("number"==typeof r?s:x(s)):r/s);const a=null===(o=null===(t=e.rowNode)||void 0===t?void 0:t.aggData)||void 0===o?void 0:o[null===(i=e.column)||void 0===i?void 0:i.getColId()];return a&&a.count===s&&a.value===l?a:{count:s,value:l,toString:function(){return"number"==typeof this.value||"bigint"==typeof this.value?this.value.toString():""},toNumber:function(){return this.value}}}V.AGG_SUM="sum",V.AGG_FIRST="first",V.AGG_LAST="last",V.AGG_MIN="min",V.AGG_MAX="max",V.AGG_COUNT="count",V.AGG_AVG="avg",_([t],V.prototype,"init",null),V=L=_([o("aggFuncService")],V);var Z=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};class K extends u{constructor(e,t,o,i,n){super(),this.column=e,this.dragSourceDropTarget=t,this.ghost=o,this.dropZonePurpose=i,this.horizontal=n,this.popupShowing=!1}init(){this.setTemplate(K.TEMPLATE);const e=this.getGui(),t=this.gridOptionsService.is("functionsReadOnly");this.addElementClasses(e),this.addElementClasses(this.eDragHandle,"drag-handle"),this.addElementClasses(this.eText,"text"),this.addElementClasses(this.eButton,"button"),this.eDragHandle.appendChild(n.createIconNoSpan("columnDrag",this.gridOptionsService)),this.eButton.appendChild(n.createIconNoSpan("cancel",this.gridOptionsService)),this.setupSort(),this.displayName=this.columnModel.getDisplayNameForColumn(this.column,"columnDrop"),this.setupComponents(),this.ghost||t||this.addDragSource(),this.setupAria(),this.addManagedListener(this.eventService,d.EVENT_SORT_CHANGED,()=>{this.setupAria()}),this.setupTooltip()}setupAria(){const e=this.localeService.getLocaleTextFunc(),{name:t,aggFuncName:o}=this.getColumnAndAggFuncName(),i=e("ariaDropZoneColumnComponentAggFuncSeperator"," of "),r={asc:e("ariaDropZoneColumnComponentSortAscending","ascending"),desc:e("ariaDropZoneColumnComponentSortDescending","descending")},s=this.column.getSort(),l=this.gridOptionsService.is("rowGroupPanelSuppressSort"),a=[[o&&`${o}${i}`,t,this.isGroupingZone()&&!l&&s&&", "+r[s]].filter(e=>!!e).join("")],u=this.gridOptionsService.is("functionsReadOnly");if(this.isAggregationZone()&&!u){const t=e("ariaDropZoneColumnValueItemDescription","Press ENTER to change the aggregation type");a.push(t)}if(this.isGroupingZone()&&this.column.getColDef().sortable&&!l){const t=e("ariaDropZoneColumnGroupItemDescription","Press ENTER to sort");a.push(t)}const d=e("ariaDropZoneColumnComponentDescription","Press DELETE to remove");a.push(d),n.setAriaLabel(this.getGui(),a.join(". "))}setupTooltip(){const e=()=>{const e=this.column.getColDef().headerTooltip;this.setTooltip(e)};e(),this.addManagedListener(this.eventService,c.EVENT_NEW_COLUMNS_LOADED,e)}setupSort(){const e=this.column.getColDef().sortable,t=this.isGroupingZone();if(e&&t&&!this.gridOptionsService.is("rowGroupPanelSuppressSort")){this.eSortIndicator.setupSort(this.column,!0);const e=e=>{e.preventDefault();const t="ctrl"===this.gridOptionsService.get("multiSortKey")?e.ctrlKey||e.metaKey:e.shiftKey;this.sortController.progressSort(this.column,t,"uiColumnSorted")};this.addGuiEventListener("click",e),this.addGuiEventListener("keydown",t=>{t.key===h.ENTER&&this.isGroupingZone()&&e(t)})}}addDragSource(){const e={type:p.ToolPanel,eElement:this.eDragHandle,defaultIconName:g.ICON_HIDE,getDragItem:()=>this.createDragItem(),dragItemName:this.displayName,dragSourceDropTarget:this.dragSourceDropTarget};this.dragAndDropService.addDragSource(e,!0),this.addDestroyFunc(()=>this.dragAndDropService.removeDragSource(e))}createDragItem(){const e={};return e[this.column.getId()]=this.column.isVisible(),{columns:[this.column],visibleState:e}}setupComponents(){this.setTextValue(),this.setupRemove(),this.ghost&&this.addCssClass("ag-column-drop-cell-ghost"),this.isAggregationZone()&&!this.gridOptionsService.is("functionsReadOnly")&&this.addGuiEventListener("click",this.onShowAggFuncSelection.bind(this))}setupRemove(){n.setDisplayed(this.eButton,!this.gridOptionsService.is("functionsReadOnly"));const e={type:K.EVENT_COLUMN_REMOVE};this.addGuiEventListener("keydown",t=>{const o=t.key===h.ENTER;t.key===h.DELETE&&(t.preventDefault(),this.dispatchEvent(e)),o&&this.isAggregationZone()&&!this.gridOptionsService.is("functionsReadOnly")&&(t.preventDefault(),this.onShowAggFuncSelection())}),this.addManagedListener(this.eButton,"click",t=>{this.dispatchEvent(e),t.stopPropagation()});const t=new m(this.eButton);this.addManagedListener(t,m.EVENT_TAP,()=>{this.dispatchEvent(e)}),this.addDestroyFunc(t.destroy.bind(t))}getColumnAndAggFuncName(){const e=this.displayName;let t="";if(this.isAggregationZone()){const e=this.column.getAggFunc(),o="string"==typeof e?e:"agg";t=this.localeService.getLocaleTextFunc()(o,o)}return{name:e,aggFuncName:t}}setTextValue(){const{name:e,aggFuncName:t}=this.getColumnAndAggFuncName(),o=this.isAggregationZone()?`${t}(${e})`:e,i=n.escapeString(o);this.eText.innerHTML=i}onShowAggFuncSelection(){if(this.popupShowing)return;this.popupShowing=!0;const e=new f("select-agg-func"),t=this.aggFuncService.getFuncNames(this.column),o=this.getGui(),i=e.getGui();e.setModel({getRow:function(e){return t[e]},getRowCount:function(){return t.length}}),this.getContext().createBean(e);const r=n.loadTemplate('<div class="ag-select-agg-func-popup"></div>');r.style.top="0px",r.style.left="0px",r.appendChild(i),r.style.width=o.clientWidth+"px";const s=this.localeService.getLocaleTextFunc(),l=this.popupService.addPopup({modal:!0,eChild:r,closeOnEsc:!0,closedCallback:()=>{this.destroyBean(e),this.popupShowing=!1,o.focus()},ariaLabel:s("ariaLabelAggregationFunction","Aggregation Function")});l&&e.setComponentCreator(this.createAggSelect.bind(this,l.hideFunc)),e.addGuiEventListener("keydown",t=>{if(t.key===h.ENTER||t.key===h.SPACE){const t=e.getLastFocusedRow();if(null==t)return;const o=e.getComponentAt(t);o&&o.selectItem()}}),this.popupService.positionPopupByComponent({type:"aggFuncSelect",eventSource:o,ePopup:r,keepWithinBounds:!0,column:this.column,position:"under"}),e.refresh();let a=t.findIndex(e=>e===this.column.getAggFunc());-1===a&&(a=0),e.focusRow(a)}createAggSelect(e,t){const o=this.localeService.getLocaleTextFunc(),i=t.toString(),n=o(i,i);return new $(()=>{if(e(),this.gridOptionsService.is("functionsPassive")){const e={type:c.EVENT_COLUMN_AGG_FUNC_CHANGE_REQUEST,columns:[this.column],aggFunc:t};this.eventService.dispatchEvent(e)}else this.columnModel.setColumnAggFunc(this.column,t,"toolPanelDragAndDrop")},n)}addElementClasses(e,t){t=t?"-"+t:"";const o=this.horizontal?"horizontal":"vertical";e.classList.add("ag-column-drop-cell"+t,`ag-column-drop-${o}-cell${t}`)}isAggregationZone(){return"aggregation"===this.dropZonePurpose}isGroupingZone(){return"rowGroup"===this.dropZonePurpose}}K.EVENT_COLUMN_REMOVE="columnRemove",K.TEMPLATE='<span role="option" tabindex="0">\n          <span ref="eDragHandle" class="ag-drag-handle ag-column-drop-cell-drag-handle" role="presentation"></span>\n          <span ref="eText" class="ag-column-drop-cell-text" aria-hidden="true"></span>\n          <ag-sort-indicator ref="eSortIndicator"></ag-sort-indicator>\n          <span ref="eButton" class="ag-column-drop-cell-button" role="presentation"></span>\n        </span>',Z([e("dragAndDropService")],K.prototype,"dragAndDropService",void 0),Z([e("columnModel")],K.prototype,"columnModel",void 0),Z([e("popupService")],K.prototype,"popupService",void 0),Z([l("aggFuncService")],K.prototype,"aggFuncService",void 0),Z([e("sortController")],K.prototype,"sortController",void 0),Z([a("eText")],K.prototype,"eText",void 0),Z([a("eDragHandle")],K.prototype,"eDragHandle",void 0),Z([a("eButton")],K.prototype,"eButton",void 0),Z([a("eSortIndicator")],K.prototype,"eSortIndicator",void 0),Z([t],K.prototype,"init",null);class $ extends u{constructor(e,t){super('<div class="ag-select-agg-func-item"/>'),this.selectItem=e,this.getGui().innerText=t,this.addGuiEventListener("click",this.selectItem)}}var q=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};class X extends u{constructor(e,t){super('<div class="ag-unselectable" role="presentation"></div>'),this.horizontal=e,this.dropZonePurpose=t,this.state=X.STATE_NOT_DRAGGING,this.guiDestroyFunctions=[],this.childColumnComponents=[],this.resizeEnabled=!1,this.addElementClasses(this.getGui()),this.eColumnDropList=document.createElement("div"),this.addElementClasses(this.eColumnDropList,"list"),n.setAriaRole(this.eColumnDropList,"listbox")}isHorizontal(){return this.horizontal}toggleResizable(e){this.positionableFeature.setResizable(!!e&&{bottom:!0}),this.resizeEnabled=e}setBeans(e){this.beans=e}destroy(){this.destroyGui(),super.destroy()}destroyGui(){this.guiDestroyFunctions.forEach(e=>e()),this.guiDestroyFunctions.length=0,this.childColumnComponents.length=0,n.clearElement(this.getGui()),n.clearElement(this.eColumnDropList)}init(e){this.params=e,this.createManagedBean(new v(this.getFocusableElement(),{handleKeyDown:this.handleKeyDown.bind(this)})),this.addManagedListener(this.beans.eventService,c.EVENT_NEW_COLUMNS_LOADED,this.refreshGui.bind(this)),this.addManagedPropertyListener("functionsReadOnly",this.refreshGui.bind(this)),this.setupDropTarget(),this.positionableFeature=new C(this.getGui(),{minHeight:100}),this.createManagedBean(this.positionableFeature),this.refreshGui(),n.setAriaLabel(this.eColumnDropList,this.getAriaLabel())}handleKeyDown(e){const t=!this.horizontal;let o=e.key===h.DOWN,i=e.key===h.UP;if(!t){const t=this.gridOptionsService.is("enableRtl");o=!t&&e.key===h.RIGHT||t&&e.key===h.LEFT,i=!t&&e.key===h.LEFT||t&&e.key===h.RIGHT}if(!o&&!i)return;const n=this.focusService.findNextFocusableElement(this.getFocusableElement(),!1,i);n&&(e.preventDefault(),n.focus())}addElementClasses(e,t){t=t?"-"+t:"";const o=this.horizontal?"horizontal":"vertical";e.classList.add("ag-column-drop"+t,`ag-column-drop-${o}${t}`)}setupDropTarget(){this.dropTarget={getContainer:this.getGui.bind(this),getIconName:this.getIconName.bind(this),onDragging:this.onDragging.bind(this),onDragEnter:this.onDragEnter.bind(this),onDragLeave:this.onDragLeave.bind(this),onDragStop:this.onDragStop.bind(this),isInterestedIn:this.isInterestedIn.bind(this)},this.beans.dragAndDropService.addDropTarget(this.dropTarget)}isInterestedIn(e){return e===p.HeaderCell||e===p.ToolPanel}checkInsertIndex(e){const t=this.getNewInsertIndex(e);if(t<0)return!1;const o=t!==this.insertIndex;return o&&(this.insertIndex=t),o}getNewInsertIndex(e){const t=e.event,o=this.horizontal?t.clientX:t.clientY,i=this.childColumnComponents.map(e=>e.getGui().getBoundingClientRect()),n=i.findIndex(e=>this.horizontal?e.right>o&&e.left<o:e.top<o&&e.bottom>o);if(-1===n){const e=this.beans.gridOptionsService.is("enableRtl");if(i.every(e=>o>(this.horizontal?e.right:e.bottom)))return e&&this.horizontal?0:this.childColumnComponents.length;return i.every(e=>o<(this.horizontal?e.left:e.top))?e&&this.horizontal?this.childColumnComponents.length:0:this.insertIndex}return this.insertIndex<=n?n+1:n}checkDragStartedBySelf(e){this.state===X.STATE_NOT_DRAGGING&&(this.state=X.STATE_REARRANGE_COLUMNS,this.potentialDndColumns=e.dragSource.getDragItem().columns||[],this.refreshGui(),this.checkInsertIndex(e),this.refreshGui())}onDragging(e){this.checkDragStartedBySelf(e),this.checkInsertIndex(e)&&this.refreshGui()}onDragEnter(e){const t=e.dragSource.getDragItem().columns||[];this.state=X.STATE_NEW_COLUMNS_IN;const o=t.filter(this.isColumnDroppable.bind(this));if(o.length>0){if(this.isRowGroupPanel()&&!this.gridOptionsService.is("suppressRowGroupHidesColumns")&&!e.fromNudge){const t=e.dragSource.getDragItem().columns;this.setColumnsVisible(t,!1,"uiColumnDragged")}this.potentialDndColumns=o,this.checkInsertIndex(e),this.refreshGui()}}setColumnsVisible(e,t,o="api"){if(e){const i=e.filter(e=>!e.getColDef().lockVisible);this.colModel.setColumnsVisible(i,t,o)}}isPotentialDndColumns(){return n.existsAndNotEmpty(this.potentialDndColumns)}isRowGroupPanel(){return"rowGroup"===this.dropZonePurpose}onDragLeave(e){if(this.state===X.STATE_REARRANGE_COLUMNS){const t=e.dragSource.getDragItem().columns||[];this.removeColumns(t)}if(this.isPotentialDndColumns()){if(this.isRowGroupPanel()&&!this.gridOptionsService.is("suppressMakeColumnVisibleAfterUnGroup")&&!e.fromNudge){const t=e.dragSource.getDragItem();this.setColumnsVisible(t.columns,!0,"uiColumnDragged")}this.potentialDndColumns=[],this.refreshGui()}this.state=X.STATE_NOT_DRAGGING}onDragStop(){if(this.isPotentialDndColumns()){let e=!1;this.state===X.STATE_NEW_COLUMNS_IN?(this.addColumns(this.potentialDndColumns),e=!0):e=this.rearrangeColumns(this.potentialDndColumns),this.potentialDndColumns=[],this.beans.gridOptionsService.is("functionsPassive")&&e||this.refreshGui()}this.state=X.STATE_NOT_DRAGGING}removeColumns(e){const t=this.getExistingColumns().filter(t=>!n.includes(e,t));this.updateColumns(t)}addColumns(e){if(!e)return;const t=this.getExistingColumns().slice(),o=e.filter(e=>t.indexOf(e)<0);n.insertArrayIntoArray(t,o,this.insertIndex),this.updateColumns(t)}rearrangeColumns(e){const t=this.getNonGhostColumns().slice();return n.insertArrayIntoArray(t,e,this.insertIndex),!n.areEqual(t,this.getExistingColumns())&&(this.updateColumns(t),!0)}refreshGui(){const e=this.eColumnDropList.scrollTop,t=this.resizeEnabled,o=this.getFocusedItem();let i=this.focusService.findNextFocusableElement();i||(i=this.focusService.findNextFocusableElement(void 0,!1,!0)),this.toggleResizable(!1),this.destroyGui(),this.addIconAndTitleToGui(),this.addEmptyMessageToGui(),this.addColumnsToGui(),this.isHorizontal()||(this.eColumnDropList.scrollTop=e),t&&this.toggleResizable(t),this.focusService.isKeyboardMode()&&this.restoreFocus(o,i)}getFocusedItem(){const e=this.getGui(),t=this.gridOptionsService.getDocument().activeElement;if(!e.contains(t))return-1;return Array.from(e.querySelectorAll(".ag-column-drop-cell")).indexOf(t)}restoreFocus(e,t){const o=this.getGui(),i=Array.from(o.querySelectorAll(".ag-column-drop-cell"));if(-1===e)return;0===i.length&&t.focus();const n=i[Math.min(i.length-1,e)];n&&n.focus()}getNonGhostColumns(){const e=this.getExistingColumns();return this.isPotentialDndColumns()?e.filter(e=>!n.includes(this.potentialDndColumns,e)):e}addColumnsToGui(){const e=this.getNonGhostColumns().map(e=>this.createColumnComponent(e,!1));if(this.isPotentialDndColumns()){const t=this.potentialDndColumns.map(e=>this.createColumnComponent(e,!0));this.insertIndex>=e.length?e.push(...t):e.splice(this.insertIndex,0,...t)}this.appendChild(this.eColumnDropList),e.forEach((e,t)=>{t>0&&this.addArrow(this.eColumnDropList),this.eColumnDropList.appendChild(e.getGui())}),this.addAriaLabelsToComponents()}addAriaLabelsToComponents(){this.childColumnComponents.forEach((e,t)=>{const o=e.getGui();n.setAriaPosInSet(o,t+1),n.setAriaSetSize(o,this.childColumnComponents.length)})}createColumnComponent(e,t){const o=new K(e,this.dropTarget,t,this.dropZonePurpose,this.horizontal);return o.addEventListener(K.EVENT_COLUMN_REMOVE,this.removeColumns.bind(this,[e])),this.beans.context.createBean(o),this.guiDestroyFunctions.push(()=>this.destroyBean(o)),t||this.childColumnComponents.push(o),o}addIconAndTitleToGui(){const e=this.params.icon,t=document.createElement("div");if(n.setAriaHidden(t,!0),this.addElementClasses(t,"title-bar"),this.addElementClasses(e,"icon"),this.addOrRemoveCssClass("ag-column-drop-empty",this.isExistingColumnsEmpty()),t.appendChild(e),!this.horizontal){const e=document.createElement("span");this.addElementClasses(e,"title"),e.innerHTML=this.params.title,t.appendChild(e)}this.appendChild(t)}isExistingColumnsEmpty(){return 0===this.getExistingColumns().length}addEmptyMessageToGui(){if(!this.isExistingColumnsEmpty()||this.isPotentialDndColumns())return;const e=document.createElement("span");e.innerHTML=this.params.emptyMessage,this.addElementClasses(e,"empty-message"),this.eColumnDropList.appendChild(e)}addArrow(e){if(this.horizontal){const t=this.beans.gridOptionsService.is("enableRtl"),o=n.createIconNoSpan(t?"smallLeft":"smallRight",this.beans.gridOptionsService);this.addElementClasses(o,"cell-separator"),e.appendChild(o)}}}X.STATE_NOT_DRAGGING="notDragging",X.STATE_NEW_COLUMNS_IN="newColumnsIn",X.STATE_REARRANGE_COLUMNS="rearrangeColumns",q([e("columnModel")],X.prototype,"colModel",void 0),q([e("focusService")],X.prototype,"focusService",void 0);var Q=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};class Y extends X{constructor(e){super(e,"rowGroup")}passBeansUp(){super.setBeans({gridOptionsService:this.gridOptionsService,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});const e=this.localeService.getLocaleTextFunc(),t=e("rowGroupColumnsEmptyMessage","Drag here to set row groups"),o=e("groups","Row Groups");super.init({dragAndDropIcon:g.ICON_GROUP,icon:n.createIconNoSpan("rowGroupPanel",this.gridOptionsService,null),emptyMessage:t,title:o}),this.addManagedListener(this.eventService,c.EVENT_COLUMN_ROW_GROUP_CHANGED,this.refreshGui.bind(this))}getAriaLabel(){return this.localeService.getLocaleTextFunc()("ariaRowGroupDropZonePanelLabel","Row Groups")}getTooltipParams(){const e=super.getTooltipParams();return e.location="rowGroupColumnsList",e}isColumnDroppable(e){return!(this.gridOptionsService.is("functionsReadOnly")||!e.isPrimary())&&(e.isAllowRowGroup()&&!e.isRowGroupActive())}updateColumns(e){if(this.gridOptionsService.is("functionsPassive")){const t={type:c.EVENT_COLUMN_ROW_GROUP_CHANGE_REQUEST,columns:e};this.eventService.dispatchEvent(t)}else this.columnModel.setRowGroupColumns(e,"toolPanelUi")}getIconName(){return this.isPotentialDndColumns()?g.ICON_GROUP:g.ICON_NOT_ALLOWED}getExistingColumns(){return this.columnModel.getRowGroupColumns()}}Q([e("columnModel")],Y.prototype,"columnModel",void 0),Q([e("loggerFactory")],Y.prototype,"loggerFactory",void 0),Q([e("dragAndDropService")],Y.prototype,"dragAndDropService",void 0),Q([t],Y.prototype,"passBeansUp",null);var J=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};class ee extends X{constructor(e){super(e,"pivot")}passBeansUp(){super.setBeans({gridOptionsService:this.gridOptionsService,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});const e=this.localeService.getLocaleTextFunc(),t=e("pivotColumnsEmptyMessage","Drag here to set column labels"),o=e("pivots","Column Labels");super.init({dragAndDropIcon:g.ICON_GROUP,icon:n.createIconNoSpan("pivotPanel",this.gridOptionsService,null),emptyMessage:t,title:o}),this.addManagedListener(this.eventService,c.EVENT_NEW_COLUMNS_LOADED,this.refresh.bind(this)),this.addManagedListener(this.eventService,c.EVENT_COLUMN_PIVOT_CHANGED,this.refresh.bind(this)),this.addManagedListener(this.eventService,c.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.checkVisibility.bind(this)),this.refresh()}getAriaLabel(){return this.localeService.getLocaleTextFunc()("ariaPivotDropZonePanelLabel","Column Labels")}getTooltipParams(){const e=super.getTooltipParams();return e.location="pivotColumnsList",e}refresh(){this.checkVisibility(),this.refreshGui()}checkVisibility(){const e=this.columnModel.isPivotMode();if(this.isHorizontal())switch(this.gridOptionsService.get("pivotPanelShow")){case"always":this.setDisplayed(e);break;case"onlyWhenPivoting":const t=this.columnModel.isPivotActive();this.setDisplayed(e&&t);break;default:this.setDisplayed(!1)}else this.setDisplayed(e)}isColumnDroppable(e){return!(this.gridOptionsService.is("functionsReadOnly")||!e.isPrimary())&&(e.isAllowPivot()&&!e.isPivotActive())}updateColumns(e){if(this.gridOptionsService.is("functionsPassive")){const t={type:c.EVENT_COLUMN_PIVOT_CHANGE_REQUEST,columns:e};this.eventService.dispatchEvent(t)}else this.columnModel.setPivotColumns(e,"toolPanelUi")}getIconName(){return this.isPotentialDndColumns()?g.ICON_PIVOT:g.ICON_NOT_ALLOWED}getExistingColumns(){return this.columnModel.getPivotColumns()}}J([e("columnModel")],ee.prototype,"columnModel",void 0),J([e("loggerFactory")],ee.prototype,"loggerFactory",void 0),J([e("dragAndDropService")],ee.prototype,"dragAndDropService",void 0),J([t],ee.prototype,"passBeansUp",null);var te=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};class oe extends u{constructor(){super()}postConstruct(){this.setGui(this.createNorthPanel()),this.addManagedListener(this.eventService,c.EVENT_COLUMN_ROW_GROUP_CHANGED,this.onRowGroupChanged.bind(this)),this.addManagedListener(this.eventService,c.EVENT_NEW_COLUMNS_LOADED,this.onRowGroupChanged.bind(this)),this.addManagedPropertyListener("rowGroupPanelShow",this.onRowGroupChanged.bind(this)),this.onRowGroupChanged()}createNorthPanel(){const e=document.createElement("div"),t=this.onDropPanelVisible.bind(this);return e.classList.add("ag-column-drop-wrapper"),n.setAriaRole(e,"presentation"),this.rowGroupComp=new Y(!0),this.createManagedBean(this.rowGroupComp),this.pivotComp=new ee(!0),this.createManagedBean(this.pivotComp),e.appendChild(this.rowGroupComp.getGui()),e.appendChild(this.pivotComp.getGui()),this.addManagedListener(this.rowGroupComp,u.EVENT_DISPLAYED_CHANGED,t),this.addManagedListener(this.pivotComp,u.EVENT_DISPLAYED_CHANGED,t),this.onDropPanelVisible(),e}onDropPanelVisible(){const e=this.rowGroupComp.isDisplayed()&&this.pivotComp.isDisplayed();this.rowGroupComp.addOrRemoveCssClass("ag-column-drop-horizontal-half-width",e),this.pivotComp.addOrRemoveCssClass("ag-column-drop-horizontal-half-width",e)}onRowGroupChanged(){if(!this.rowGroupComp)return;const e=this.gridOptionsService.get("rowGroupPanelShow");if("always"===e)this.rowGroupComp.setDisplayed(!0);else if("onlyWhenGrouping"===e){const e=!this.columnModel.isRowGroupEmpty();this.rowGroupComp.setDisplayed(e)}else this.rowGroupComp.setDisplayed(!1)}}te([e("columnModel")],oe.prototype,"columnModel",void 0),te([t],oe.prototype,"postConstruct",null);var ie=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};let ne=class extends i{execute(e){const t=this.columnModel.isPivotMode(),o=this.filterManager.isAggregateFilterPresent()||this.filterManager.isAggregateQuickFilterPresent(),i=this.gridOptionsService.getGroupAggFiltering()||(t?e=>e.node.leafGroup:e=>!e.node.group),{changedPath:n}=e,r=(e,t=!1)=>{e.childrenAfterFilter&&(e.childrenAfterAggFilter=e.childrenAfterFilter,t&&e.childrenAfterAggFilter.forEach(e=>r(e,t)),this.setAllChildrenCount(e)),e.sibling&&(e.sibling.childrenAfterAggFilter=e.childrenAfterAggFilter)};n.forEachChangedNodeDepthFirst(o?e=>{var t;e.childrenAfterAggFilter=(null===(t=e.childrenAfterFilter)||void 0===t?void 0:t.filter(e=>{var t;if(i({node:e})){if(this.filterManager.doesRowPassAggregateFilters({rowNode:e}))return r(e,!0),!0}return null===(t=e.childrenAfterAggFilter)||void 0===t?void 0:t.length}))||null,this.setAllChildrenCount(e),e.sibling&&(e.sibling.childrenAfterAggFilter=e.childrenAfterAggFilter)}:r,!0)}setAllChildrenCountTreeData(e){let t=0;e.childrenAfterAggFilter.forEach(e=>{t++,t+=e.allChildrenCount}),e.setAllChildrenCount(t)}setAllChildrenCountGridGrouping(e){let t=0;e.childrenAfterAggFilter.forEach(e=>{e.group?t+=e.allChildrenCount:t++}),e.setAllChildrenCount(t)}setAllChildrenCount(e){e.hasChildren()?this.gridOptionsService.isTreeData()?this.setAllChildrenCountTreeData(e):this.setAllChildrenCountGridGrouping(e):e.setAllChildrenCount(null)}};ie([e("filterManager")],ne.prototype,"filterManager",void 0),ie([e("columnModel")],ne.prototype,"columnModel",void 0),ne=ie([o("filterAggregatesStage")],ne);var re=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};class se extends G{constructor(){super('\n            <div class="ag-group-filter">\n                <div ref="eGroupField"></div>\n                <div ref="eUnderlyingFilter"></div>\n            </div>\n        ')}postConstruct(){this.initialiseTabGuard({})}init(e){return this.params=e,this.validateParams(),this.updateGroups().then(()=>{this.addManagedListener(this.eventService,c.EVENT_COLUMN_ROW_GROUP_CHANGED,()=>this.onColumnRowGroupChanged())})}validateParams(){const{colDef:e}=this.params;e.field&&n.doOnce(()=>console.warn('AG Grid: Group Column Filter does not work with the colDef property "field". This property will be ignored.'),"groupFilterFieldParam"),e.filterValueGetter&&n.doOnce(()=>console.warn('AG Grid: Group Column Filter does not work with the colDef property "filterValueGetter". This property will be ignored.'),"groupFilterFilterValueGetterParam"),e.filterParams&&n.doOnce(()=>console.warn('AG Grid: Group Column Filter does not work with the colDef property "filterParams". This property will be ignored.'),"groupFilterFilterParams")}updateGroups(){const e=this.updateGroupField();return this.getUnderlyingFilters(e)}getSourceColumns(){if(this.groupColumn=this.params.column,this.gridOptionsService.is("treeData"))return n.doOnce(()=>console.warn("AG Grid: Group Column Filter does not work with Tree Data enabled. Please disable Tree Data, or use a different filter."),"groupFilterTreeData"),[];const e=this.columnModel.getSourceColumnsForGroupColumn(this.groupColumn);return e||(n.doOnce(()=>console.warn("AG Grid: Group Column Filter only works on group columns. Please use a different filter."),"groupFilterNotGroupColumn"),[])}updateGroupField(){n.clearElement(this.eGroupField),this.eGroupFieldSelect&&this.destroyBean(this.eGroupFieldSelect);const e=this.getSourceColumns(),t=e.filter(e=>e.isFilterAllowed());return t.length?(1===e.length?(this.selectedColumn=t[0],n.setDisplayed(this.eGroupField,!1)):(this.selectedColumn&&t.some(e=>e.getId()===this.selectedColumn.getId())||(this.selectedColumn=t[0]),this.createGroupFieldSelectElement(t),this.eGroupField.appendChild(this.eGroupFieldSelect.getGui()),this.eGroupField.appendChild(n.loadTemplate('<div class="ag-filter-separator"></div>')),n.setDisplayed(this.eGroupField,!0)),t):(this.selectedColumn=void 0,n.setDisplayed(this.eGroupField,!1),null)}createGroupFieldSelectElement(e){this.eGroupFieldSelect=this.createManagedBean(new y);const t=this.localeService.getLocaleTextFunc();this.eGroupFieldSelect.setLabel(t("groupFilterSelect","Select field:")),this.eGroupFieldSelect.setLabelAlignment("top"),this.eGroupFieldSelect.addOptions(e.map(e=>{var t;return{value:e.getId(),text:null!==(t=this.columnModel.getDisplayNameForColumn(e,"groupFilter",!1))&&void 0!==t?t:void 0}})),this.eGroupFieldSelect.setValue(this.selectedColumn.getId()),this.eGroupFieldSelect.onValueChange(e=>this.updateSelectedColumn(e)),this.eGroupFieldSelect.addCssClass("ag-group-filter-field-select-wrapper"),1===e.length&&this.eGroupFieldSelect.setDisabled(!0)}getUnderlyingFilters(e){if(!e)return this.filterColumnPairs=void 0,this.selectedFilter=void 0,this.groupColumn.setFilterActive(!1,"columnRowGroupChanged"),F.resolve();const t=[],o=[];return e.forEach(e=>{const i=this.filterManager.getOrCreateFilterWrapper(e,"COLUMN_MENU");(null==i?void 0:i.filterPromise)&&t.push(i.filterPromise.then(t=>(t&&o.push({filter:t,column:e}),e.getId()===this.selectedColumn.getId()&&(this.selectedFilter=null!=t?t:void 0),t)))}),F.all(t).then(()=>{this.filterColumnPairs=o,this.groupColumn.setFilterActive(this.isFilterActive(),"columnRowGroupChanged")})}addUnderlyingFilterElement(){if(n.clearElement(this.eUnderlyingFilter),!this.selectedColumn)return F.resolve();const e=this.filterManager.getOrCreateFilterWrapper(this.selectedColumn,"COLUMN_MENU");return e?e.guiPromise.then(t=>{var o;this.eUnderlyingFilter.appendChild(t),null===(o=e.filterPromise)||void 0===o||o.then(e=>{var t,o;null===(t=null==e?void 0:e.afterGuiAttached)||void 0===t||t.call(e,this.afterGuiAttachedParams),(null===(o=this.afterGuiAttachedParams)||void 0===o?void 0:o.suppressFocus)||!this.eGroupFieldSelect||this.eGroupFieldSelect.isDisabled()||this.eGroupFieldSelect.getFocusableElement().focus()})}):F.resolve()}updateSelectedColumn(e){var t,o;if(!e)return;null===(o=null===(t=this.selectedFilter)||void 0===t?void 0:t.afterGuiDetached)||void 0===o||o.call(t);const i=this.getFilterColumnPair(e);this.selectedColumn=null==i?void 0:i.column,this.selectedFilter=null==i?void 0:i.filter,this.dispatchEvent({type:se.EVENT_SELECTED_COLUMN_CHANGED}),this.addUnderlyingFilterElement()}isFilterActive(){var e;return!!(null===(e=this.filterColumnPairs)||void 0===e?void 0:e.some(({filter:e})=>e.isFilterActive()))}doesFilterPass(){return!0}getModel(){return null}setModel(){return F.resolve()}afterGuiAttached(e){this.afterGuiAttachedParams=e,this.addUnderlyingFilterElement()}afterGuiDetached(){var e,t;n.clearElement(this.eUnderlyingFilter),null===(t=null===(e=this.selectedFilter)||void 0===e?void 0:e.afterGuiDetached)||void 0===t||t.call(e)}onColumnRowGroupChanged(){this.updateGroups().then(()=>{this.dispatchEvent({type:se.EVENT_COLUMN_ROW_GROUP_CHANGED}),this.eventService.dispatchEvent({type:"filterAllowedUpdated"})})}getFilterColumnPair(e){var t;if(e)return null===(t=this.filterColumnPairs)||void 0===t?void 0:t.find(({column:t})=>t.getId()===e)}getSelectedFilter(){return this.selectedFilter}getSelectedColumn(){return this.selectedColumn}isFilterAllowed(){return!!this.selectedColumn}destroy(){super.destroy()}}se.EVENT_COLUMN_ROW_GROUP_CHANGED="columnRowGroupChanged",se.EVENT_SELECTED_COLUMN_CHANGED="selectedColumnChanged",re([e("filterManager")],se.prototype,"filterManager",void 0),re([e("columnModel")],se.prototype,"columnModel",void 0),re([a("eGroupField")],se.prototype,"eGroupField",void 0),re([a("eUnderlyingFilter")],se.prototype,"eUnderlyingFilter",void 0),re([t],se.prototype,"postConstruct",null);var le=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};class ae extends u{constructor(){super('\n            <div ref="eFloatingFilter" class="ag-group-floating-filter ag-floating-filter-input" role="presentation"></div>\n        ')}init(e){this.params=e;const t="multipleColumns"===this.gridOptionsService.get("groupDisplayType");return new F(e=>{this.params.parentFilterInstance(o=>{this.parentFilterInstance=o,t?this.setupUnderlyingFloatingFilterElement().then(()=>e()):(this.setupReadOnlyFloatingFilterElement(),e())})}).then(()=>{this.addManagedListener(this.parentFilterInstance,se.EVENT_SELECTED_COLUMN_CHANGED,()=>this.onSelectedColumnChanged()),this.addManagedListener(this.parentFilterInstance,se.EVENT_COLUMN_ROW_GROUP_CHANGED,()=>this.onColumnRowGroupChanged())})}setupReadOnlyFloatingFilterElement(){if(!this.eFloatingFilterText){this.eFloatingFilterText=this.createManagedBean(new A);const e=this.columnModel.getDisplayNameForColumn(this.params.column,"header",!0),t=this.localeService.getLocaleTextFunc();this.eFloatingFilterText.setDisabled(!0).setInputAriaLabel(`${e} ${t("ariaFilterInput","Filter Input")}`).addGuiEventListener("click",()=>this.params.showParentFilter())}this.updateDisplayedValue(),this.eFloatingFilter.appendChild(this.eFloatingFilterText.getGui())}setupUnderlyingFloatingFilterElement(){this.showingUnderlyingFloatingFilter=!1,this.underlyingFloatingFilter=void 0,n.clearElement(this.eFloatingFilter);const e=this.parentFilterInstance.getSelectedColumn();if(e&&!e.isVisible()){const t=this.filterManager.getFloatingFilterCompDetails(e,this.params.showParentFilter);if(t)return this.columnVisibleChangedListener||(this.columnVisibleChangedListener=this.addManagedListener(e,d.EVENT_VISIBLE_CHANGED,this.onColumnVisibleChanged.bind(this))),t.newAgStackInstance().then(e=>{var t,o;this.underlyingFloatingFilter=e,null===(t=this.underlyingFloatingFilter)||void 0===t||t.onParentModelChanged(null===(o=this.parentFilterInstance.getSelectedFilter())||void 0===o?void 0:o.getModel()),this.appendChild(e.getGui()),this.showingUnderlyingFloatingFilter=!0})}return this.setupReadOnlyFloatingFilterElement(),F.resolve()}onColumnVisibleChanged(){this.setupUnderlyingFloatingFilterElement()}onParentModelChanged(e,t){var o,i;this.showingUnderlyingFloatingFilter?null===(o=this.underlyingFloatingFilter)||void 0===o||o.onParentModelChanged(null===(i=this.parentFilterInstance.getSelectedFilter())||void 0===i?void 0:i.getModel(),t):this.updateDisplayedValue()}updateDisplayedValue(){if(!this.parentFilterInstance||!this.eFloatingFilterText)return;const e=this.parentFilterInstance.getSelectedFilter();if(!e)return this.eFloatingFilterText.setValue(""),void this.eFloatingFilterText.setDisplayed(!1);if(this.eFloatingFilterText.setDisplayed(!0),e.getModelAsString){const t=e.getModel();this.eFloatingFilterText.setValue(null==t?"":e.getModelAsString(t))}else this.eFloatingFilterText.setValue("")}onSelectedColumnChanged(){this.showingUnderlyingFloatingFilter||this.updateDisplayedValue()}onColumnRowGroupChanged(){this.showingUnderlyingFloatingFilter||this.updateDisplayedValue()}destroy(){super.destroy()}}le([e("columnModel")],ae.prototype,"columnModel",void 0),le([e("filterManager")],ae.prototype,"filterManager",void 0),le([a("eFloatingFilter")],ae.prototype,"eFloatingFilter",void 0);const ue={version:"30.0.0",moduleName:S.RowGroupingModule,beans:[N,ne,T,w,R,V],agStackComponents:[{componentName:"AgGridHeaderDropZones",componentClass:oe}],userComponents:[{componentName:"agGroupColumnFilter",componentClass:se},{componentName:"agGroupColumnFloatingFilter",componentClass:ae}],dependantModules:[D]};var de=function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};class ce extends X{constructor(e){super(e,"aggregation")}passBeansUp(){super.setBeans({gridOptionsService:this.gridOptionsService,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});const e=this.localeService.getLocaleTextFunc(),t=e("valueColumnsEmptyMessage","Drag here to aggregate"),o=e("values","Values");super.init({dragAndDropIcon:g.ICON_AGGREGATE,icon:n.createIconNoSpan("valuePanel",this.gridOptionsService,null),emptyMessage:t,title:o}),this.addManagedListener(this.eventService,c.EVENT_COLUMN_VALUE_CHANGED,this.refreshGui.bind(this))}getAriaLabel(){return this.localeService.getLocaleTextFunc()("ariaValuesDropZonePanelLabel","Values")}getTooltipParams(){const e=super.getTooltipParams();return e.location="valueColumnsList",e}getIconName(){return this.isPotentialDndColumns()?g.ICON_AGGREGATE:g.ICON_NOT_ALLOWED}isColumnDroppable(e){return!(this.gridOptionsService.is("functionsReadOnly")||!e.isPrimary())&&(e.isAllowValue()&&!e.isValueActive())}updateColumns(e){if(this.gridOptionsService.is("functionsPassive")){const t={type:c.EVENT_COLUMN_VALUE_CHANGE_REQUEST,columns:e};this.eventService.dispatchEvent(t)}else this.columnModel.setValueColumns(e,"toolPanelUi")}getExistingColumns(){return this.columnModel.getValueColumns()}}de([e("columnModel")],ce.prototype,"columnModel",void 0),de([e("loggerFactory")],ce.prototype,"loggerFactory",void 0),de([e("dragAndDropService")],ce.prototype,"dragAndDropService",void 0),de([t],ce.prototype,"passBeansUp",null);export{ee as PivotDropZonePanel,Y as RowGroupDropZonePanel,ue as RowGroupingModule,ce as ValuesDropZonePanel};