/**
          * @ag-grid-enterprise/side-bar - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v30.0.1
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
/**
          * @ag-grid-enterprise/side-bar - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v30.0.1
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
import{Autowired as e,PostConstruct as t,Component as o,Events as s,RefSelector as n,_ as i,PreDestroy as r,KeyCode as l,ManagedFocusFeature as a,ModuleRegistry as d,ModuleNames as c,Bean as h,BeanStub as u,ProvidedColumnGroup as p}from"@ag-grid-community/core";import{EnterpriseCoreModule as f}from"@ag-grid-enterprise/core";var g=function(e,t,o,s){var n,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(r=(i<3?n(r):i>3?n(t,o,r):n(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r};class T extends o{constructor(){super('<div class="ag-tool-panel-horizontal-resize"></div>'),this.minWidth=100,this.maxWidth=null}setElementToResize(e){this.elementToResize=e}postConstruct(){const e=this.horizontalResizeService.addResizeBar({eResizeBar:this.getGui(),dragStartPixels:1,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this),onResizeEnd:this.onResizeEnd.bind(this)});this.addDestroyFunc(e),this.setInverted(this.gridOptionsService.is("enableRtl"))}dispatchResizeEvent(e,t,o){const n={type:s.EVENT_TOOL_PANEL_SIZE_CHANGED,width:o,started:e,ended:t};this.eventService.dispatchEvent(n)}onResizeStart(){this.startingWidth=this.elementToResize.offsetWidth,this.dispatchResizeEvent(!0,!1,this.startingWidth)}onResizeEnd(e){return this.onResizing(e,!0)}onResizing(e,t=!1){const o=this.inverted?-1:1;let s=Math.max(this.minWidth,Math.floor(this.startingWidth-e*o));null!=this.maxWidth&&(s=Math.min(this.maxWidth,s)),this.elementToResize.style.width=s+"px",this.dispatchResizeEvent(!1,t,s)}setInverted(e){this.inverted=e}setMaxWidth(e){this.maxWidth=e}setMinWidth(e){this.minWidth=null!=e?e:100}}g([e("horizontalResizeService")],T.prototype,"horizontalResizeService",void 0),g([t],T.prototype,"postConstruct",null);var m=function(e,t,o,s){var n,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(r=(i<3?n(r):i>3?n(t,o,r):n(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r};class y extends o{constructor(e){super(),this.toolPanelDef=e}getToolPanelId(){return this.toolPanelDef.id}postConstruct(){const e=this.createTemplate();this.setTemplate(e),this.setLabel(),this.setIcon(),this.addManagedListener(this.eToggleButton,"click",this.onButtonPressed.bind(this)),this.eToggleButton.setAttribute("id",`ag-${this.getCompId()}-button`)}createTemplate(){return'<div class="ag-side-button" role="presentation">\n                <button type="button" ref="eToggleButton" tabindex="-1" role="tab" aria-expanded="false" class="ag-button ag-side-button-button">\n                    <div ref="eIconWrapper" class="ag-side-button-icon-wrapper" aria-hidden="true"></div>\n                    <span ref ="eLabel" class="ag-side-button-label"></span>\n                </button>\n            </div>'}setLabel(){const e=this.localeService.getLocaleTextFunc(),t=this.toolPanelDef,o=e(t.labelKey,t.labelDefault);this.eLabel.innerText=o}setIcon(){this.eIconWrapper.insertAdjacentElement("afterbegin",i.createIconNoSpan(this.toolPanelDef.iconKey,this.gridOptionsService))}onButtonPressed(){this.dispatchEvent({type:y.EVENT_TOGGLE_BUTTON_CLICKED})}setSelected(e){this.addOrRemoveCssClass("ag-selected",e),i.setAriaExpanded(this.eToggleButton,e)}getButtonElement(){return this.eToggleButton}}y.EVENT_TOGGLE_BUTTON_CLICKED="toggleButtonClicked",m([n("eToggleButton")],y.prototype,"eToggleButton",void 0),m([n("eIconWrapper")],y.prototype,"eIconWrapper",void 0),m([n("eLabel")],y.prototype,"eLabel",void 0),m([t],y.prototype,"postConstruct",null);var P=function(e,t,o,s){var n,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(r=(i<3?n(r):i>3?n(t,o,r):n(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r};class v extends o{constructor(){super(v.TEMPLATE),this.buttonComps=[]}postConstruct(){this.addManagedListener(this.getFocusableElement(),"keydown",this.handleKeyDown.bind(this))}handleKeyDown(e){if(e.key!==l.TAB||!e.shiftKey)return;const t=i.last(this.columnModel.getAllDisplayedColumns());this.focusService.focusGridView(t,!0)&&e.preventDefault()}setActiveButton(e){this.buttonComps.forEach(t=>{t.setSelected(e===t.getToolPanelId())})}addButtonComp(e){const t=this.createBean(new y(e));return this.buttonComps.push(t),this.appendChild(t),t.addEventListener(y.EVENT_TOGGLE_BUTTON_CLICKED,()=>{this.dispatchEvent({type:v.EVENT_SIDE_BAR_BUTTON_CLICKED,toolPanelId:e.id})}),t}clearButtons(){this.buttonComps=this.destroyBeans(this.buttonComps),i.clearElement(this.getGui())}}v.EVENT_SIDE_BAR_BUTTON_CLICKED="sideBarButtonClicked",v.TEMPLATE='<div class="ag-side-buttons" role="tablist"></div>',P([e("focusService")],v.prototype,"focusService",void 0),P([e("columnModel")],v.prototype,"columnModel",void 0),P([t],v.prototype,"postConstruct",null),P([r],v.prototype,"clearButtons",null);class E{static parse(e){if(!e)return;if(!0===e)return{toolPanels:[E.DEFAULT_COLUMN_COMP,E.DEFAULT_FILTER_COMP],defaultToolPanel:"columns"};if("string"==typeof e)return E.parse([e]);if(Array.isArray(e)){const t=[];if(e.forEach(e=>{const o=E.DEFAULT_BY_KEY[e];o?t.push(o):console.warn(`AG Grid: the key ${e} is not a valid key for specifying a tool panel, valid keys are: ${Object.keys(E.DEFAULT_BY_KEY).join(",")}`)}),0===t.length)return;return{toolPanels:t,defaultToolPanel:t[0].id}}return{toolPanels:E.parseComponents(e.toolPanels),defaultToolPanel:e.defaultToolPanel,hiddenByDefault:e.hiddenByDefault,position:e.position}}static parseComponents(e){const t=[];return e?(e.forEach(e=>{let o=null;if("string"==typeof e){const t=E.DEFAULT_BY_KEY[e];if(!t)return void console.warn(`AG Grid: the key ${e} is not a valid key for specifying a tool panel, valid keys are: ${Object.keys(E.DEFAULT_BY_KEY).join(",")}`);o=t}else o=e;t.push(o)}),t):t}}E.DEFAULT_COLUMN_COMP={id:"columns",labelDefault:"Columns",labelKey:"columns",iconKey:"columns",toolPanel:"agColumnsToolPanel"},E.DEFAULT_FILTER_COMP={id:"filters",labelDefault:"Filters",labelKey:"filters",iconKey:"filter",toolPanel:"agFiltersToolPanel"},E.DEFAULT_BY_KEY={columns:E.DEFAULT_COLUMN_COMP,filters:E.DEFAULT_FILTER_COMP};var C=function(e,t,o,s){var n,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(r=(i<3?n(r):i>3?n(t,o,r):n(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r};class B extends o{constructor(){super(B.TEMPLATE)}setupResize(){const e=this.getGui(),t=this.resizeBar=this.createManagedBean(new T);e.setAttribute("id","ag-"+this.getCompId()),t.setElementToResize(e),this.appendChild(t)}getToolPanelId(){return this.toolPanelId}setToolPanelDef(e){const{id:t,minWidth:o,maxWidth:s,width:n}=e;this.toolPanelId=t,this.width=n;const i=this.userComponentFactory.getToolPanelCompDetails(e,{}).newAgStackInstance();null!=i?(i.then(this.setToolPanelComponent.bind(this)),null!=o&&this.resizeBar.setMinWidth(o),null!=s&&this.resizeBar.setMaxWidth(s)):console.warn(`AG Grid: error processing tool panel component ${t}. You need to specify 'toolPanel'`)}setToolPanelComponent(e){this.toolPanelCompInstance=e,this.appendChild(e.getGui()),this.addDestroyFunc(()=>{this.destroyBean(e)}),this.width&&(this.getGui().style.width=this.width+"px")}getToolPanelInstance(){return this.toolPanelCompInstance}setResizerSizerSide(e){const t="left"===e,o=this.gridOptionsService.is("enableRtl")?t:!t;this.resizeBar.setInverted(o)}refresh(){this.toolPanelCompInstance.refresh()}}B.TEMPLATE='<div class="ag-tool-panel-wrapper" role="tabpanel"/>',C([e("userComponentFactory")],B.prototype,"userComponentFactory",void 0),C([t],B.prototype,"setupResize",null);var b=function(e,t,o,s){var n,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(r=(i<3?n(r):i>3?n(t,o,r):n(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r};class D extends o{constructor(){super(D.TEMPLATE),this.toolPanelWrappers=[]}postConstruct(){this.sideBarButtonsComp.addEventListener(v.EVENT_SIDE_BAR_BUTTON_CLICKED,this.onToolPanelButtonClicked.bind(this)),this.setSideBarDef(),this.addManagedPropertyListener("sideBar",()=>{this.clearDownUi(),this.setSideBarDef()}),this.gridApi.registerSideBarComp(this),this.createManagedBean(new a(this.getFocusableElement(),{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this)}))}onTabKeyDown(e){if(e.defaultPrevented)return;const{focusService:t,sideBarButtonsComp:o}=this,s=this.getGui(),n=o.getGui(),i=this.gridOptionsService.getDocument().activeElement,r=s.querySelector(".ag-tool-panel-wrapper:not(.ag-hidden)"),l=e.target;if(!r)return;if(n.contains(i))return void(t.focusInto(r,e.shiftKey)&&e.preventDefault());if(!e.shiftKey)return;let a=null;r.contains(i)?a=this.focusService.findNextFocusableElement(r,void 0,!0):t.isTargetUnderManagedComponent(r,l)&&e.shiftKey&&(a=this.focusService.findFocusableElementBeforeTabGuard(r,l)),a||(a=n.querySelector(".ag-selected button")),a&&(e.preventDefault(),a.focus())}handleKeyDown(e){const t=this.gridOptionsService.getDocument();if(!this.sideBarButtonsComp.getGui().contains(t.activeElement))return;const o=this.sideBarButtonsComp.getGui(),s=Array.prototype.slice.call(o.querySelectorAll(".ag-side-button")),n=t.activeElement,i=s.findIndex(e=>e.contains(n));let r=null;switch(e.key){case l.LEFT:case l.UP:r=Math.max(0,i-1);break;case l.RIGHT:case l.DOWN:r=Math.min(i+1,s.length-1)}if(null===r)return;const a=s[r].querySelector("button");a&&(a.focus(),e.preventDefault())}onToolPanelButtonClicked(e){const t=e.toolPanelId;this.openedItem()===t?this.openToolPanel(void 0,"sideBarButtonClicked"):this.openToolPanel(t,"sideBarButtonClicked")}clearDownUi(){this.sideBarButtonsComp.clearButtons(),this.destroyToolPanelWrappers()}setSideBarDef(){this.setDisplayed(!1);const e=this.gridOptionsService.get("sideBar");if(this.sideBar=E.parse(e),this.sideBar&&this.sideBar.toolPanels){const e=!this.sideBar.hiddenByDefault;this.setDisplayed(e);const t=this.sideBar.toolPanels;this.createToolPanelsAndSideButtons(t),this.setSideBarPosition(this.sideBar.position),this.sideBar.hiddenByDefault||this.openToolPanel(this.sideBar.defaultToolPanel,"sideBarInitializing")}}getDef(){return this.sideBar}setSideBarPosition(e){e||(e="right");const t="left"===e,o=t?"right":"left";return this.addOrRemoveCssClass("ag-side-bar-left",t),this.addOrRemoveCssClass("ag-side-bar-right",!t),this.toolPanelWrappers.forEach(e=>{e.setResizerSizerSide(o)}),this}createToolPanelsAndSideButtons(e){for(const t of e)this.createToolPanelAndSideButton(t)}validateDef(e){if(null==e.id)return console.warn("AG Grid: please review all your toolPanel components, it seems like at least one of them doesn't have an id"),!1;if("agColumnsToolPanel"===e.toolPanel){if(!d.assertRegistered(c.ColumnsToolPanelModule,"Column Tool Panel",this.context.getGridId()))return!1}if("agFiltersToolPanel"===e.toolPanel){if(!d.assertRegistered(c.FiltersToolPanelModule,"Filters Tool Panel",this.context.getGridId()))return!1}return!0}createToolPanelAndSideButton(e){if(!this.validateDef(e))return;const t=this.sideBarButtonsComp.addButtonComp(e),o=this.getContext().createBean(new B);o.setToolPanelDef(e),o.setDisplayed(!1);const s=o.getGui();this.appendChild(s),this.toolPanelWrappers.push(o),i.setAriaControls(t.getButtonElement(),s)}refresh(){this.toolPanelWrappers.forEach(e=>e.refresh())}openToolPanel(e,t="api"){const o=this.openedItem();if(o===e)return;this.toolPanelWrappers.forEach(t=>{const o=e===t.getToolPanelId();t.setDisplayed(o)});o!==this.openedItem()&&(this.sideBarButtonsComp.setActiveButton(e),this.raiseToolPanelVisibleEvent(e,null!=o?o:void 0,t))}getToolPanelInstance(e){const t=this.toolPanelWrappers.filter(t=>t.getToolPanelId()===e)[0];if(t)return t.getToolPanelInstance();console.warn("AG Grid: unable to lookup Tool Panel as invalid key supplied: "+e)}raiseToolPanelVisibleEvent(e,t,o){const n=!!e&&!!t;if(t){const e={type:s.EVENT_TOOL_PANEL_VISIBLE_CHANGED,source:o,key:t,visible:!1,switchingToolPanel:n};this.eventService.dispatchEvent(e)}if(e){const t={type:s.EVENT_TOOL_PANEL_VISIBLE_CHANGED,source:o,key:e,visible:!0,switchingToolPanel:n};this.eventService.dispatchEvent(t)}}close(e="api"){this.openToolPanel(void 0,e)}isToolPanelShowing(){return!!this.openedItem()}openedItem(){let e=null;return this.toolPanelWrappers.forEach(t=>{t.isDisplayed()&&(e=t.getToolPanelId())}),e}destroyToolPanelWrappers(){this.toolPanelWrappers.forEach(e=>{i.removeFromParent(e.getGui()),this.destroyBean(e)}),this.toolPanelWrappers.length=0}destroy(){this.destroyToolPanelWrappers(),super.destroy()}}D.TEMPLATE='<div class="ag-side-bar ag-unselectable">\n            <ag-side-bar-buttons ref="sideBarButtons"></ag-side-bar-buttons>\n        </div>',b([e("gridApi")],D.prototype,"gridApi",void 0),b([e("focusService")],D.prototype,"focusService",void 0),b([n("sideBarButtons")],D.prototype,"sideBarButtonsComp",void 0),b([t],D.prototype,"postConstruct",null);var I=function(e,t,o,s){var n,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(r=(i<3?n(r):i>3?n(t,o,r):n(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r};let R=class extends u{constructor(){super(...arguments),this.isColGroupDef=e=>e&&void 0!==e.children,this.getId=e=>this.isColGroupDef(e)?e.groupId:e.colId}createColumnTree(e){const t=[],o=(e,s)=>{if(this.isColGroupDef(e)){const t=e,n=void 0!==t.groupId?t.groupId:t.headerName,i=new p(t,n,!1,s),r=[];return t.children.forEach(e=>{const t=o(e,s+1);t&&r.push(t)}),i.setChildren(r),i}{const o=e,s=o.colId?o.colId:o.field,n=this.columnModel.getPrimaryColumn(s);return n||t.push(o),n}},s=[];return e.forEach(e=>{const t=o(e,0);t&&s.push(t)}),t.length>0&&console.warn("AG Grid: unable to find grid columns for the supplied colDef(s):",t),s}syncLayoutWithGrid(e){const t=this.getLeafPathTrees();e(this.mergeLeafPathTrees(t))}getLeafPathTrees(){const e=(t,o)=>{let s;if(t instanceof p)if(t.isPadding())s=o;else{const e=Object.assign({},t.getColGroupDef());e.groupId=t.getGroupId(),e.children=[o],s=e}else{const e=Object.assign({},t.getColDef());e.colId=t.getColId(),s=e}const n=t.getOriginalParent();return n?e(n,s):s};return this.columnModel.getAllGridColumns().filter(e=>{const t=e.getColDef();return e.isPrimary()&&!t.showRowGroup}).map(t=>e(t,t.getColDef()))}mergeLeafPathTrees(e){const t=(e,t)=>this.isColGroupDef(e)&&this.isColGroupDef(t)&&this.getId(e)===this.getId(t),o=(e,t)=>{if(!this.isColGroupDef(t))return e;const s=e,n=t;if(n.children&&n.groupId){if(this.addChildrenToGroup(s,n.groupId,n.children[0]))return s}return n.children.forEach(e=>o(s,e)),s},s=[];for(let n=1;n<=e.length;n++){const i=e[n-1],r=e[n];t(i,r)?e[n]=o(i,r):s.push(i)}return s}addChildrenToGroup(e,t,o){if(!this.isColGroupDef(e))return!0;const s=e,n=o;if(((e,t)=>{const o=e.children.map(this.getId),s=i.includes(o,this.getId(t)),n=i.last(e.children),r=n&&this.getId(n)!==this.getId(t);return s&&r})(s,n))return s.children.push(n),!0;if(s.groupId===t){const e=s.children.map(this.getId);if(!i.includes(e,this.getId(n)))return s.children.push(n),!0}return s.children.forEach(e=>this.addChildrenToGroup(e,t,o)),!1}};I([e("columnModel")],R.prototype,"columnModel",void 0),R=I([h("toolPanelColDefService")],R);const S={version:"30.0.1",moduleName:c.SideBarModule,beans:[R],agStackComponents:[{componentName:"AgHorizontalResize",componentClass:T},{componentName:"AgSideBar",componentClass:D},{componentName:"AgSideBarButtons",componentClass:v}],dependantModules:[f]};export{S as SideBarModule,R as ToolPanelColDefService};