/**
          * @ag-grid-enterprise/range-selection - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v30.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
/**
          * @ag-grid-enterprise/range-selection - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v30.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
import{Autowired as e,PostConstruct as t,Bean as n,BeanStub as i,Events as s,AutoScrollService as o,_ as l,CellCtrl as r,Component as a,SelectionHandleType as c,CellRangeType as d,ModuleNames as g}from"@ag-grid-community/core";import{EnterpriseCoreModule as h}from"@ag-grid-enterprise/core";var u=function(e,t,n,i){var s,o=arguments.length,l=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,i);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(l=(o<3?s(l):o>3?s(t,n,l):s(t,n))||l);return o>3&&l&&Object.defineProperty(t,n,l),l};let R=class extends i{constructor(){super(...arguments),this.cellRanges=[],this.bodyScrollListener=this.onBodyScroll.bind(this),this.dragging=!1,this.intersectionRange=!1}init(){this.addManagedListener(this.eventService,s.EVENT_NEW_COLUMNS_LOADED,()=>this.onColumnsChanged()),this.addManagedListener(this.eventService,s.EVENT_COLUMN_VISIBLE,this.onColumnsChanged.bind(this)),this.addManagedListener(this.eventService,s.EVENT_COLUMN_VALUE_CHANGED,this.onColumnsChanged.bind(this)),this.addManagedListener(this.eventService,s.EVENT_COLUMN_PIVOT_MODE_CHANGED,()=>this.removeAllCellRanges()),this.addManagedListener(this.eventService,s.EVENT_COLUMN_ROW_GROUP_CHANGED,()=>this.removeAllCellRanges()),this.addManagedListener(this.eventService,s.EVENT_COLUMN_PIVOT_CHANGED,()=>this.removeAllCellRanges()),this.addManagedListener(this.eventService,s.EVENT_COLUMN_GROUP_OPENED,this.refreshLastRangeStart.bind(this)),this.addManagedListener(this.eventService,s.EVENT_COLUMN_MOVED,this.refreshLastRangeStart.bind(this)),this.addManagedListener(this.eventService,s.EVENT_COLUMN_PINNED,this.refreshLastRangeStart.bind(this)),this.ctrlsService.whenReady(()=>{const e=this.ctrlsService.getGridBodyCtrl();this.autoScrollService=new o({scrollContainer:e.getBodyViewportElement(),scrollAxis:"xy",getVerticalPosition:()=>e.getScrollFeature().getVScrollPosition().top,setVerticalPosition:t=>e.getScrollFeature().setVerticalScrollPosition(t),getHorizontalPosition:()=>e.getScrollFeature().getHScrollPosition().left,setHorizontalPosition:t=>e.getScrollFeature().setHorizontalScrollPosition(t),shouldSkipVerticalScroll:()=>!this.gridOptionsService.isDomLayout("normal"),shouldSkipHorizontalScroll:()=>!e.getScrollFeature().isHorizontalScrollShowing()})})}onColumnsChanged(){this.refreshLastRangeStart();const e=this.columnModel.getAllDisplayedColumns();this.cellRanges.forEach(t=>{const n=t.columns;t.columns=t.columns.filter(t=>t.isVisible()&&-1!==e.indexOf(t));!l.areEqual(n,t.columns)&&this.dispatchChangedEvent(!1,!0,t.id)});const t=this.cellRanges.length;this.cellRanges=this.cellRanges.filter(e=>e.columns.length>0),t>this.cellRanges.length&&this.dispatchChangedEvent(!1,!0)}refreshLastRangeStart(){const e=l.last(this.cellRanges);e&&this.refreshRangeStart(e)}isContiguousRange(e){const t=e.columns;if(!t.length)return!1;const n=this.columnModel.getAllDisplayedColumns(),i=t.map(e=>n.indexOf(e)).sort((e,t)=>e-t);return l.last(i)-i[0]+1===t.length}getRangeStartRow(e){if(e.startRow&&e.endRow)return this.rowPositionUtils.before(e.startRow,e.endRow)?e.startRow:e.endRow;return{rowIndex:0,rowPinned:this.pinnedRowModel.getPinnedTopRowCount()>0?"top":null}}getRangeEndRow(e){if(e.startRow&&e.endRow)return this.rowPositionUtils.before(e.startRow,e.endRow)?e.endRow:e.startRow;const t=this.pinnedRowModel.getPinnedBottomRowCount();return t>0?{rowIndex:t-1,rowPinned:"bottom"}:{rowIndex:this.rowModel.getRowCount()-1,rowPinned:null}}setRangeToCell(e,t=!1){if(!this.gridOptionsService.isEnableRangeSelection())return;const n=this.calculateColumnsBetween(e.column,e.column);if(!n)return;(this.gridOptionsService.is("suppressMultiRangeSelection")||!t||l.missing(this.cellRanges))&&this.removeAllCellRanges(!0);const i={rowIndex:e.rowIndex,rowPinned:e.rowPinned},s={startRow:i,endRow:i,columns:n,startColumn:e.column};this.cellRanges.push(s),this.setNewestRangeStartCell(e),this.onDragStop(),this.dispatchChangedEvent(!0,!0)}extendLatestRangeToCell(e){if(this.isEmpty()||!this.newestRangeStartCell)return;const t=l.last(this.cellRanges);this.updateRangeEnd(t,e)}updateRangeEnd(e,t,n=!1){const i=t.column,s=this.calculateColumnsBetween(e.startColumn,i);s&&!this.isLastCellOfRange(e,t)&&(e.columns=s,e.endRow={rowIndex:t.rowIndex,rowPinned:t.rowPinned},n||this.dispatchChangedEvent(!0,!0,e.id))}refreshRangeStart(e){const{startColumn:t,columns:n}=e,i=(t,n)=>{const i=e.columns.filter(e=>e!==t);t?(e.startColumn=t,e.columns=n?[t,...i]:[...i,t]):e.columns=i},{left:s,right:o}=this.getRangeEdgeColumns(e);if(t===n[0]&&t!==s)return void i(s,!0);t===l.last(n)&&t===o&&i(o,!1)}getRangeEdgeColumns(e){const t=this.columnModel.getAllDisplayedColumns(),n=e.columns.map(e=>t.indexOf(e)).filter(e=>e>-1).sort((e,t)=>e-t);return{left:t[n[0]],right:t[l.last(n)]}}extendLatestRangeInDirection(e){if(this.isEmpty()||!this.newestRangeStartCell)return;const t=e.key,n=e.ctrlKey||e.metaKey,i=l.last(this.cellRanges),s=this.newestRangeStartCell,o=i.columns[0],r=l.last(i.columns),a=i.endRow.rowIndex,c=i.endRow.rowPinned,d={column:s.column===o?r:o,rowIndex:a,rowPinned:c},g=this.cellNavigationService.getNextCellToFocus(t,d,n);return g?(this.setCellRange({rowStartIndex:s.rowIndex,rowStartPinned:s.rowPinned,rowEndIndex:g.rowIndex,rowEndPinned:g.rowPinned,columnStart:s.column,columnEnd:g.column}),g):void 0}setCellRange(e){this.gridOptionsService.isEnableRangeSelection()&&(this.removeAllCellRanges(!0),this.addCellRange(e))}setCellRanges(e){l.shallowCompare(this.cellRanges,e)||(this.removeAllCellRanges(!0),e.forEach(e=>{e.columns&&e.startRow&&this.setNewestRangeStartCell({rowIndex:e.startRow.rowIndex,rowPinned:e.startRow.rowPinned,column:e.columns[0]}),this.cellRanges.push(e)}),this.dispatchChangedEvent(!1,!0))}setNewestRangeStartCell(e){this.newestRangeStartCell=e}clearCellRangeCellValues(e){let{cellRanges:t}=e;const{cellEventSource:n="rangeService",dispatchWrapperEvents:i,wrapperEventSource:o="deleteKey"}=e;if(i){const e={type:s.EVENT_RANGE_DELETE_START,source:o};this.eventService.dispatchEvent(e)}if(t||(t=this.cellRanges),t.forEach(e=>{this.forEachRowInRange(e,t=>{const i=this.rowPositionUtils.getRowNode(t);if(i)for(let t=0;t<e.columns.length;t++){const s=this.columnModel.getGridColumn(e.columns[t]);if(!s||!s.isCellEditable(i))return;i.setDataValue(s,null,n)}})}),i){const e={type:s.EVENT_RANGE_DELETE_END,source:o};this.eventService.dispatchEvent(e)}}createCellRangeFromCellRangeParams(e){let t,n=!1;if(e.columns)t=e.columns.map(e=>this.columnModel.getColumnWithValidation(e)).filter(e=>e);else{const i=this.columnModel.getColumnWithValidation(e.columnStart),s=this.columnModel.getColumnWithValidation(e.columnEnd);if(!i||!s)return;t=this.calculateColumnsBetween(i,s),t&&t.length&&(n=t[0]!==i)}if(!t)return;return{startRow:null!=e.rowStartIndex?{rowIndex:e.rowStartIndex,rowPinned:e.rowStartPinned||null}:void 0,endRow:null!=e.rowEndIndex?{rowIndex:e.rowEndIndex,rowPinned:e.rowEndPinned||null}:void 0,columns:t,startColumn:n?l.last(t):t[0]}}addCellRange(e){if(!this.gridOptionsService.isEnableRangeSelection())return;const t=this.createCellRangeFromCellRangeParams(e);t&&(t.startRow&&this.setNewestRangeStartCell({rowIndex:t.startRow.rowIndex,rowPinned:t.startRow.rowPinned,column:t.startColumn}),this.cellRanges.push(t),this.dispatchChangedEvent(!1,!0,t.id))}getCellRanges(){return this.cellRanges}isEmpty(){return 0===this.cellRanges.length}isMoreThanOneCell(){const e=this.cellRanges.length;if(0===e)return!1;if(e>1)return!0;const t=this.cellRanges[0],n=this.getRangeStartRow(t),i=this.getRangeEndRow(t);return n.rowPinned!==i.rowPinned||n.rowIndex!==i.rowIndex||1!==t.columns.length}areAllRangesAbleToMerge(){const e=new Map;if(this.cellRanges.length<=1)return!0;let t;this.cellRanges.forEach(t=>{this.forEachRowInRange(t,n=>{const i=`${n.rowPinned||"normal"}_${n.rowIndex}`,s=e.get(i),o=t.columns.map(e=>e.getId());if(s){const e=o.filter(e=>-1===s.indexOf(e));s.push(...e)}else e.set(i,o)})});for(const n of e.values()){const e=n.sort().join();if(void 0!==t){if(t!==e)return!1}else t=e}return!0}forEachRowInRange(e,t){const n=this.getRangeStartRow(e),i=this.getRangeEndRow(e);let s=n;for(;s&&(t(s),!this.rowPositionUtils.sameRow(s,i));)s=this.cellNavigationService.getRowBelow(s)}removeAllCellRanges(e){this.isEmpty()||(this.onDragStop(),this.cellRanges.length=0,e||this.dispatchChangedEvent(!1,!0))}onBodyScroll(){this.dragging&&this.lastMouseEvent&&this.onDragging(this.lastMouseEvent)}isCellInAnyRange(e){return this.getCellRangeCount(e)>0}isCellInSpecificRange(e,t){const n=null!==t.columns&&l.includes(t.columns,e.column),i=this.isRowInRange(e.rowIndex,e.rowPinned,t);return n&&i}isLastCellOfRange(e,t){const{startRow:n,endRow:i}=e,s=this.rowPositionUtils.before(n,i)?i:n,o=t.rowIndex===s.rowIndex&&t.rowPinned===s.rowPinned,r=e.columns[0],a=l.last(e.columns),c=e.startColumn===r?a:r;return t.column===c&&o}isBottomRightCell(e,t){const n=this.columnModel.getAllDisplayedColumns(),i=e.columns.map(e=>n.indexOf(e)).sort((e,t)=>e-t),{startRow:s,endRow:o}=e,r=this.rowPositionUtils.before(s,o)?o:s,a=n.indexOf(t.column)===l.last(i),c=t.rowIndex===r.rowIndex&&l.makeNull(t.rowPinned)===l.makeNull(r.rowPinned);return a&&c}getCellRangeCount(e){return this.isEmpty()?0:this.cellRanges.filter(t=>this.isCellInSpecificRange(e,t)).length}isRowInRange(e,t,n){const i=this.getRangeStartRow(n),s=this.getRangeEndRow(n),o={rowIndex:e,rowPinned:t||null},l=o.rowIndex===i.rowIndex&&o.rowPinned==i.rowPinned,r=o.rowIndex===s.rowIndex&&o.rowPinned==s.rowPinned;if(l||r)return!0;const a=!this.rowPositionUtils.before(o,i),c=this.rowPositionUtils.before(o,s);return a&&c}getDraggingRange(){return this.draggingRange}onDragStart(e){if(!this.gridOptionsService.isEnableRangeSelection())return;const{ctrlKey:t,metaKey:n,shiftKey:i}=e,s=t||n,o=!!!this.gridOptionsService.is("suppressMultiRangeSelection")&&s,r=i&&l.existsAndNotEmpty(this.cellRanges);o||r&&!l.exists(l.last(this.cellRanges).type)||this.removeAllCellRanges(!0);const a=this.dragService.getStartTarget();if(a&&this.updateValuesOnMove(a),this.lastCellHovered){if(this.dragging=!0,this.lastMouseEvent=e,this.intersectionRange=o&&this.getCellRangeCount(this.lastCellHovered)>1,r||this.setNewestRangeStartCell(this.lastCellHovered),this.cellRanges.length>0)this.draggingRange=l.last(this.cellRanges);else{const e={rowIndex:this.lastCellHovered.rowIndex,rowPinned:this.lastCellHovered.rowPinned};this.draggingRange={startRow:e,endRow:e,columns:[this.lastCellHovered.column],startColumn:this.newestRangeStartCell.column},this.cellRanges.push(this.draggingRange)}this.ctrlsService.getGridBodyCtrl().addScrollEventListener(this.bodyScrollListener),this.dispatchChangedEvent(!0,!1,this.draggingRange.id)}}intersectLastRange(e){if(e&&this.dragging)return;if(this.gridOptionsService.is("suppressMultiRangeSelection"))return;if(this.isEmpty())return;const t=l.last(this.cellRanges),n=this.getRangeStartRow(t),i=this.getRangeEndRow(t),s=[];this.cellRanges.slice(0,-1).forEach(e=>{const o=this.getRangeStartRow(e),r=this.getRangeEndRow(e),a=e.columns,c=a.filter(e=>-1===t.columns.indexOf(e));if(c.length===a.length)return void s.push(e);if(this.rowPositionUtils.before(i,o)||this.rowPositionUtils.before(r,n))return void s.push(e);const d=s.length;if(this.rowPositionUtils.before(o,n)){const e={columns:[...a],startColumn:t.startColumn,startRow:Object.assign({},o),endRow:this.cellNavigationService.getRowAbove(n)};s.push(e)}if(c.length>0){const e={columns:c,startColumn:l.includes(c,t.startColumn)?t.startColumn:c[0],startRow:this.rowPositionUtils.rowMax([Object.assign({},n),Object.assign({},o)]),endRow:this.rowPositionUtils.rowMin([Object.assign({},i),Object.assign({},r)])};s.push(e)}this.rowPositionUtils.before(i,r)&&s.push({columns:[...a],startColumn:t.startColumn,startRow:this.cellNavigationService.getRowBelow(i),endRow:Object.assign({},r)}),s.length-d==1&&(s[s.length-1].id=e.id)}),this.cellRanges=s,e&&this.dispatchChangedEvent(!1,!0)}updateValuesOnMove(e){const t=l.getCtrlForEventTarget(this.gridOptionsService,e,r.DOM_DATA_KEY_CELL_CTRL),n=null==t?void 0:t.getCellPosition();this.cellHasChanged=!1,!n||this.lastCellHovered&&this.cellPositionUtils.equals(n,this.lastCellHovered)||(this.lastCellHovered&&(this.cellHasChanged=!0),this.lastCellHovered=n)}onDragging(e){if(!this.dragging||!e)return;this.updateValuesOnMove(e.target),this.lastMouseEvent=e;const t=this.lastCellHovered,n=e=>t&&t.rowPinned===e&&this.newestRangeStartCell.rowPinned===e,i=n("top")||n("bottom");if(this.autoScrollService.check(e,i),!this.cellHasChanged)return;const s=this.calculateColumnsBetween(this.newestRangeStartCell.column,t.column);s&&(this.draggingRange.endRow={rowIndex:t.rowIndex,rowPinned:t.rowPinned},this.draggingRange.columns=s,this.dispatchChangedEvent(!1,!1,this.draggingRange.id))}onDragStop(){if(!this.dragging)return;const{id:e}=this.draggingRange;this.autoScrollService.ensureCleared(),this.ctrlsService.getGridBodyCtrl().removeScrollEventListener(this.bodyScrollListener),this.lastMouseEvent=null,this.dragging=!1,this.draggingRange=void 0,this.lastCellHovered=void 0,this.intersectionRange&&(this.intersectionRange=!1,this.intersectLastRange()),this.dispatchChangedEvent(!1,!0,e)}dispatchChangedEvent(e,t,n){const i={type:s.EVENT_RANGE_SELECTION_CHANGED,started:e,finished:t,id:n};this.eventService.dispatchEvent(i)}calculateColumnsBetween(e,t){const n=this.columnModel.getAllDisplayedColumns(),i=e===t,s=n.indexOf(e);if(s<0)return void console.warn(`AG Grid: column ${e.getId()} is not visible`);const o=i?s:n.indexOf(t);if(o<0)return void console.warn(`AG Grid: column ${t.getId()} is not visible`);if(i)return[e];const l=Math.min(s,o),r=l===s?o:s,a=[];for(let e=l;e<=r;e++)a.push(n[e]);return a}};u([e("rowModel")],R.prototype,"rowModel",void 0),u([e("dragService")],R.prototype,"dragService",void 0),u([e("columnModel")],R.prototype,"columnModel",void 0),u([e("cellNavigationService")],R.prototype,"cellNavigationService",void 0),u([e("pinnedRowModel")],R.prototype,"pinnedRowModel",void 0),u([e("rowPositionUtils")],R.prototype,"rowPositionUtils",void 0),u([e("cellPositionUtils")],R.prototype,"cellPositionUtils",void 0),u([e("ctrlsService")],R.prototype,"ctrlsService",void 0),u([t],R.prototype,"init",null),R=u([n("rangeService")],R);var w=function(e,t,n,i){var s,o=arguments.length,l=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,i);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(l=(o<3?s(l):o>3?s(t,n,l):s(t,n))||l);return o>3&&l&&Object.defineProperty(t,n,l),l};class v extends a{constructor(){super(...arguments),this.changedCalculatedValues=!1,this.dragging=!1,this.shouldDestroyOnEndDragging=!1}init(){this.dragService.addDragSource({dragStartPixels:0,eElement:this.getGui(),onDragStart:this.onDragStart.bind(this),onDragging:e=>{this.dragging=!0,this.rangeService.autoScrollService.check(e),this.changedCalculatedValues&&(this.onDrag(e),this.changedCalculatedValues=!1)},onDragStop:e=>{this.dragging=!1,this.onDragEnd(e),this.clearValues(),this.rangeService.autoScrollService.ensureCleared(),document.body.classList.remove(this.getDraggingCssClass()),this.shouldDestroyOnEndDragging&&this.destroy()}}),this.addManagedListener(this.getGui(),"mousedown",this.preventRangeExtension.bind(this))}isDragging(){return this.dragging}getCellCtrl(){return this.cellCtrl}setCellCtrl(e){this.cellCtrl=e}getCellRange(){return this.cellRange}setCellRange(e){this.cellRange=e}getRangeStartRow(){return this.rangeStartRow}setRangeStartRow(e){this.rangeStartRow=e}getRangeEndRow(){return this.rangeEndRow}setRangeEndRow(e){this.rangeEndRow=e}getLastCellHovered(){return this.lastCellHovered}preventRangeExtension(e){e.stopPropagation()}onDragStart(e){this.cellHoverListener=this.addManagedListener(this.ctrlsService.getGridCtrl().getGui(),"mousemove",this.updateValuesOnMove.bind(this)),document.body.classList.add(this.getDraggingCssClass())}getDraggingCssClass(){return`ag-dragging-${this.type===c.FILL?"fill":"range"}-handle`}updateValuesOnMove(e){const t=this.mouseEventService.getCellPositionForEvent(e);!t||this.lastCellHovered&&this.cellPositionUtils.equals(t,this.lastCellHovered)||(this.lastCellHovered=t,this.changedCalculatedValues=!0)}getType(){return this.type}refresh(e){const t=this.getCellCtrl(),n=this.getGui(),i=l.last(this.rangeService.getCellRanges()),s=i.startRow,o=i.endRow;if(s&&o){this.rowPositionUtils.before(o,s)?(this.setRangeStartRow(o),this.setRangeEndRow(s)):(this.setRangeStartRow(s),this.setRangeEndRow(o))}if(t!==e||!l.isVisible(n)){this.setCellCtrl(e);const t=e.getComp().getParentOfValue();t&&t.appendChild(n)}this.setCellRange(i)}clearValues(){this.lastCellHovered=void 0,this.removeListeners()}removeListeners(){this.cellHoverListener&&(this.cellHoverListener(),this.cellHoverListener=void 0)}destroy(){if(!this.shouldDestroyOnEndDragging&&this.isDragging())return l.setDisplayed(this.getGui(),!1),void(this.shouldDestroyOnEndDragging=!0);this.shouldDestroyOnEndDragging=!1,super.destroy(),this.removeListeners();const e=this.getGui();e.parentElement&&e.parentElement.removeChild(e)}}function m(e){const t=e.length;let n=0;if(t<=1)return e;for(let t=0;t<e.length;t++){const i=e[t],s=i.toString().split("e-");s.length>1?n=Math.max(n,parseInt(s[1],10)):Math.floor(i)!==i&&(n=Math.max(n,i.toString().split(".")[1].length))}let i=0,s=0,o=0,l=0,r=0;for(let n=0;n<t;n++)r=e[n],i+=n,s+=r,l+=n*n,o+=n*r;const a=(t*o-i*s)/(t*l-i*i),c=s/t-a*i/t,d=[];for(let e=0;e<=t;e++)d.push(parseFloat((e*a+c).toFixed(n)));return d}w([e("rowRenderer")],v.prototype,"rowRenderer",void 0),w([e("dragService")],v.prototype,"dragService",void 0),w([e("rangeService")],v.prototype,"rangeService",void 0),w([e("mouseEventService")],v.prototype,"mouseEventService",void 0),w([e("columnModel")],v.prototype,"columnModel",void 0),w([e("cellNavigationService")],v.prototype,"cellNavigationService",void 0),w([e("navigationService")],v.prototype,"navigationService",void 0),w([e("rowPositionUtils")],v.prototype,"rowPositionUtils",void 0),w([e("cellPositionUtils")],v.prototype,"cellPositionUtils",void 0),w([e("ctrlsService")],v.prototype,"ctrlsService",void 0),w([t],v.prototype,"init",null);var C=function(e,t,n,i){var s,o=arguments.length,l=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,i);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(l=(o<3?s(l):o>3?s(t,n,l):s(t,n))||l);return o>3&&l&&Object.defineProperty(t,n,l),l};class p extends v{constructor(){super(p.TEMPLATE),this.markedCells=[],this.cellValues=[],this.isUp=!1,this.isLeft=!1,this.isReduce=!1,this.type=c.FILL}updateValuesOnMove(e){super.updateValuesOnMove(e),this.initialXY||(this.initialXY=this.mouseEventService.getNormalisedPosition(e));const{x:t,y:n}=this.initialXY,{x:i,y:s}=this.mouseEventService.getNormalisedPosition(e),o=Math.abs(t-i),l=Math.abs(n-s),r=this.getFillHandleDirection();let a;a="xy"===r?o>l?"x":"y":r,a!==this.dragAxis&&(this.dragAxis=a,this.changedCalculatedValues=!0)}onDrag(e){if(!this.initialPosition){const e=this.getCellCtrl();if(!e)return;this.initialPosition=e.getCellPosition()}const t=this.getLastCellHovered();t&&this.markPathFrom(this.initialPosition,t)}onDragEnd(e){if(this.initialXY=null,!this.markedCells.length)return;const t="x"===this.dragAxis,n=this.getCellRange(),i=n.columns.length,s=this.getRangeStartRow(),o=this.getRangeEndRow();let l;if(this.isUp||this.isLeft){const e=t?s:this.lastCellMarked;l=this.rangeService.createCellRangeFromCellRangeParams({rowStartIndex:e.rowIndex,rowStartPinned:e.rowPinned,columnStart:t?this.lastCellMarked.column:n.columns[0],rowEndIndex:o.rowIndex,rowEndPinned:o.rowPinned,columnEnd:n.columns[i-1]})}else l=this.rangeService.createCellRangeFromCellRangeParams({rowStartIndex:s.rowIndex,rowStartPinned:s.rowPinned,columnStart:n.columns[0],rowEndIndex:t?o.rowIndex:this.lastCellMarked.rowIndex,rowEndPinned:t?o.rowPinned:this.lastCellMarked.rowPinned,columnEnd:t?this.lastCellMarked.column:n.columns[i-1]});l&&(this.raiseFillStartEvent(),this.handleValueChanged(n,l,e),this.rangeService.setCellRanges([l]),this.raiseFillEndEvent(n,l))}getFillHandleDirection(){const e=this.gridOptionsService.get("fillHandleDirection");return e?"x"!==e&&"y"!==e&&"xy"!==e?(l.doOnce(()=>console.warn("AG Grid: valid values for fillHandleDirection are 'x', 'y' and 'xy'. Default to 'xy'."),"warn invalid fill direction"),"xy"):e:"xy"}raiseFillStartEvent(){const e={type:s.EVENT_FILL_START};this.eventService.dispatchEvent(e)}raiseFillEndEvent(e,t){const n={type:s.EVENT_FILL_END,initialRange:e,finalRange:t};this.eventService.dispatchEvent(n)}handleValueChanged(e,t,n){const i=this.rangeService.getRangeEndRow(e),s=this.rangeService.getRangeStartRow(e),o=this.rangeService.getRangeEndRow(t),r=this.rangeService.getRangeStartRow(t),a="y"===this.dragAxis;if(this.isReduce&&!this.gridOptionsService.is("suppressClearOnFillReduction")){const n=a?e.columns:e.columns.filter(e=>t.columns.indexOf(e)<0),s=a?this.cellNavigationService.getRowBelow(o):r;return void(s&&this.clearCellsInRange(s,i,n))}let c=!0;const d=[],g=[];let h=0;const u=()=>{d.length=0,g.length=0,h=0},R=(t,n)=>{let g=this.isUp?i:s,h=!1;for(a&&(c=!0,u());!h&&g;){const R=this.rowPositionUtils.getRowNode(g);if(!R)break;a&&t?w(d,t,R,()=>!this.rowPositionUtils.sameRow(g,this.isUp?s:i)):n&&(c=!0,u(),n.forEach(t=>w(d,t,R,()=>t!==(this.isLeft?e.columns[0]:l.last(e.columns))))),h=this.rowPositionUtils.sameRow(g,this.isUp?r:o),g=this.isUp?this.cellNavigationService.getRowAbove(g):this.cellNavigationService.getRowBelow(g)}},w=(e,t,i,s)=>{var o,r;let a,d=!1;if(c)a=this.valueService.getValue(t,i),g.push(a),c=s();else{const{value:s,fromUserFunction:c,sourceCol:u,sourceRowNode:R}=this.processValues(n,e,g,t,i,h++);if(a=s,t.isCellEditable(i)){const e=this.valueService.getValue(t,i);c||((null===(o=null==u?void 0:u.getColDef())||void 0===o?void 0:o.useValueFormatterForExport)&&(a=null!==(r=this.valueFormatterService.formatValue(u,R,a))&&void 0!==r?r:a),t.getColDef().useValueParserForImport&&(a=this.valueParserService.parseValue(t,i,u?a:l.toStringOrNull(a),e))),c&&e===a?d=!0:i.setDataValue(t,a,"rangeService")}}d||e.push({value:a,column:t,rowNode:i})};if(a)e.columns.forEach(e=>{R(e)});else{const e=this.isLeft?[...t.columns].reverse():t.columns;R(void 0,e)}}clearCellsInRange(e,t,n){const i={startRow:e,endRow:t,columns:n,startColumn:n[0]};this.rangeService.clearCellRangeCellValues({cellRanges:[i]})}processValues(e,t,n,i,s,o){const r=this.gridOptionsService.getCallback("fillOperation");let a;if(a="y"===this.dragAxis?this.isUp?"up":"down":this.isLeft?"left":"right",r){const l=r({event:e,values:t.map(({value:e})=>e),initialValues:n,currentIndex:o,currentCellValue:this.valueService.getValue(i,s),direction:a,column:i,rowNode:s});if(!1!==l)return{value:l,fromUserFunction:!0}}const c=!t.some(({value:e})=>{const t=parseFloat(e);return isNaN(t)||t.toString()!==e.toString()});if(e.altKey||!c){if(c&&1===n.length){const e=this.isUp||this.isLeft?-1:1;return{value:parseFloat(l.last(t).value)+1*e,fromUserFunction:!1}}const{value:e,column:i,rowNode:s}=t[o%t.length];return{value:e,fromUserFunction:!1,sourceCol:i,sourceRowNode:s}}return{value:l.last(m(t.map(({value:e})=>Number(e)))),fromUserFunction:!1}}clearValues(){this.clearMarkedPath(),this.clearCellValues(),this.lastCellMarked=void 0,super.clearValues()}clearMarkedPath(){this.markedCells.forEach(e=>{if(!e.isAlive())return;const t=e.getComp();t.addOrRemoveCssClass("ag-selection-fill-top",!1),t.addOrRemoveCssClass("ag-selection-fill-right",!1),t.addOrRemoveCssClass("ag-selection-fill-bottom",!1),t.addOrRemoveCssClass("ag-selection-fill-left",!1)}),this.markedCells.length=0,this.isUp=!1,this.isLeft=!1,this.isReduce=!1}clearCellValues(){this.cellValues.length=0}markPathFrom(e,t){if(this.clearMarkedPath(),this.clearCellValues(),"y"===this.dragAxis){if(this.rowPositionUtils.sameRow(t,e))return;const n=this.rowPositionUtils.before(t,e),i=this.getRangeStartRow(),s=this.getRangeEndRow();n&&(t.rowPinned==i.rowPinned&&t.rowIndex>=i.rowIndex||i.rowPinned!=s.rowPinned&&t.rowPinned==s.rowPinned&&t.rowIndex<=s.rowIndex)?(this.reduceVertical(e,t),this.isReduce=!0):(this.extendVertical(e,t,n),this.isReduce=!1)}else{const n=e.column,i=t.column;if(n===i)return;const s=this.columnModel.getAllDisplayedColumns(),o=s.indexOf(n),l=s.indexOf(i);l<=o&&l>=s.indexOf(this.getCellRange().columns[0])?(this.reduceHorizontal(e,t),this.isReduce=!0):(this.extendHorizontal(e,t,l<o),this.isReduce=!1)}this.lastCellMarked=t}extendVertical(e,t,n){const{navigationService:i,rangeService:s}=this;let o=e;do{const l=this.getCellRange(),r=l.columns.length;for(let a=0;a<r;a++){const c=l.columns[a],d={rowIndex:o.rowIndex,rowPinned:o.rowPinned},g=Object.assign(Object.assign({},d),{column:c}),h=s.isCellInSpecificRange(g,l),u=this.rowPositionUtils.sameRow(o,e);if(n&&(this.isUp=!0),!u){const e=i.getCellByPosition(g);if(e){this.markedCells.push(e);const i=e.getComp();h||(i.addOrRemoveCssClass("ag-selection-fill-left",0===a),i.addOrRemoveCssClass("ag-selection-fill-right",a===r-1)),i.addOrRemoveCssClass(n?"ag-selection-fill-top":"ag-selection-fill-bottom",this.rowPositionUtils.sameRow(o,t))}}}if(this.rowPositionUtils.sameRow(o,t))break}while(o=n?this.cellNavigationService.getRowAbove(o):this.cellNavigationService.getRowBelow(o))}reduceVertical(e,t){let n=e;do{const e=this.getCellRange(),i=e.columns.length,s=this.rowPositionUtils.sameRow(n,t);for(let s=0;s<i;s++){const i={rowIndex:n.rowIndex,rowPinned:n.rowPinned},o=Object.assign(Object.assign({},i),{column:e.columns[s]}),l=this.navigationService.getCellByPosition(o);if(l){this.markedCells.push(l);l.getComp().addOrRemoveCssClass("ag-selection-fill-bottom",this.rowPositionUtils.sameRow(n,t))}}if(s)break}while(n=this.cellNavigationService.getRowAbove(n))}extendHorizontal(e,t,n){const i=this.columnModel.getAllDisplayedColumns(),s=i.indexOf(n?t.column:e.column),o=i.indexOf(n?this.getCellRange().columns[0]:t.column),r=n?0:1,a=i.slice(s+r,o+r),c=this.getRangeStartRow(),d=this.getRangeEndRow();a.forEach(e=>{let t=c,i=!1;do{i=this.rowPositionUtils.sameRow(t,d);const s=this.navigationService.getCellByPosition({rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:e});if(s){this.markedCells.push(s);const i=s.getComp();i.addOrRemoveCssClass("ag-selection-fill-top",this.rowPositionUtils.sameRow(t,c)),i.addOrRemoveCssClass("ag-selection-fill-bottom",this.rowPositionUtils.sameRow(t,d)),n?(this.isLeft=!0,i.addOrRemoveCssClass("ag-selection-fill-left",e===a[0])):i.addOrRemoveCssClass("ag-selection-fill-right",e===l.last(a))}t=this.cellNavigationService.getRowBelow(t)}while(!i)})}reduceHorizontal(e,t){const n=this.columnModel.getAllDisplayedColumns(),i=n.indexOf(t.column),s=n.indexOf(e.column),o=n.slice(i,s),l=this.getRangeStartRow(),r=this.getRangeEndRow();o.forEach(e=>{let t=l,n=!1;do{n=this.rowPositionUtils.sameRow(t,r);const i=this.navigationService.getCellByPosition({rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:e});if(i){this.markedCells.push(i);i.getComp().addOrRemoveCssClass("ag-selection-fill-right",e===o[0])}t=this.cellNavigationService.getRowBelow(t)}while(!n)})}refresh(e){const t=this.rangeService.getCellRanges()[0];t.startRow&&t.endRow?super.refresh(e):this.destroy()}}p.TEMPLATE='<div class="ag-fill-handle"></div>',C([e("valueService")],p.prototype,"valueService",void 0),C([e("valueParserService")],p.prototype,"valueParserService",void 0),C([e("valueFormatterService")],p.prototype,"valueFormatterService",void 0);class f extends v{constructor(){super(f.TEMPLATE),this.type=c.RANGE,this.rangeFixed=!1}onDrag(e){const t=this.getLastCellHovered();if(!t)return;const n=this.rangeService.getCellRanges(),i=l.last(n);if(this.rangeFixed||(this.fixRangeStartEnd(i),this.rangeFixed=!0),this.endPosition={rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:t.column},2===n.length&&n[0].type===d.DIMENSION&&i.type===d.VALUE){!this.rowPositionUtils.sameRow(this.endPosition,this.rangeService.getRangeEndRow(i))&&this.rangeService.updateRangeEnd(n[0],Object.assign(Object.assign({},this.endPosition),{column:n[0].columns[0]}),!0)}this.rangeService.extendLatestRangeToCell(this.endPosition)}onDragEnd(e){const t=l.last(this.rangeService.getCellRanges());this.fixRangeStartEnd(t),this.rangeFixed=!1}fixRangeStartEnd(e){const t=this.rangeService.getRangeStartRow(e),n=this.rangeService.getRangeEndRow(e),i=e.columns[0];e.startRow=t,e.endRow=n,e.startColumn=i}}f.TEMPLATE='<div class="ag-range-handle"></div>';var S=function(e,t,n,i){var s,o=arguments.length,l=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,i);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(l=(o<3?s(l):o>3?s(t,n,l):s(t,n))||l);return o>3&&l&&Object.defineProperty(t,n,l),l};let E=class extends i{createSelectionHandle(e){return this.createBean(e===c.RANGE?new f:new p)}};E=S([n("selectionHandleFactory")],E);const P={version:"30.0.0",moduleName:g.RangeSelectionModule,beans:[R,E],agStackComponents:[{componentName:"AgFillHandle",componentClass:p},{componentName:"AgRangeHandle",componentClass:f}],dependantModules:[h]};export{P as RangeSelectionModule};