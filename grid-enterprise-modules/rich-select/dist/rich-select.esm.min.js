/**
          * @ag-grid-enterprise/rich-select - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v30.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
/**
          * @ag-grid-enterprise/rich-select - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v30.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
import{Autowired as e,Component as t,_ as i,RefSelector as s,PopupComponent as a,VirtualList as r,KeyCode as n,ModuleNames as o}from"@ag-grid-community/core";import{EnterpriseCoreModule as l}from"@ag-grid-enterprise/core";function c(e,t){e.then(e=>{const i=e.getGui();null!=i&&("object"==typeof i?t.appendChild(i):t.innerHTML=i)})}var h=function(e,t,i,s){var a,r=arguments.length,n=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(r<3?a(n):r>3?a(t,i,n):a(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n};class u extends t{constructor(e){super('<div class="ag-rich-select-row" role="presentation"></div>'),this.params=e}setState(e,t,i){this.populateWithRenderer(e,t)||this.populateWithoutRenderer(e,t),this.updateSelected(i)}updateSelected(e){this.addOrRemoveCssClass("ag-rich-select-row-selected",e)}populateWithoutRenderer(e,t){const s=null!=t?t:e;i.exists(s)&&""!==s?this.getGui().textContent=s.toString():this.getGui().innerHTML="&nbsp;"}populateWithRenderer(e,t){const i={value:e,valueFormatted:t,api:this.gridOptionsService.api},s=this.userComponentFactory.getCellRendererDetails(this.params,i),a=s?s.newAgStackInstance():void 0;return null!=a?c(a,this.getGui()):this.getGui().innerText=null!=i.valueFormatted?i.valueFormatted:i.value,!!a&&(a.then(e=>{this.addDestroyFunc(()=>{this.getContext().destroyBean(e)})}),!0)}}h([e("userComponentFactory")],u.prototype,"userComponentFactory",void 0);var d=function(e,t,i,s){var a,r=arguments.length,n=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(r<3?a(n):r>3?a(t,i,n):a(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n};class p extends a{constructor(){super(p.TEMPLATE),this.selectionConfirmed=!1,this.searchString=""}init(e){var t;this.params=e,this.selectedValue=e.value,this.originalSelectedValue=e.value,this.focusAfterAttached=e.cellStartedEdit;const s=i.createIconNoSpan("smallDown",this.gridOptionsService);if(s.classList.add("ag-rich-select-value-icon"),this.eValue.appendChild(s),this.virtualList=this.createManagedBean(new r("rich-select")),this.virtualList.setComponentCreator(this.createRowComponent.bind(this)),this.eList.appendChild(this.virtualList.getGui()),i.exists(this.params.cellHeight)&&this.virtualList.setRowHeight(this.params.cellHeight),this.renderSelectedValue(),i.missing(e.values))return void console.warn("AG Grid: richSelectCellEditor requires values for it to work");const a=e.values;this.virtualList.setModel({getRowCount:()=>a.length,getRow:e=>a[e]}),this.addGuiEventListener("keydown",this.onKeyDown.bind(this));const n=this.virtualList.getGui();this.addManagedListener(n,"click",this.onClick.bind(this)),this.addManagedListener(n,"mousemove",this.onMouseMove.bind(this));const o=i.exists(e.searchDebounceDelay)?e.searchDebounceDelay:300;this.clearSearchString=i.debounce(this.clearSearchString,o),1===(null===(t=e.eventKey)||void 0===t?void 0:t.length)&&this.searchText(e.eventKey)}onKeyDown(e){const t=e.key;switch(e.preventDefault(),t){case n.ENTER:this.onEnterKeyDown();break;case n.TAB:this.confirmSelection();break;case n.DOWN:case n.UP:this.onNavigationKeyDown(e,t);break;default:this.searchText(e)}}confirmSelection(){this.selectionConfirmed=!0}onEnterKeyDown(){this.confirmSelection(),this.params.stopEditing()}onNavigationKeyDown(e,t){e.preventDefault();const i=this.params.values.indexOf(this.selectedValue),s=t===n.UP?i-1:i+1;if(s>=0&&s<this.params.values.length){const e=this.params.values[s];this.setSelectedValue(e)}}searchText(e){if("string"==typeof e)this.searchString+=e,this.runSearch(),this.clearSearchString();else{let t=e.key;if(t===n.BACKSPACE)this.searchString=this.searchString.slice(0,-1),t="";else if(!i.isEventFromPrintableCharacter(e))return;this.searchText(t)}}runSearch(){const e=this.params.values;let t;if("number"!=typeof e[0]&&"string"!=typeof e[0]||(t=e.map(e=>this.params.formatValue(e))),"object"==typeof e[0]&&this.params.colDef.keyCreator&&(t=e.map(e=>{const t={value:e,colDef:this.params.colDef,column:this.params.column,node:this.params.node,data:this.params.data,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context};return this.params.colDef.keyCreator(t)})),!t)return;const s=i.fuzzySuggestions(this.searchString,t,!0)[0];if(!s)return;const a=e[t.indexOf(s)];this.setSelectedValue(a)}clearSearchString(){this.searchString=""}renderSelectedValue(){const e=this.params.formatValue(this.selectedValue),t=this.eValue,s={value:this.selectedValue,valueFormatted:e,api:this.gridOptionsService.api},a=this.userComponentFactory.getCellRendererDetails(this.params,s),r=a?a.newAgStackInstance():void 0;r?(c(r,t),r.then(e=>{this.addDestroyFunc(()=>this.getContext().destroyBean(e))})):i.exists(this.selectedValue)?t.innerText=e:i.clearElement(t)}setSelectedValue(e){if(this.selectedValue===e)return;const t=this.params.values.indexOf(e);-1!==t&&(this.selectedValue=e,this.virtualList.ensureIndexVisible(t),this.virtualList.forEachRenderedRow((e,i)=>{e.updateSelected(t===i)}),this.virtualList.focusRow(t))}createRowComponent(e){const t=this.params.formatValue(e),i=new u(this.params);return this.getContext().createBean(i),i.setState(e,t,e===this.selectedValue),i}onMouseMove(e){const t=this.virtualList.getGui().getBoundingClientRect(),i=this.virtualList.getScrollTop(),s=e.clientY-t.top+i,a=Math.floor(s/this.virtualList.getRowHeight()),r=this.params.values[a];void 0!==r&&this.setSelectedValue(r)}onClick(){this.confirmSelection(),this.params.stopEditing()}afterGuiAttached(){const e=this.params.values.indexOf(this.selectedValue);if(this.virtualList.refresh(),e>=0&&this.virtualList.ensureIndexVisible(e),this.virtualList.refresh(),this.focusAfterAttached){const t=-1!==e?e:0;this.params.values.length?this.virtualList.focusRow(t):this.getGui().focus()}}getValue(){return this.selectionConfirmed?this.selectedValue:this.originalSelectedValue}}p.TEMPLATE='<div class="ag-rich-select" tabindex="-1">\n            <div ref="eValue" class="ag-rich-select-value"></div>\n            <div ref="eList" class="ag-rich-select-list"></div>\n        </div>',d([e("userComponentFactory")],p.prototype,"userComponentFactory",void 0),d([s("eValue")],p.prototype,"eValue",void 0),d([s("eList")],p.prototype,"eList",void 0);const v={version:"30.0.0",moduleName:o.RichSelectModule,beans:[],userComponents:[{componentName:"agRichSelect",componentClass:p},{componentName:"agRichSelectCellEditor",componentClass:p}],dependantModules:[l]};export{v as RichSelectModule};